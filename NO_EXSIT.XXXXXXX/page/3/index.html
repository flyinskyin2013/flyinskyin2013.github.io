<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"e-x.top","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.27.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":false,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Sky&#39;s Blogs">
<meta property="og:url" content="https://e-x.top/NO_EXSIT.XXXXXXX/page/3/index.html">
<meta property="og:site_name" content="Sky&#39;s Blogs">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Sky">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://e-x.top/NO_EXSIT.XXXXXXX/page/3/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"NO_EXSIT.XXXXXXX/page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Sky's Blogs</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8677552300382028"
     crossorigin="anonymous"></script>


  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Sky's Blogs</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">A normal star</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>
<div class="custom-middle-nav animated fadeInDown">
  <div class="custom-nav-item">
    <a href="/archives/"><i class="fa fa-archive"></i> æ—¥å¿—å†ç¨‹</a>
  </div>
  <div class="custom-nav-item">
    <a href="/categories/"><i class="fa fa-th"></i> å…¨éƒ¨åˆ†ç±»</a>
  </div>
  <div class="custom-nav-item">
    <a href="/tags/"><i class="fa fa-tags"></i> çƒ­é—¨æ ‡ç­¾</a>
  </div>
  <div class="custom-nav-item">
    <a href="javascript:;" class="my-search-btn"><i class="fa fa-search"></i> æœ¬ç«™æœç´¢</a>
  </div>
</div>


<script>
// ä½¿ç”¨è„šæœ¬æ‰‹åŠ¨è§¦å‘ NexT çš„æœç´¢å¼¹çª—
document.addEventListener('DOMContentLoaded', () => {
  const customBtn = document.querySelector('.my-search-btn');
  customBtn.addEventListener('click', (e) => {
    e.preventDefault();
    // æ‰¾åˆ° NexT åŸç”Ÿçš„é‚£ä¸ªæœç´¢è§¦å‘æŒ‰é’®å¹¶æ¨¡æ‹Ÿç‚¹å‡»
    const originalBtn = document.querySelector('.site-nav-right .popup-trigger');
    if (originalBtn) {
      originalBtn.click();
    } else {
      // å¦‚æœåŸç”Ÿçš„æ²¡æ‰¾åˆ°ï¼Œå°è¯•ç›´æ¥è°ƒç”¨ NexT çš„ Search å†…éƒ¨å˜é‡ï¼ˆé’ˆå¯¹æŸäº›ç‰ˆæœ¬ï¼‰
      if (typeof CONFIG.local_search !== 'undefined') {
        // å°è¯•æ‰‹åŠ¨æ¿€æ´»å¼¹çª—
        document.querySelector('.search-pop-overlay').style.display = 'block';
        document.body.style.overflow = 'hidden';
        document.querySelector('.search-input').focus();
      }
    }
  });
});
</script>
</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Sky"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Sky</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">139</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">92</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">222</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/flyinskyin2013" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;flyinskyin2013" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
<div id="days" style="margin-top: 10px; font-size: 13px; color: #555;"></div>
<script>
  function show_date_time(){
    window.setTimeout("show_date_time()", 1000);
    BirthDay=new Date("01/07/2014 00:00:00"); // è¿™é‡Œæ”¹æˆä½ å»ºç«™çš„æ—¶é—´
    today=new Date();
    timeold=(today.getTime()-BirthDay.getTime());
    sectimeold=timeold/1000
    secondsold=Math.floor(sectimeold);
    msPerDay=24*60*60*1000
    e_daysold=timeold/msPerDay
    daysold=Math.floor(e_daysold);
    document.getElementById("days").innerHTML="æœ¬ç«™å·²è¿è¡Œ "+daysold+" å¤©";
  }
  show_date_time();
</script>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://e-x.top/2023/11/19/blog_idx_126/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Sky">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sky's Blogs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Sky's Blogs">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/19/blog_idx_126/" class="post-title-link" itemprop="url">åˆè¯†udsä¹‹abstract socket</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-11-19 10:50:00" itemprop="dateCreated datePublished" datetime="2023-11-19T10:50:00+08:00">2023-11-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-18 19:06:02" itemprop="dateModified" datetime="2024-05-18T19:06:02+08:00">2024-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-CPP/" itemprop="url" rel="index"><span itemprop="name">C&CPP</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-CPP/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-CPP/android/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>1.3k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>5 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <script src="\assets\js\APlayer.min.js"> </script><!--
 * @Description: 
 * @Author: Sky
 * @Date: 2020-08-24 16:37:34
 * @LastEditors: Sky
 * @LastEditTime: 2021-06-29 15:04:48
 * @Github: https://github.com/flyinskyin2013/
-->
<p><font color="red" size="7">PSï¼šè¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: è¿™ä¸ªåªæ˜¯åŸºäºã€Šæˆ‘è‡ªå·±ã€‹çš„ç†è§£ï¼Œ</font><br/><font color="red" size="7">å¦‚æœå’Œä½ çš„åŸåˆ™åŠæƒ³æ³•ç›¸å†²çªï¼Œè¯·è°…è§£ï¼Œå‹¿å–·ã€‚</font><br/></p>
<!-- ###### å‰ç½®è¯´æ˜
&emsp;&emsp;æœ¬æ–‡ä½œä¸ºæœ¬äººgithub blog/cnblogçš„ä¸»ç«™çš„å¤‡ä»½ã€‚ï¼ˆBlogID=126ï¼‰ 
&emsp;&emsp;æœ¬æ–‡å‘å¸ƒäº  2023-11-19 10:50             ï¼ˆBlogID=126ï¼‰ 
-->
<h6 id="ç¯å¢ƒè¯´æ˜">ç¯å¢ƒè¯´æ˜</h6>
<p>â€ƒâ€ƒæ— </p>
<h3 id="å‰è¨€">å‰è¨€</h3>
<hr>
<p>â€ƒâ€ƒåœ¨ã€Šè®°ä¸€æ¬¡æœ‰è¶£çš„hwclockå†™RTCçš„PermissionDeniedé”™è¯¯ã€‹ï¼ˆ<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Iflyinsky/p/17841708.html">https://www.cnblogs.com/Iflyinsky/p/17841708.html</a> æˆ–è€… <a target="_blank" rel="noopener" href="https://https">https://https</a>ğŸ˜•/flyinskyin2013.github.io/2023/11/19/blog_idx_125/ï¼‰ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†å…³äºé«˜é€šæ¿å¡ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡hwclockæ¥å†™å…¥rtcæ—¶é’Ÿã€‚ä½†æ˜¯æˆ‘ä»¬é€šè¿‡ç›¸å…³è°ƒæŸ¥ã€æµ‹è¯•ã€åˆ†æåå‘ç°ï¼Œé«˜é€šè‡ªå·±æäº†ä¸€å¥—æ–°çš„æ–¹å¼æ¥å†™å…¥rtcæ—¶é’Ÿï¼Œè¿™ç§ç‰¹æ®Šæ–¹æ³•ç”¨çš„æŠ€æœ¯å°±æ˜¯abstract socketã€‚è¿™ä¹Ÿæ˜¯æˆ‘åœ¨å·¥ä½œä¸­ç¬¬ä¸€æ¬¡é‡åˆ°abstract socketï¼Œè¿™é‡Œåšä¸€ä¸ªç®€è¦çš„è®°å½•ã€‚</p>
<h3 id="Abstract-sockets">Abstract sockets</h3>
<hr>
<p>â€ƒâ€ƒ</p>
<h5 id="è¯´æ˜">è¯´æ˜</h5>
<p>â€ƒâ€ƒæˆ‘ä»¬å…ˆä¸çœ‹ä»£ç ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹abstract socketså…·ä½“æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡netstatæŸ¥çœ‹unix socketç›¸å…³çš„è¿æ¥ä¿¡æ¯ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ubuntu 18.04é‡Œé¢ç”¨netstatæŸ¥çœ‹unix socketä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_126/netstat_unix.png" alt="rep_img"/></center>
    </div>
</div>   
<p>â€ƒâ€ƒæ³¨æ„å›¾ä¸­æˆ‘ä»¬çœ‹åˆ°çš„pathé‚£ä¸€åˆ—ï¼Œé™¤äº†æ™®é€šçš„è·¯å¾„å¤–ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€äº›å¥‡æ€ªçš„åå­—ï¼Œæ¯ä¸ªåå­—å‰é¢éƒ½æœ‰ä¸€ä¸ª@ç¬¦å·ã€‚è¿™ç§ç‰¹æ®Šçš„åå­—ï¼Œå°±æ˜¯abstract socketsã€‚</p>
<br/>
<br/>
<h5 id="ç®€ä»‹">ç®€ä»‹</h5>
<p>â€ƒâ€ƒé¦–å…ˆï¼Œæ ¹æ®æ–‡æ¡£ï¼Œå¯¹äºä¼ ç»Ÿçš„udsæ¥è¯´ï¼Œå…¶æ”¯æŒä¸¤ç§ç±»å‹ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šæœ‰åå­—çš„ã€æœªå‘½åçš„ã€‚å¯¹äºlinuxæ¥è¯´ï¼Œè¿™é‡Œè¿˜æ”¯æŒä¸€ç§ç‹¬ç«‹äºæ–‡ä»¶ç³»ç»Ÿçš„ï¼Œä¸”æ˜¯ä¸€ç§ä¸å¯ç§»æ¤çš„æ‰©å±•ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è¦ä»‹ç»çš„å°±æ˜¯æŠ½è±¡çš„è¿™ç§ç±»å‹ã€‚</p>
<p>â€ƒâ€ƒå¯¹äºæŠ½è±¡çš„udsæ¥è¯´ï¼Œsocketæƒé™å¯¹å…¶æ¥è¯´æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œä¾‹å¦‚umaskã€fchownã€fchmodç­‰ä¸ä¼šå½±å“å…¶è®¿é—®æƒé™ã€‚</p>
<p>â€ƒâ€ƒå¯¹äºæŠ½è±¡çš„udsæ¥è¯´ï¼ŒæŠ½è±¡çš„udså°†ä¼šè‡ªåŠ¨è¢«é”€æ¯ï¼Œå½“æ‰€æœ‰çš„å¼•ç”¨æ‰“å¼€çš„socketå…³é—­çš„æ—¶å€™ã€‚</p>
<p>â€ƒâ€ƒå¯¹äºæŠ½è±¡çš„udsæ¥è¯´ï¼Œå’Œæœ‰åå­—çš„udsæœ€å¤§çš„åŒºåˆ«åœ¨äºsockaddr_un.sun_path[0]æ˜¯0x00ï¼Œå¦‚æœå¤§å®¶å¯¹cé£æ ¼çš„å­—ç¬¦ä¸²æœ‰å°è±¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„ç»ˆæ­¢ç¬¦ã€‚abstract udsçš„åå­—ç”±sockaddr_un.sun_pathçš„å…¶ä½™å­—èŠ‚ç»™å‡ºï¼ˆè¿™ä¸ªæ—¶å€™çš„0x00æ˜¯æ²¡æœ‰ç‰¹æ®Šæ„ä¹‰çš„ï¼‰ï¼Œå…¶é•¿åº¦æ˜¯addrlen - sizeof(sa_family_t)æ¥å®šä¹‰çš„ã€‚</p>
<br/>
<br/>
<h5 id="ä½¿ç”¨å°ä¾‹å­">ä½¿ç”¨å°ä¾‹å­</h5>
<p>server</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/un.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">int</span> uds <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_UNIX<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>uds <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socket:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_un</span> addr<span class="token punctuation">;</span>
	addr<span class="token punctuation">.</span>sun_family <span class="token operator">=</span> AF_UNIX<span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span>addr<span class="token punctuation">.</span>sun_path<span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> addr_path <span class="token operator">=</span> <span class="token string">"abstract_test"</span><span class="token punctuation">;</span>
	<span class="token function">memcpy</span><span class="token punctuation">(</span>addr<span class="token punctuation">.</span>sun_path <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> addr_path<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>addr_path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">bind</span><span class="token punctuation">(</span>uds<span class="token punctuation">,</span> <span class="token operator">&amp;</span>addr<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>addr_path<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">sa_family_t</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"bind:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	ret <span class="token operator">=</span> <span class="token function">listen</span><span class="token punctuation">(</span>uds<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"listen:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_un</span> r_addr<span class="token punctuation">;</span>
	<span class="token class-name">socklen_t</span> r_addr_len<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _new <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>uds<span class="token punctuation">,</span> <span class="token operator">&amp;</span>r_addr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>r_addr_len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_new <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"accept:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> r_msg<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span>r_msg<span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ret <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>_new<span class="token punctuation">,</span> r_msg<span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"read:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"client msg = %s\n"</span><span class="token punctuation">,</span> r_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token function">write</span><span class="token punctuation">(</span>_new<span class="token punctuation">,</span> <span class="token string">"hello client"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token string">"hello client"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">close</span><span class="token punctuation">(</span>uds<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>client.c</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/un.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">int</span> uds <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_UNIX<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>uds <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socket:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_un</span> addr<span class="token punctuation">;</span>
	addr<span class="token punctuation">.</span>sun_family <span class="token operator">=</span> AF_UNIX<span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span>addr<span class="token punctuation">.</span>sun_path<span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> addr_path <span class="token operator">=</span> <span class="token string">"abstract_test"</span><span class="token punctuation">;</span>
	<span class="token function">memcpy</span><span class="token punctuation">(</span>addr<span class="token punctuation">.</span>sun_path <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> addr_path<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>addr_path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>uds<span class="token punctuation">,</span> <span class="token operator">&amp;</span>addr<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>addr_path<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">sa_family_t</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"connect:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">write</span><span class="token punctuation">(</span>uds<span class="token punctuation">,</span> <span class="token string">"hello server"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token string">"hello server"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">char</span> r_msg<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span>r_msg<span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">read</span><span class="token punctuation">(</span>uds<span class="token punctuation">,</span> r_msg<span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"server msg %s\n"</span><span class="token punctuation">,</span> r_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>	

	<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">close</span><span class="token punctuation">(</span>uds<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒé¦–å…ˆæˆ‘ä»¬æ’¸äº†ä¸¤ä¸ªä¾‹å­ï¼Œä¸€ä¸ªæ˜¯æœåŠ¡ç«¯ï¼Œä¸€ä¸ªæ˜¯å®¢æˆ·ç«¯ã€‚</p>
<p>â€ƒâ€ƒé¦–å…ˆæˆ‘ä»¬è¿è¡Œå®¢æˆ·ç«¯ã€‚ç„¶åé€šè¿‡netstatæŸ¥çœ‹æˆ‘ä»¬çš„socketã€‚å¦‚ä¸‹å›¾ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_126/netstat_uds.png" alt="rep_img"/></center>
    </div>
</div>   
<p>â€ƒâ€ƒå½“æˆ‘ä»¬è¿è¡ŒæœåŠ¡ç«¯åï¼Œå†æ¬¡è¿è¡Œå®¢æˆ·ç«¯ï¼Œå°±ä¼šçœ‹åˆ°æˆ‘ä»¬ä¼ è¾“çš„æ¶ˆæ¯ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_126/cs.png" alt="rep_img"/></center>
    </div>
</div>   
<br/>
<br/>
<br/>
<br/>
<h3 id="åè®°">åè®°</h3>
<hr>
<p>â€ƒâ€ƒé€šè¿‡æˆ‘ä»¬å¦‚ä¸Šçš„å®éªŒï¼Œå¯ä»¥çœ‹åˆ°å…¶å’Œæ™®é€šçš„udsç”¨æ³•å·®ä¸å¤šï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å…¶ä¸éœ€è¦å’Œæ–‡ä»¶ç³»ç»Ÿç»‘å®šäº†ã€‚</p>
<p>â€ƒâ€ƒå…¶å®ï¼Œè¿™ç§ä¸å’Œæ–‡ä»¶ç³»ç»Ÿç»‘å®šçš„ç‰¹æ€§ï¼Œå¯ä»¥ç»™æˆ‘ä»¬å¸¦æ¥æ›´å¤šæœ‰è¶£çš„ç”¨æ³•ï¼ˆä¾‹å¦‚ï¼šä¸å—æ–‡ä»¶ç³»ç»Ÿæƒé™å½±å“è¿›è¡Œé€šä¿¡ï¼‰ï¼Œåç»­æœ‰ç¼˜åˆ†äº«ã€‚</p>
<h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>æ— </p>
</li>
</ul>
<br/>
<br/>
<div style="margin:50px auto;">
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <hr/>
        <center><font color = #91e0b0 size = 5>æ‰“èµã€è®¢é˜…ã€æ”¶è—ã€ä¸¢é¦™è•‰ã€ç¡¬å¸ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ï¼ˆæ”»åŸç‹®çš„æ¬ç –ä¹‹è·¯ï¼‰</font></center>
    </div>
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg" alt="qrc_img"/></center>
    </div>
</div>
<!-- ![alt å…¬ä¼—å·å›¾ç‰‡](https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg "å…¬ä¼—å·å›¾ç‰‡") -->
<p><font color="red" size="7">PS: è¯·å°Šé‡åŸåˆ›ï¼Œä¸å–œå‹¿å–·ã€‚</font><br/><br>
<font color="red" size="7">PS: è¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: æœ‰é—®é¢˜è¯·ç•™è¨€ï¼Œçœ‹åˆ°åæˆ‘ä¼šç¬¬ä¸€æ—¶é—´å›å¤ã€‚</font><br/></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://e-x.top/2023/11/19/blog_idx_125/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Sky">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sky's Blogs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Sky's Blogs">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/19/blog_idx_125/" class="post-title-link" itemprop="url">è®°ä¸€æ¬¡æœ‰è¶£çš„hwclockå†™RTCçš„PermissionDeniedé”™è¯¯</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-11-19 10:41:00" itemprop="dateCreated datePublished" datetime="2023-11-19T10:41:00+08:00">2023-11-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-18 19:06:02" itemprop="dateModified" datetime="2024-05-18T19:06:02+08:00">2024-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>2k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>7 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <script src="\assets\js\APlayer.min.js"> </script><!--
 * @Description: 
 * @Author: Sky
 * @Date: 2020-08-24 16:37:34
 * @LastEditors: Sky
 * @LastEditTime: 2021-06-29 15:04:48
 * @Github: https://github.com/flyinskyin2013/
-->
<p><font color="red" size="7">PSï¼šè¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: è¿™ä¸ªåªæ˜¯åŸºäºã€Šæˆ‘è‡ªå·±ã€‹çš„ç†è§£ï¼Œ</font><br/><font color="red" size="7">å¦‚æœå’Œä½ çš„åŸåˆ™åŠæƒ³æ³•ç›¸å†²çªï¼Œè¯·è°…è§£ï¼Œå‹¿å–·ã€‚</font><br/></p>
<!-- ###### å‰ç½®è¯´æ˜
&emsp;&emsp;æœ¬æ–‡ä½œä¸ºæœ¬äººgithub blog/cnblogçš„ä¸»ç«™çš„å¤‡ä»½ã€‚ï¼ˆBlogID=125ï¼‰ 
&emsp;&emsp;æœ¬æ–‡å‘å¸ƒäº  2023-11-19 10:41             ï¼ˆBlogID=125ï¼‰ 
-->
<h6 id="ç¯å¢ƒè¯´æ˜">ç¯å¢ƒè¯´æ˜</h6>
<p>â€ƒâ€ƒæ— </p>
<h3 id="å‰è¨€">å‰è¨€</h3>
<hr>
<p>â€ƒâ€ƒç¨å¾®æ¥è§¦è¿‡åµŒå…¥å¼æ¿å¡çš„ï¼ŒåŸºæœ¬éƒ½çŸ¥é“åµŒå…¥å¼æ¿å¡é‡Œé¢æœ‰ä¸ªåŠŸèƒ½å«åšRTCã€‚åœ¨Linuxé‡Œé¢ï¼Œæœ‰å‡ ä¸ªæ¦‚å¿µæ¯”è¾ƒé‡è¦ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ç³»ç»Ÿæ—¶é—´å’Œç¡¬ä»¶æ—¶é’Ÿã€‚å¯¹äºç³»ç»Ÿæ—¶é—´çš„è¯ï¼Œå¤§å®¶éƒ½äº†è§£çš„æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬åœ¨å„ç§ç•Œé¢ä¸Šçœ‹åˆ°çš„æ—¶é—´éƒ½æ˜¯ç³»ç»Ÿæ—¶é—´ï¼Œæˆ‘ä»¬åœ¨CLIé‡Œé¢ï¼Œç”¨dateå‘½ä»¤æ“ä½œçš„æ—¶é—´å°±æ˜¯ç³»ç»Ÿæ—¶é—´ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿæ—¶é—´å¯ä»¥é€šè¿‡ç½‘ç»œåŒæ­¥æˆ–è€…è¯´RTCåŒæ­¥ã€‚</p>
<p>â€ƒâ€ƒæ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç¡¬ä»¶æ—¶é’ŸåŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å°±æ˜¯RealTimeClockï¼Œå®ƒä¸»è¦æ˜¯ç”¨çº½æ‰£ç”µæ± æ¥ç»´æŠ¤ä¸€ä¸ªç¡¬ä»¶æ—¶é’Ÿï¼Œä¸»è¦æ˜¯ç”¨æ¥åŒæ­¥æ—¶é’Ÿç”¨çš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„è®¾å¤‡æ€ä¹ˆåœ¨æ²¡æœ‰ç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡ä¸Šç”µå¼€æœºéƒ½èƒ½å¤Ÿå¾—åˆ°çœŸå®æ—¶é—´ï¼Œå°±éœ€è¦é RTCåŠŸèƒ½ã€‚å¯¹äºRTCæ¥è¯´ï¼Œåœ¨Linuxé‡Œé¢ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨hwclockå‘½ä»¤æ¥å¯¹ä»–åšç›¸å…³çš„æ“ä½œï¼Œä¾‹å¦‚è®¾ç½®ç¡¬ä»¶æ—¶é’Ÿï¼Œä¾‹å¦‚ä»ç¡¬ä»¶æ—¶é’Ÿä¸­å¾—åˆ°çœŸå®æ—¶é—´ï¼Œå¹¶è®¾ç½®åˆ°ç³»ç»Ÿæ—¶é’Ÿç­‰ç­‰ã€‚</p>
<h3 id="ä¸€ä¸ªå¥‡æ€ªçš„é”™è¯¯">ä¸€ä¸ªå¥‡æ€ªçš„é”™è¯¯</h3>
<hr>
<p>â€ƒâ€ƒä¸Šé¢æˆ‘ä»¬æåˆ°äº†hwclockï¼Œæœ€è¿‘ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ä¸€ä¸ªæ¿å¡ï¼Œå…¶æ˜¯Androidç³»ç»Ÿï¼Œæˆ‘ä»¬åœ¨äº¤ä»˜ç»™å®¢æˆ·çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼Œæˆ‘ä»¬æ‰§è¡Œhwclockå¤±è´¥äº†ï¼Œè€Œä¸”é”™è¯¯è¿˜æ˜¯Permission Deniendï¼Œç†Ÿæ‚‰linuxçš„æœ‹å‹å¯èƒ½éƒ½ç»å¸¸çœ‹åˆ°è¿™ä¸ªé”™è¯¯ï¼Œå®ƒå°±æ˜¯æƒé™é”™è¯¯ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬æ‰§è¡Œæ­¤å‘½ä»¤çš„ç¯å¢ƒå’Œé”™è¯¯ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_125/hwclock_error.png" alt="rep_img"/></center>
    </div>
</div>    
<p>â€ƒâ€ƒæœ‰äººç«‹é©¬å°±ä¼šæƒ³åˆ°æ˜¯ä¸æ˜¯æˆ‘ä»¬æ²¡æœ‰ç”¨rootç”¨æˆ·æ¥æ‰§è¡Œçš„åŸå› ï¼Œä»ä¸Šå›¾å¯çŸ¥ï¼Œå¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œè¿™ä¸ªé”™è¯¯è¿œè¿œæ²¡æœ‰æƒ³è±¡çš„é‚£ä¹ˆç®€å•ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰é‚£ä¹ˆå¤æ‚ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="æ·±å…¥åˆ†æç›¸å…³æºç ">æ·±å…¥åˆ†æç›¸å…³æºç </h3>
<hr>
<p>â€ƒâ€ƒé¦–å…ˆï¼Œåœ¨Androidé‡Œé¢ï¼Œhwclockæ˜¯æ¥è‡³äºä¸€ä¸ªå«åštoyboxçš„åº“ï¼Œå¤§æ¦‚åœ¨external/toybox/toys/other/hwclock.cï¼Œå…¶ä¸­å…³äºè®¾ç½®ç¡¬ä»¶æ—¶é’Ÿæ—¶çš„æ ¸å¿ƒä»£ç æ®µå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>toys<span class="token punctuation">.</span>optflags <span class="token operator">&amp;</span> FLAG_w<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/* The value of tm_isdst is positive if daylight saving time is in effect,
     * zero if it is not and negative if the information is not available.
     * todo: so why isn't this negative...? */</span>
    tm<span class="token punctuation">.</span>tm_isdst <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">xioctl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> RTC_SET_TIME<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tm<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒçœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æ˜ç™½ï¼Œå¿…é¡»è¦åˆ°å†…æ ¸æºç æ‰èƒ½å¤Ÿå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆã€‚</p>
<p>â€ƒâ€ƒé€šè¿‡RTC_SET_TIMEï¼Œåœ¨å†…æ ¸ä»£ç çš„drivers/rtc/rtc-dev.cé‡Œé¢ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ç¬¬ä¸€å¤„å¯èƒ½å¯¼è‡´å‡ºç°Permission Deniendçš„åœ°æ–¹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">rtc_dev_ioctl</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">file</span> <span class="token operator">*</span>file<span class="token punctuation">,</span>
                <span class="token keyword">unsigned</span> <span class="token keyword">int</span> cmd<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> arg<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> err <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">rtc_device</span> <span class="token operator">*</span>rtc <span class="token operator">=</span> file<span class="token operator">-></span>private_data<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">rtc_class_ops</span> <span class="token operator">*</span>ops <span class="token operator">=</span> rtc<span class="token operator">-></span>ops<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">rtc_time</span> tm<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">rtc_wkalrm</span> alarm<span class="token punctuation">;</span>
    <span class="token keyword">void</span> __user <span class="token operator">*</span>uarg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> __user <span class="token operator">*</span><span class="token punctuation">)</span> arg<span class="token punctuation">;</span>

    err <span class="token operator">=</span> <span class="token function">mutex_lock_interruptible</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rtc<span class="token operator">-></span>ops_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token keyword">return</span> err<span class="token punctuation">;</span>

    <span class="token comment">/* check that the calling task has appropriate permissions
        * for certain ioctls. doing this check here is useful
        * to avoid duplicate code in each driver.
        */</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>cmd<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> RTC_EPOCH_SET<span class="token operator">:</span>
    <span class="token keyword">case</span> RTC_SET_TIME<span class="token operator">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">capable</span><span class="token punctuation">(</span>CAP_SYS_TIME<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    err <span class="token operator">=</span> <span class="token operator">-</span>EACCES<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> RTC_IRQP_SET<span class="token operator">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>arg <span class="token operator">></span> rtc<span class="token operator">-></span>max_user_freq <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">capable</span><span class="token punctuation">(</span>CAP_SYS_RESOURCE<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    err <span class="token operator">=</span> <span class="token operator">-</span>EACCES<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> RTC_PIE_ON<span class="token operator">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rtc<span class="token operator">-></span>irq_freq <span class="token operator">></span> rtc<span class="token operator">-></span>max_user_freq <span class="token operator">&amp;&amp;</span>
                            <span class="token operator">!</span><span class="token function">capable</span><span class="token punctuation">(</span>CAP_SYS_RESOURCE<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    err <span class="token operator">=</span> <span class="token operator">-</span>EACCES<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

        <span class="token comment">//......</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒè¿™é‡Œäº§ç”Ÿæƒé™æ‹’ç»çš„åŸå› æ˜¯ç”±äºLinux Capabilityï¼Œå› æ­¤æˆ‘ä»¬é¦–è¦çš„æ˜¯æ£€æŸ¥æˆ‘ä»¬çš„hwclockæœ‰æ²¡æœ‰CAP_SYS_TIMEèƒ½åŠ›ï¼Œæˆ‘ä»¬é€šè¿‡prctl + PR_CAPBSET_READ æ¥è·å–hwclockæœ‰æ²¡æœ‰è¿™ä¸ªèƒ½åŠ›ï¼ˆå½“ç„¶ï¼Œè¿™é‡Œå¯ä»¥æœ‰å¾ˆå¤šçš„å…¶ä»–æ–¹å¼æ¥ç¡®å®šï¼Œæˆ‘è¿™é‡Œç”¨æœ€ç®€å•çš„æ–¹æ³•æ¥ç¡®å®šï¼‰ï¼Œåœ¨hwclockæºç ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç æ®µï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">prctl</span><span class="token punctuation">(</span>PR_CAPBSET_READ<span class="token punctuation">,</span> CAP_SYS_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"sky: prctl PR_CAPBSET_READ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"has CAP_SYS_TIME %d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒè¿è¡Œç»“æœå¦‚ä¸‹å›¾ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_125/prtcl_capsystime.png" alt="rep_img"/></center>
    </div>
</div>   
<p>â€ƒâ€ƒä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬çš„hwclockç¨‹åºæ˜¯å…·å¤‡CAP_SYS_TIMEçš„ï¼Œå› æ­¤ï¼ŒæŠ¥æƒé™æ‹’ç»çš„åœ°æ–¹å¹¶ä¸åœ¨è¿™é‡Œã€‚</p>
<p>â€ƒâ€ƒæˆ‘ä»¬æ¥ç€é€šè¿‡RTC_SET_TIMEï¼Œåœ¨å†…æ ¸ä»£ç çš„drivers/rtc/rtc-dev.cé‡Œé¢ï¼Œæœ‰å¦‚ä¸‹ç‰‡æ®µï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">rtc_dev_ioctl</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">file</span> <span class="token operator">*</span>file<span class="token punctuation">,</span>
                <span class="token keyword">unsigned</span> <span class="token keyword">int</span> cmd<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> arg<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// ... ...</span>
    <span class="token keyword">case</span> RTC_SET_TIME<span class="token operator">:</span>
            <span class="token function">mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rtc<span class="token operator">-></span>ops_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">copy_from_user</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tm<span class="token punctuation">,</span> uarg<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>tm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token operator">-</span>EFAULT<span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token function">rtc_set_time</span><span class="token punctuation">(</span>rtc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// ... ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒæˆ‘ä»¬ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡RTC_SET_TIMEï¼Œæˆ‘ä»¬æ‰§è¡Œrtc_set_timeæ­¤æ–¹æ³•ï¼Œç„¶åå¾—åˆ°äº†è¿”å›å€¼ï¼Œæˆ‘ä»¬æœ‰ç†ç”±æ€€ç–‘ï¼Œæˆ‘ä»¬å¾—åˆ°çš„æƒé™æ‹’ç»ï¼Œæ¥è‡ªäºè¿™ä¸ªåœ°æ–¹ã€‚</p>
<p>â€ƒâ€ƒåœ¨å†…æ ¸ä»£ç çš„drivers/rtc/interface.cé‡Œé¢ï¼Œæœ‰rtc_set_timeçš„å®šä¹‰ï¼Œå‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">rtc_set_time</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rtc_device</span> <span class="token operator">*</span>rtc<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">rtc_time</span> <span class="token operator">*</span>tm<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> err<span class="token punctuation">;</span>

        err <span class="token operator">=</span> <span class="token function">rtc_valid_tm</span><span class="token punctuation">(</span>tm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> err<span class="token punctuation">;</span>

        err <span class="token operator">=</span> <span class="token function">rtc_valid_range</span><span class="token punctuation">(</span>rtc<span class="token punctuation">,</span> tm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span>
                <span class="token keyword">return</span> err<span class="token punctuation">;</span>

        <span class="token function">rtc_subtract_offset</span><span class="token punctuation">(</span>rtc<span class="token punctuation">,</span> tm<span class="token punctuation">)</span><span class="token punctuation">;</span>

        err <span class="token operator">=</span> <span class="token function">mutex_lock_interruptible</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rtc<span class="token operator">-></span>ops_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span>
                <span class="token keyword">return</span> err<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rtc<span class="token operator">-></span>ops<span class="token punctuation">)</span>
                err <span class="token operator">=</span> <span class="token operator">-</span>ENODEV<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rtc<span class="token operator">-></span>ops<span class="token operator">-></span>set_time<span class="token punctuation">)</span>
                err <span class="token operator">=</span> rtc<span class="token operator">-></span>ops<span class="token operator">-></span><span class="token function">set_time</span><span class="token punctuation">(</span>rtc<span class="token operator">-></span>dev<span class="token punctuation">.</span>parent<span class="token punctuation">,</span> tm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rtc<span class="token operator">-></span>ops<span class="token operator">-></span>set_mmss64<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">time64_t</span> secs64 <span class="token operator">=</span> <span class="token function">rtc_tm_to_time64</span><span class="token punctuation">(</span>tm<span class="token punctuation">)</span><span class="token punctuation">;</span>

                err <span class="token operator">=</span> rtc<span class="token operator">-></span>ops<span class="token operator">-></span><span class="token function">set_mmss64</span><span class="token punctuation">(</span>rtc<span class="token operator">-></span>dev<span class="token punctuation">.</span>parent<span class="token punctuation">,</span> secs64<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rtc<span class="token operator">-></span>ops<span class="token operator">-></span>set_mmss<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">time64_t</span> secs64 <span class="token operator">=</span> <span class="token function">rtc_tm_to_time64</span><span class="token punctuation">(</span>tm<span class="token punctuation">)</span><span class="token punctuation">;</span>
                err <span class="token operator">=</span> rtc<span class="token operator">-></span>ops<span class="token operator">-></span><span class="token function">set_mmss</span><span class="token punctuation">(</span>rtc<span class="token operator">-></span>dev<span class="token punctuation">.</span>parent<span class="token punctuation">,</span> secs64<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span>
                err <span class="token operator">=</span> <span class="token operator">-</span>EINVAL<span class="token punctuation">;</span>

        <span class="token function">pm_stay_awake</span><span class="token punctuation">(</span>rtc<span class="token operator">-></span>dev<span class="token punctuation">.</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rtc<span class="token operator">-></span>ops_lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/* A timer might have just expired */</span>
        <span class="token function">schedule_work</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rtc<span class="token operator">-></span>irqwork<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">trace_rtc_set_time</span><span class="token punctuation">(</span><span class="token function">rtc_tm_to_time64</span><span class="token punctuation">(</span>tm<span class="token punctuation">)</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> err<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">EXPORT_SYMBOL_GPL</span><span class="token punctuation">(</span>rtc_set_time<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒä»è¿™æ®µä»£ç å¯çŸ¥ï¼ŒçœŸæ­£çš„é”™è¯¯è¿˜æ˜¯æ¥è‡ªäºrtc å…·ä½“é©±åŠ¨é‡Œé¢çš„xxx_set_time å‡½æ•°é‡Œé¢ã€‚åœ¨Linuxå†…æ ¸é‡Œé¢ï¼Œæœ‰è®¸å¤šçš„RTCé©±åŠ¨ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£åˆ°æˆ‘ä»¬çš„å½“å‰çš„RTCç¡¬ä»¶æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬é€šè¿‡logcat -b kernel |grep rtcå‘½ä»¤å¾—åˆ°äº†å¦‚ä¸‹çš„ä¿¡æ¯ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_125/kernel_msg.png" alt="rep_img"/></center>
    </div>
</div>   
<p>â€ƒâ€ƒå› æ­¤ï¼Œæˆ‘ä»¬å½“å‰çš„rtcé©±åŠ¨å°±æ˜¯rtc-pm8xxxï¼Œæˆ‘ä»¬å»æŸ¥æ‰¾ç›¸å…³çš„é©±åŠ¨æºç drivers/rtc/rtc-pm8xxx.cï¼Œå‘ç°äº†ä¸€ç‚¹ç«¯å€ªï¼Œå…¶set_timeæºç é‡ç‚¹ç‰‡æ®µå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">pm8xxx_rtc_set_time</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">rtc_time</span> <span class="token operator">*</span>tm<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// ... ...</span>
    <span class="token keyword">struct</span> <span class="token class-name">pm8xxx_rtc</span> <span class="token operator">*</span>rtc_dd <span class="token operator">=</span> <span class="token function">dev_get_drvdata</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... ...</span>
    
    <span class="token comment">// ... ...</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rtc_dd<span class="token operator">-></span>allow_set_time<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token operator">-</span>EACCES<span class="token punctuation">;</span>
    <span class="token comment">// ... ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒä»è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªé©±åŠ¨æœ‰ä¸€ä¸ªallow_set_timeçš„å‚æ•°ï¼Œå¦‚æœä¸å…è®¸ï¼Œå°±ä¼šè¿”å›æƒé™æ‹’ç»ï¼Œé‚£åˆ°åº•å¯ä¸å¯ä»¥å‘¢ï¼Ÿæˆ‘ä»¬å°è¯•å°†è¿™ä¸ªå±æ€§è®¾ç½®ä¸€ä¸‹ï¼Œæˆ–è€…ç›´æ¥ä¿®æ”¹å½“å‰çš„æºç ã€‚æˆ‘ä»¬å…¨å±€æŸ¥æ‰¾ä¸€ä¸‹è¿™ä¸ªå±æ€§ï¼Œå‘ç°å…¶æ¥è‡ªäºè¿™é‡Œï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">pm8xxx_rtc_probe</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">platform_device</span> <span class="token operator">*</span>pdev<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">// ... ...</span>
    <span class="token keyword">struct</span> <span class="token class-name">pm8xxx_rtc</span> <span class="token operator">*</span>rtc_dd<span class="token punctuation">;</span>

    <span class="token comment">// ... ...</span>
    rtc_dd <span class="token operator">=</span> <span class="token function">devm_kzalloc</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pdev<span class="token operator">-></span>dev<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>rtc_dd<span class="token punctuation">)</span><span class="token punctuation">,</span> GFP_KERNEL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rtc_dd <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token operator">-</span>ENOMEM<span class="token punctuation">;</span>
    <span class="token comment">// ... ...</span>
    rtc_dd<span class="token operator">-></span>allow_set_time <span class="token operator">=</span> <span class="token function">of_property_read_bool</span><span class="token punctuation">(</span>pdev<span class="token operator">-></span>dev<span class="token punctuation">.</span>of_node<span class="token punctuation">,</span>
                                                <span class="token string">"allow-set-time"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ... ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒä»è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å½“å‰è¿™ä¸ªrtc_dd-&gt;allow_set_timeæ¥è‡ªäºdtsé‡Œé¢ï¼Œä¸€ä¸ªå«åšallow-set-timeçš„å±æ€§ã€‚</p>
<p>â€ƒâ€ƒæˆ‘ä»¬é€šè¿‡pm8150_rtcå…¨å±€æœç´¢ï¼Œåœ¨æŸdtsiæ–‡ä»¶é‡Œé¢å‘ç°äº†æ­¤é©±åŠ¨çš„ç›¸å…³å®šä¹‰ï¼Œæˆ‘ä»¬ä¿®æ”¹è¿™ä¸ªå­—æ®µï¼Œæ·»åŠ allow-set-timeå±æ€§ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-dtsi" data-language="dtsi"><code class="language-dtsi">
pm8150_rtc: qcom,pm8150_rtc &#123;
        &#x2F;&#x2F; ... ...
        allow-set-time;
&#125;;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒç„¶åæˆ‘ä»¬é€šè¿‡é‡æ–°ç¼–è¯‘androidæºç ï¼Œé‡æ–°ç”Ÿæˆdtbo.imgé•œåƒï¼Œç„¶ååˆ·å…¥æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œç„¶åæˆ‘ä»¬æƒŠå¥‡çš„å‘ç°ï¼Œæˆ‘ä»¬è§£å†³äº†è¿™ä¸ªå¥‡æ€ªçš„permission deniedé—®é¢˜ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="åè®°">åè®°</h3>
<hr>
<p>â€ƒâ€ƒè™½ç„¶ï¼Œæˆ‘ä»¬è§£å†³äº†permission deniedé—®é¢˜ï¼Œä½†æ˜¯åç»­è¿˜æ˜¯å‡ºç°äº†rtcæ— æ³•æ­£å¸¸è®¾ç½®çš„é—®é¢˜ï¼Œé€šè¿‡å†…æ ¸æ—¥å¿—æŸ¥çœ‹ï¼Œæ˜¯pm8150é©±åŠ¨å‡ºäº†é—®é¢˜ï¼Œæœ€ååªèƒ½äº¤ç»™ä¸Šæ¸¸æ¿å¡å‚å®¶å»é€‚é…è§£å†³ã€‚</p>
<h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>æ— </p>
</li>
</ul>
<br/>
<br/>
<div style="margin:50px auto;">
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <hr/>
        <center><font color = #91e0b0 size = 5>æ‰“èµã€è®¢é˜…ã€æ”¶è—ã€ä¸¢é¦™è•‰ã€ç¡¬å¸ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ï¼ˆæ”»åŸç‹®çš„æ¬ç –ä¹‹è·¯ï¼‰</font></center>
    </div>
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg" alt="qrc_img"/></center>
    </div>
</div>
<!-- ![alt å…¬ä¼—å·å›¾ç‰‡](https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg "å…¬ä¼—å·å›¾ç‰‡") -->
<p><font color="red" size="7">PS: è¯·å°Šé‡åŸåˆ›ï¼Œä¸å–œå‹¿å–·ã€‚</font><br/><br>
<font color="red" size="7">PS: è¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: æœ‰é—®é¢˜è¯·ç•™è¨€ï¼Œçœ‹åˆ°åæˆ‘ä¼šç¬¬ä¸€æ—¶é—´å›å¤ã€‚</font><br/></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://e-x.top/2023/10/22/blog_idx_124/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Sky">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sky's Blogs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Sky's Blogs">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/10/22/blog_idx_124/" class="post-title-link" itemprop="url">è®°ä¸€æ¬¡æœ‰è¶£çš„ buffer overflow detected é—®é¢˜åˆ†æ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-10-22 19:22:00" itemprop="dateCreated datePublished" datetime="2023-10-22T19:22:00+08:00">2023-10-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-18 19:06:02" itemprop="dateModified" datetime="2024-05-18T19:06:02+08:00">2024-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-CPP/" itemprop="url" rel="index"><span itemprop="name">C&CPP</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-CPP/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-CPP/linux/%E5%B8%B8%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">å¸¸è¯†</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>2.8k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>10 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <script src="\assets\js\APlayer.min.js"> </script><!--
 * @Description: 
 * @Author: Sky
 * @Date: 2020-08-24 16:37:34
 * @LastEditors: Sky
 * @LastEditTime: 2021-06-29 15:04:48
 * @Github: https://github.com/flyinskyin2013/
-->
<p><font color="red" size="7">PSï¼šè¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: è¿™ä¸ªåªæ˜¯åŸºäºã€Šæˆ‘è‡ªå·±ã€‹çš„ç†è§£ï¼Œ</font><br/><font color="red" size="7">å¦‚æœå’Œä½ çš„åŸåˆ™åŠæƒ³æ³•ç›¸å†²çªï¼Œè¯·è°…è§£ï¼Œå‹¿å–·ã€‚</font><br/></p>
<!-- ###### å‰ç½®è¯´æ˜
&emsp;&emsp;æœ¬æ–‡ä½œä¸ºæœ¬äººgithub blog/cnblogçš„ä¸»ç«™çš„å¤‡ä»½ã€‚ï¼ˆBlogID=124ï¼‰ 
&emsp;&emsp;æœ¬æ–‡å‘å¸ƒäº  2023-10-22 19:22             ï¼ˆBlogID=124ï¼‰ 
-->
<h6 id="ç¯å¢ƒè¯´æ˜">ç¯å¢ƒè¯´æ˜</h6>
<p>â€ƒâ€ƒæ— </p>
<h3 id="å‰è¨€">å‰è¨€</h3>
<hr>
<p>â€ƒâ€ƒåœ¨æˆ‘å¼€å‘çš„ä¸€ä¸ªå®éªŒå’Œå­¦ä¹ åº“ä¸­ï¼Œåœ¨å¾ˆä¹…ä»¥å‰å…¨é¢å¯ç”¨äº†ç¼–è¯‘å™¨çš„sanitizeåŠŸèƒ½ã€‚</p>
<p>â€ƒâ€ƒè¿™æ¬¡æŠ¥é”™çš„ç¨‹åºï¼Œæ˜¯æˆ‘è¿™ä¸ªåº“ä¸­æŸä¸ªæ¨¡å—çš„å•å…ƒæµ‹è¯•æ¨¡å—ã€‚ä½†æ˜¯å‰é¢è¯´çš„éƒ½ä¸æ˜¯é‡ç‚¹ã€‚è¯¡å¼‚çš„æ˜¯æœ¬æ¬¡å‡ºç°çš„å•å…ƒæµ‹è¯•æ¨¡å—æ˜¯å¾ˆä¹…æœªåŠ¨çš„ä¸€ä¸ªæ¨¡å—ï¼Œè€Œä¸”åœ¨æœ¬åœ°çš„å•å…ƒæµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæ˜¯èƒ½å¤Ÿè¿è¡Œé€šè¿‡çš„ï¼Œä½†æ˜¯åœ¨githubçš„ciä¸Šé¢å‡ºé—®é¢˜äº†ã€‚</p>
<p>â€ƒâ€ƒé¦–å…ˆï¼ŒæŠ¥è¿™ä¸ªé”™è¯¯çš„åŸå› è‚¯å®šæ˜¯æˆ‘ä»¬çš„ç¨‹åºæœ‰é—®é¢˜ï¼Œä½†æ˜¯ä»¥å‰ç»“åˆè°ƒè¯•æ¨¡å¼+sanitizeåŠŸèƒ½åŸºæœ¬èƒ½å¤ŸæŠŠé—®é¢˜æ’é™¤äº†ï¼Œç»“åˆäº†githubçš„ciå‡ºç°é—®é¢˜ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯ç”±äºGCCç‰ˆæœ¬å‡çº§åï¼Œå¯¹äºæ ˆæº¢å‡ºçš„æ£€æŸ¥æ›´åŠ å‡†ç¡®äº†ã€‚</p>
<p>â€ƒâ€ƒæ­¤å¤–ç”±äºæ­¤æŠ¥é”™æ˜¯å­˜åœ¨åœ¨ä¸€ä¸ªreleaseç‰ˆæœ¬çš„æ¨¡å—ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½å¤Ÿé‡‡å–é€šç”¨çš„é€šè¿‡ä»£ç è¡Œæ¥å®šä½é—®é¢˜çš„æ–¹æ³•ã€‚</p>
<h3 id="é—®é¢˜åˆæ­¥å®šä½">é—®é¢˜åˆæ­¥å®šä½</h3>
<hr>
<p>â€ƒâ€ƒé¦–å…ˆgdb åˆæ­¥åˆ†æå®šä½ï¼Œå®šä½åˆ°å¦‚ä¸‹åœ°å€ï¼š</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">#<span class="token number">4</span>  <span class="token number">0x00007ffff6a4db81</span> in <span class="token function">__GI___fortify_fail</span> <span class="token punctuation">(</span>msg<span class="token operator">=</span>msg@entry<span class="token operator">=</span><span class="token number">0x7ffff6acf7e6</span> <span class="token string">"buffer overflow detected"</span><span class="token punctuation">)</span> at fortify_fail<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">44</span>
#<span class="token number">5</span>  <span class="token number">0x00007ffff6a4b870</span> in <span class="token function">__GI___chk_fail</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> at chk_fail<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">28</span>
#<span class="token number">6</span>  <span class="token number">0x00007ffff79c06fc</span> in <span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> from <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>lib<span class="token operator">/</span>libylib<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ä»è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬åœ¨æ‰§è¡Œ0x00007ffff79c06fcå‰é¢çš„ä¸€ä¸ªæŒ‡ä»¤çš„æ—¶å€™å‡ºç°äº†&quot;buffer overflow detected&quot;ã€‚ç„¶åæˆ‘ä»¬é€šè¿‡layout asmæŸ¥çœ‹æ±‡ç¼–æŒ‡ä»¤ï¼Œæ‰¾åˆ°å‰é¢ä¸€è¡ŒæŒ‡ä»¤å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token number">0x7ffff79c06f2</span><span class="token operator">:</span>	b9 <span class="token number">00</span> <span class="token number">10</span> <span class="token number">00</span> <span class="token number">00</span>       	mov    $<span class="token number">0x1000</span><span class="token punctuation">,</span><span class="token operator">%</span>ecx
<span class="token number">0x7ffff79c06f7</span><span class="token operator">:</span>	e8 <span class="token number">44</span> <span class="token number">1</span>e fe ff       	callq  <span class="token number">58540</span> <span class="token operator">&lt;</span>__memset_chk@plt<span class="token operator">></span>
<span class="token number">0x7ffff79c06fc</span><span class="token operator">:</span>	<span class="token number">4</span>c <span class="token number">89</span> e2             	mov    <span class="token operator">%</span>r12<span class="token punctuation">,</span><span class="token operator">%</span>rdx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒå…¶å®åˆ°äº†è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸€äº›æ‰‹æ®µï¼Œå¯ä»¥æŸ¥åˆ°æ˜¯memsetå¯¼è‡´äº†æˆ‘ä»¬çš„åŸå› ï¼Œå¦‚æœè¦æ˜¯å¯ä»¥è¿›è¡Œæºç è°ƒè¯•çš„è¯ï¼Œæˆ‘ä»¬ç”šè‡³é©¬ä¸Šå°±èƒ½å¤Ÿå®šä½æ˜¯å“ªä¸€è¡Œå¯¼è‡´çš„ã€‚</p>
<p>â€ƒâ€ƒä½†æ˜¯ä»Šå¤©è¿™é‡Œæä¾›ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥å¤æ‚å®šä½ï¼ˆå…¼å®¹ä¸€ä¸ªåº“é‡Œé¢å¤šä¸ªmemsetè°ƒç”¨ï¼Œå…¼å®¹releaseç‰ˆæœ¬è°ƒè¯•ç­‰ç­‰ï¼‰æˆ‘ä»¬å‡ºé”™è¿™è¡Œæ±‡ç¼–åœ¨æˆ‘ä»¬æºç ä¸­çš„å¤§æ¦‚ä½ç½®ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="é—®é¢˜åˆæ­¥å®šä½-2">é—®é¢˜åˆæ­¥å®šä½</h3>
<hr>
<p>â€ƒâ€ƒé¦–å…ˆï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹å½“å‰æˆ‘ä»¬è¿™ä¸ªsoæ–‡ä»¶åœ¨å†…å­˜ä¸­çš„æ˜ å°„ä½ç½®ï¼š</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">    Start Addr           End Addr       Size     Offset objfile
<span class="token number">0x7ffff794a000</span>     <span class="token number">0x7ffff7bc2000</span>   <span class="token number">0x278000</span>        <span class="token number">0x0</span> <span class="token operator">/</span>xxx<span class="token operator">/</span>libylib<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">.</span><span class="token number">0</span>
<span class="token number">0x7ffff7bc2000</span>     <span class="token number">0x7ffff7dc2000</span>   <span class="token number">0x200000</span>   <span class="token number">0x278000</span> <span class="token operator">/</span>xxx<span class="token operator">/</span>libylib<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">.</span><span class="token number">0</span>
<span class="token number">0x7ffff7dc2000</span>     <span class="token number">0x7ffff7dcc000</span>     <span class="token number">0xa000</span>   <span class="token number">0x278000</span> <span class="token operator">/</span>xxx<span class="token operator">/</span>libylib<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">.</span><span class="token number">0</span>
<span class="token number">0x7ffff7dcc000</span>     <span class="token number">0x7ffff7dd1000</span>     <span class="token number">0x5000</span>   <span class="token number">0x282000</span> <span class="token operator">/</span>xxx<span class="token operator">/</span>libylib<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">.</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒé¦–å…ˆæˆ‘ä»¬å¯ä»¥åˆ†æå‡º0x7ffff79c06f7æ˜¯å­˜åœ¨åœ¨å†…å­˜æ˜ å°„0x7ffff794a000~0x7ffff7bc2000åŒºæ®µä¸­çš„ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜çŸ¥é“äº†ä¸€ä¸ªé‡è¦çš„æ¶ˆæ¯æ˜¯ï¼Œå½“å‰æˆ‘ä»¬å…³æ³¨çš„0x7ffff79c06f7åœ¨soä¸­çš„åç§»åœ°å€æ˜¯0x7ffff79c06f7-0x7ffff794a000=0x766F7ã€‚</p>
<p>â€ƒâ€ƒè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡objdump -då¯¹libylib.so.0.1.0è¿›è¡Œåç¼–è¯‘åˆ†æã€‚æ³¨æ„ï¼Œè¿™é‡Œè¦å¾€æˆ‘ä»¬å…³æ³¨çš„0x766F7åç§»å‰é¢å»å¯»æ‰¾ï¼Œè€Œä¸”è¿˜è¦åå¤å»å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ç±»ä¼¼å‡½æ•°çš„è¾¹ç•Œï¼ˆè¿™é‡Œæˆ‘å»ºè®®æ–°æ‰‹ç›´æ¥ä¸Šidaï¼Œå¿«é€Ÿè§£å†³é—®é¢˜ï¼‰ï¼Œä¸€èˆ¬æ¥è¯´å°±æ˜¯æ‰¾å‡½æ•°å¸§ï¼Œå¦‚æœå¯¹è¿™ä¸ªä¸ç†Ÿæ‚‰ï¼Œå»ºè®®ä½¿ç”¨idaç­‰å·¥å…·è¿›è¡Œåˆ†æï¼Œå¯èƒ½æ›´åŠ æ–¹ä¾¿ã€‚</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">libylib<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">:</span>     file format elf64<span class="token operator">-</span>x86<span class="token operator">-</span><span class="token number">64</span>


Disassembly of section <span class="token punctuation">.</span>text<span class="token operator">:</span>

<span class="token number">00000000000764</span>d0 <span class="token operator">&lt;</span>_ZNSt6vectorIhSaIhEE17_M_default_appendEm@@Base<span class="token operator">+</span><span class="token number">0x2b0</span><span class="token operator">></span><span class="token operator">:</span>
   <span class="token number">764</span>d0<span class="token operator">:</span>	<span class="token function">fe</span>                   	<span class="token punctuation">(</span>bad<span class="token punctuation">)</span>  
   <span class="token number">764</span>d1<span class="token operator">:</span>	fd                   	std    
   <span class="token number">764</span>d2<span class="token operator">:</span>	ff <span class="token number">90</span> <span class="token number">66</span> <span class="token number">90</span> <span class="token number">66</span> <span class="token number">2</span>e    	callq  <span class="token operator">*</span><span class="token number">0x2e669066</span><span class="token punctuation">(</span><span class="token operator">%</span>rax<span class="token punctuation">)</span>
   <span class="token number">764</span>d8<span class="token operator">:</span>	<span class="token number">0f</span> <span class="token number">1f</span> <span class="token number">84</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> 	nopl   <span class="token number">0x0</span><span class="token punctuation">(</span><span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
   <span class="token number">764</span>df<span class="token operator">:</span>	<span class="token number">00</span> 

<span class="token number">00000000000764e0</span> <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">></span><span class="token operator">:</span>
   <span class="token number">764e0</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>b <span class="token number">05</span> <span class="token number">81</span> b4 <span class="token number">40</span> <span class="token number">00</span> 	mov    <span class="token number">0x40b481</span><span class="token punctuation">(</span><span class="token operator">%</span>rip<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rax        # <span class="token number">481968</span> <span class="token operator">&lt;</span>_ZN4yLib6yShell10class_infoE@@Base<span class="token operator">-</span><span class="token number">0x5058</span><span class="token operator">></span>
   <span class="token number">764e7</span><span class="token operator">:</span>	c3                   	retq   
   <span class="token number">764e8</span><span class="token operator">:</span>	<span class="token number">0f</span> <span class="token number">1f</span> <span class="token number">84</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> 	nopl   <span class="token number">0x0</span><span class="token punctuation">(</span><span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
   <span class="token number">764</span>ef<span class="token operator">:</span>	<span class="token number">00</span> 
   <span class="token comment">//æ³¨æ„è¿™é‡Œå¼€å§‹</span>
   <span class="token number">764f</span>0<span class="token operator">:</span>	<span class="token number">41</span> <span class="token number">57</span>                	push   <span class="token operator">%</span>r15
   <span class="token number">764f</span>2<span class="token operator">:</span>	<span class="token number">41</span> <span class="token number">56</span>                	push   <span class="token operator">%</span>r14
   <span class="token number">764f</span>4<span class="token operator">:</span>	<span class="token number">49</span> <span class="token number">89</span> fe             	mov    <span class="token operator">%</span>rdi<span class="token punctuation">,</span><span class="token operator">%</span>r14
   <span class="token number">764f</span>7<span class="token operator">:</span>	<span class="token number">41</span> <span class="token number">55</span>                	push   <span class="token operator">%</span>r13
   <span class="token number">764f</span>9<span class="token operator">:</span>	<span class="token number">41</span> <span class="token number">54</span>                	push   <span class="token operator">%</span>r12
   <span class="token number">764f</span>b<span class="token operator">:</span>	<span class="token number">55</span>                   	push   <span class="token operator">%</span>rbp
   <span class="token number">764f</span>c<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> d5             	mov    <span class="token operator">%</span>rdx<span class="token punctuation">,</span><span class="token operator">%</span>rbp
   <span class="token number">764ff</span><span class="token operator">:</span>	<span class="token number">53</span>                   	push   <span class="token operator">%</span>rbx
   <span class="token number">76500</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">81</span> ec a8 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> 	sub    $<span class="token number">0xa8</span><span class="token punctuation">,</span><span class="token operator">%</span>rsp
   <span class="token number">76507</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>b <span class="token number">56</span> <span class="token number">08</span>          	mov    <span class="token number">0x8</span><span class="token punctuation">(</span><span class="token operator">%</span>rsi<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rdx
   <span class="token number">7650</span>b<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">2</span>b <span class="token number">16</span>             	<span class="token function">sub</span>    <span class="token punctuation">(</span><span class="token operator">%</span>rsi<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rdx
   <span class="token number">7650</span>e<span class="token operator">:</span>	<span class="token number">64</span> <span class="token number">48</span> <span class="token number">8</span>b <span class="token number">04</span> <span class="token number">25</span> <span class="token number">28</span> <span class="token number">00</span> 	mov    <span class="token operator">%</span>fs<span class="token operator">:</span><span class="token number">0x28</span><span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">76515</span><span class="token operator">:</span>	<span class="token number">00</span> <span class="token number">00</span> 
   <span class="token number">76517</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> <span class="token number">84</span> <span class="token number">24</span> <span class="token number">98</span> <span class="token number">00</span> <span class="token number">00</span> 	mov    <span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token number">0x98</span><span class="token punctuation">(</span><span class="token operator">%</span>rsp<span class="token punctuation">)</span>
   <span class="token number">7651</span>e<span class="token operator">:</span>	<span class="token number">00</span> 
   <span class="token number">7651f</span><span class="token operator">:</span>	<span class="token number">31</span> c0                	<span class="token operator">xor</span>    <span class="token operator">%</span>eax<span class="token punctuation">,</span><span class="token operator">%</span>eax
   <span class="token number">76521</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>b <span class="token number">47</span> <span class="token number">08</span>          	mov    <span class="token number">0x8</span><span class="token punctuation">(</span><span class="token operator">%</span>rdi<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">76525</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">2</span>b <span class="token number">07</span>             	<span class="token function">sub</span>    <span class="token punctuation">(</span><span class="token operator">%</span>rdi<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">76528</span><span class="token operator">:</span>	<span class="token number">48</span> c1 fa <span class="token number">05</span>          	sar    $<span class="token number">0x5</span><span class="token punctuation">,</span><span class="token operator">%</span>rdx
   <span class="token number">7652</span>c<span class="token operator">:</span>	<span class="token number">48</span> c1 f8 <span class="token number">05</span>          	sar    $<span class="token number">0x5</span><span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">76530</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>d <span class="token number">7</span>c <span class="token number">02</span> <span class="token number">01</span>       	lea    <span class="token number">0x1</span><span class="token punctuation">(</span><span class="token operator">%</span>rdx<span class="token punctuation">,</span><span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rdi
   <span class="token number">76535</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> f8             	mov    <span class="token operator">%</span>rdi<span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">76538</span><span class="token operator">:</span>	<span class="token number">48</span> c1 e8 <span class="token number">3</span>c          	shr    $<span class="token number">0x3c</span><span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">7653</span>c<span class="token operator">:</span>	<span class="token number">0f</span> <span class="token number">85</span> <span class="token number">67</span> <span class="token number">54</span> fe ff    	jne    <span class="token number">5</span>b9a9 <span class="token operator">&lt;</span>fwrite@plt<span class="token operator">+</span><span class="token number">0x1221</span><span class="token operator">></span>
   <span class="token number">76542</span><span class="token operator">:</span>	<span class="token number">48</span> c1 e7 <span class="token number">03</span>          	shl    $<span class="token number">0x3</span><span class="token punctuation">,</span><span class="token operator">%</span>rdi
   <span class="token number">76546</span><span class="token operator">:</span>	<span class="token number">49</span> <span class="token number">89</span> f4             	mov    <span class="token operator">%</span>rsi<span class="token punctuation">,</span><span class="token operator">%</span>r12
   <span class="token number">76549</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> cb             	mov    <span class="token operator">%</span>rcx<span class="token punctuation">,</span><span class="token operator">%</span>rbx
   <span class="token number">7654</span>c<span class="token operator">:</span>	e8 <span class="token number">2f</span> dc fd ff       	callq  <span class="token number">54180</span> <span class="token operator">&lt;</span>_Znam@plt<span class="token operator">></span>
   <span class="token number">76551</span><span class="token operator">:</span>	<span class="token number">49</span> <span class="token number">8</span>b <span class="token number">7</span>e <span class="token number">08</span>          	mov    <span class="token number">0x8</span><span class="token punctuation">(</span><span class="token operator">%</span>r14<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rdi
   <span class="token number">76555</span><span class="token operator">:</span>	<span class="token number">49</span> <span class="token number">8</span>b <span class="token number">14</span> <span class="token number">24</span>          	<span class="token function">mov</span>    <span class="token punctuation">(</span><span class="token operator">%</span>r12<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rdx
   <span class="token number">76559</span><span class="token operator">:</span>	<span class="token number">49</span> <span class="token number">89</span> c5             	mov    <span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>r13
   <span class="token number">7655</span>c<span class="token operator">:</span>	<span class="token number">49</span> <span class="token number">8</span>b <span class="token number">74</span> <span class="token number">24</span> <span class="token number">08</span>       	mov    <span class="token number">0x8</span><span class="token punctuation">(</span><span class="token operator">%</span>r12<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rsi
   <span class="token number">76561</span><span class="token operator">:</span>	<span class="token number">49</span> <span class="token number">8</span>b <span class="token number">06</span>             	<span class="token function">mov</span>    <span class="token punctuation">(</span><span class="token operator">%</span>r14<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">76564</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">29</span> d6             	sub    <span class="token operator">%</span>rdx<span class="token punctuation">,</span><span class="token operator">%</span>rsi
   <span class="token number">76567</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">29</span> c7             	sub    <span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>rdi
   <span class="token number">7656</span>a<span class="token operator">:</span>	<span class="token number">49</span> <span class="token number">89</span> f9             	mov    <span class="token operator">%</span>rdi<span class="token punctuation">,</span><span class="token operator">%</span>r9
   <span class="token number">7656</span>d<span class="token operator">:</span>	<span class="token number">49</span> <span class="token number">89</span> f2             	mov    <span class="token operator">%</span>rsi<span class="token punctuation">,</span><span class="token operator">%</span>r10
   <span class="token number">76570</span><span class="token operator">:</span>	<span class="token number">49</span> <span class="token number">89</span> f0             	mov    <span class="token operator">%</span>rsi<span class="token punctuation">,</span><span class="token operator">%</span>r8
   <span class="token number">76573</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">01</span> c7             	add    <span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>rdi
   <span class="token number">76576</span><span class="token operator">:</span>	<span class="token number">49</span> c1 f9 <span class="token number">05</span>          	sar    $<span class="token number">0x5</span><span class="token punctuation">,</span><span class="token operator">%</span>r9
   <span class="token number">7657</span>a<span class="token operator">:</span>	<span class="token number">49</span> c1 fa <span class="token number">05</span>          	sar    $<span class="token number">0x5</span><span class="token punctuation">,</span><span class="token operator">%</span>r10
   <span class="token number">7657</span>e<span class="token operator">:</span>	<span class="token number">4</span>b <span class="token number">8</span>d <span class="token number">0</span>c <span class="token number">11</span>          	<span class="token function">lea</span>    <span class="token punctuation">(</span><span class="token operator">%</span>r9<span class="token punctuation">,</span><span class="token operator">%</span>r10<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rcx
   <span class="token number">76582</span><span class="token operator">:</span>	<span class="token number">49</span> c7 <span class="token number">44</span> cd <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> 	movq   $<span class="token number">0x0</span><span class="token punctuation">,</span><span class="token number">0x0</span><span class="token punctuation">(</span><span class="token operator">%</span>r13<span class="token punctuation">,</span><span class="token operator">%</span>rcx<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span>
   <span class="token number">76589</span><span class="token operator">:</span>	<span class="token number">00</span> <span class="token number">00</span> 
   <span class="token number">7658</span>b<span class="token operator">:</span>	<span class="token number">4</span>c <span class="token number">89</span> e9             	mov    <span class="token operator">%</span>r13<span class="token punctuation">,</span><span class="token operator">%</span>rcx
   <span class="token number">7658</span>e<span class="token operator">:</span>	<span class="token number">4</span>d <span class="token number">85</span> c9             	test   <span class="token operator">%</span>r9<span class="token punctuation">,</span><span class="token operator">%</span>r9
   <span class="token number">76591</span><span class="token operator">:</span>	<span class="token number">74</span> <span class="token number">19</span>                	je     <span class="token number">765</span>ac <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">+</span><span class="token number">0xcc</span><span class="token operator">></span>
   <span class="token number">76593</span><span class="token operator">:</span>	<span class="token number">0f</span> <span class="token number">1f</span> <span class="token number">44</span> <span class="token number">00</span> <span class="token number">00</span>       	nopl   <span class="token number">0x0</span><span class="token punctuation">(</span><span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
   <span class="token number">76598</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>b <span class="token number">30</span>             	<span class="token function">mov</span>    <span class="token punctuation">(</span><span class="token operator">%</span>rax<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rsi
   <span class="token number">7659</span>b<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">83</span> c0 <span class="token number">20</span>          	add    $<span class="token number">0x20</span><span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">7659f</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">83</span> c1 <span class="token number">08</span>          	add    $<span class="token number">0x8</span><span class="token punctuation">,</span><span class="token operator">%</span>rcx
   <span class="token number">765</span>a3<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> <span class="token number">71</span> f8          	mov    <span class="token operator">%</span>rsi<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x8</span><span class="token punctuation">(</span><span class="token operator">%</span>rcx<span class="token punctuation">)</span>
   <span class="token number">765</span>a7<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">39</span> c7             	cmp    <span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>rdi
   <span class="token number">765</span>aa<span class="token operator">:</span>	<span class="token number">75</span> ec                	jne    <span class="token number">76598</span> <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">+</span><span class="token number">0xb8</span><span class="token operator">></span>
   <span class="token number">765</span>ac<span class="token operator">:</span>	<span class="token number">4</span>d <span class="token number">85</span> d2             	test   <span class="token operator">%</span>r10<span class="token punctuation">,</span><span class="token operator">%</span>r10
   <span class="token number">765</span>af<span class="token operator">:</span>	<span class="token number">74</span> <span class="token number">23</span>                	je     <span class="token number">765</span>d4 <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">+</span><span class="token number">0xf4</span><span class="token operator">></span>
   <span class="token number">765</span>b1<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> d0             	mov    <span class="token operator">%</span>rdx<span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">765</span>b4<span class="token operator">:</span>	<span class="token number">4</span>b <span class="token number">8</span>d <span class="token number">54</span> cd <span class="token number">00</span>       	lea    <span class="token number">0x0</span><span class="token punctuation">(</span><span class="token operator">%</span>r13<span class="token punctuation">,</span><span class="token operator">%</span>r9<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rdx
   <span class="token number">765</span>b9<span class="token operator">:</span>	<span class="token number">4</span>a <span class="token number">8</span>d <span class="token number">34</span> <span class="token number">00</span>          	<span class="token function">lea</span>    <span class="token punctuation">(</span><span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>r8<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rsi
   <span class="token number">765</span>bd<span class="token operator">:</span>	<span class="token number">0f</span> <span class="token number">1f</span> <span class="token number">00</span>             	<span class="token function">nopl</span>   <span class="token punctuation">(</span><span class="token operator">%</span>rax<span class="token punctuation">)</span>
   <span class="token number">765</span>c0<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>b <span class="token number">08</span>             	<span class="token function">mov</span>    <span class="token punctuation">(</span><span class="token operator">%</span>rax<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rcx
   <span class="token number">765</span>c3<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">83</span> c0 <span class="token number">20</span>          	add    $<span class="token number">0x20</span><span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">765</span>c7<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">83</span> c2 <span class="token number">08</span>          	add    $<span class="token number">0x8</span><span class="token punctuation">,</span><span class="token operator">%</span>rdx
   <span class="token number">765</span>cb<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> <span class="token number">4</span>a f8          	mov    <span class="token operator">%</span>rcx<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x8</span><span class="token punctuation">(</span><span class="token operator">%</span>rdx<span class="token punctuation">)</span>
   <span class="token number">765</span>cf<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">39</span> f0             	cmp    <span class="token operator">%</span>rsi<span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">765</span>d2<span class="token operator">:</span>	<span class="token number">75</span> ec                	jne    <span class="token number">765</span>c0 <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">+</span><span class="token number">0xe0</span><span class="token operator">></span>
   <span class="token number">765</span>d4<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>b <span class="token number">7</span>d <span class="token number">08</span>          	mov    <span class="token number">0x8</span><span class="token punctuation">(</span><span class="token operator">%</span>rbp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rdi
   <span class="token number">765</span>d8<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">2</span>b <span class="token number">7</span>d <span class="token number">00</span>          	sub    <span class="token number">0x0</span><span class="token punctuation">(</span><span class="token operator">%</span>rbp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rdi
   <span class="token number">765</span>dc<span class="token operator">:</span>	<span class="token number">48</span> c1 ff <span class="token number">05</span>          	sar    $<span class="token number">0x5</span><span class="token punctuation">,</span><span class="token operator">%</span>rdi
   <span class="token number">765e0</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">83</span> c7 <span class="token number">01</span>          	add    $<span class="token number">0x1</span><span class="token punctuation">,</span><span class="token operator">%</span>rdi
   <span class="token number">765e4</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> f8             	mov    <span class="token operator">%</span>rdi<span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">765e7</span><span class="token operator">:</span>	<span class="token number">48</span> c1 e8 <span class="token number">3</span>c          	shr    $<span class="token number">0x3c</span><span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">765</span>eb<span class="token operator">:</span>	<span class="token number">0f</span> <span class="token number">85</span> <span class="token number">93</span> <span class="token number">0</span>a <span class="token number">00</span> <span class="token number">00</span>    	jne    <span class="token number">77084</span> <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">+</span><span class="token number">0xba4</span><span class="token operator">></span>
   <span class="token number">765f</span>1<span class="token operator">:</span>	<span class="token number">48</span> c1 e7 <span class="token number">03</span>          	shl    $<span class="token number">0x3</span><span class="token punctuation">,</span><span class="token operator">%</span>rdi
   <span class="token number">765f</span>5<span class="token operator">:</span>	e8 <span class="token number">86</span> db fd ff       	callq  <span class="token number">54180</span> <span class="token operator">&lt;</span>_Znam@plt<span class="token operator">></span>
   <span class="token number">765f</span>a<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>b <span class="token number">75</span> <span class="token number">08</span>          	mov    <span class="token number">0x8</span><span class="token punctuation">(</span><span class="token operator">%</span>rbp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rsi
   <span class="token number">765f</span>e<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> c2             	mov    <span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>rdx
   <span class="token number">76601</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> <span class="token number">44</span> <span class="token number">24</span> <span class="token number">08</span>       	mov    <span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token number">0x8</span><span class="token punctuation">(</span><span class="token operator">%</span>rsp<span class="token punctuation">)</span>
   <span class="token number">76606</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>b <span class="token number">45</span> <span class="token number">00</span>          	mov    <span class="token number">0x0</span><span class="token punctuation">(</span><span class="token operator">%</span>rbp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">7660</span>a<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">29</span> c6             	sub    <span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>rsi
   <span class="token number">7660</span>d<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> f1             	mov    <span class="token operator">%</span>rsi<span class="token punctuation">,</span><span class="token operator">%</span>rcx
   <span class="token number">76610</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">01</span> c6             	add    <span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>rsi
   <span class="token number">76613</span><span class="token operator">:</span>	<span class="token number">48</span> c1 f9 <span class="token number">05</span>          	sar    $<span class="token number">0x5</span><span class="token punctuation">,</span><span class="token operator">%</span>rcx
   <span class="token number">76617</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>d <span class="token number">3</span>c ca          	<span class="token function">lea</span>    <span class="token punctuation">(</span><span class="token operator">%</span>rdx<span class="token punctuation">,</span><span class="token operator">%</span>rcx<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rdi
   <span class="token number">7661</span>b<span class="token operator">:</span>	<span class="token number">48</span> c7 <span class="token number">07</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> 	movq   $<span class="token number">0x0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">%</span>rdi<span class="token punctuation">)</span>
   <span class="token number">76622</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">85</span> c9             	test   <span class="token operator">%</span>rcx<span class="token punctuation">,</span><span class="token operator">%</span>rcx
   <span class="token number">76625</span><span class="token operator">:</span>	<span class="token number">74</span> <span class="token number">1</span>d                	je     <span class="token number">76644</span> <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">+</span><span class="token number">0x164</span><span class="token operator">></span>
   <span class="token number">76627</span><span class="token operator">:</span>	<span class="token number">66</span> <span class="token number">0f</span> <span class="token number">1f</span> <span class="token number">84</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> 	nopw   <span class="token number">0x0</span><span class="token punctuation">(</span><span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
   <span class="token number">7662</span>e<span class="token operator">:</span>	<span class="token number">00</span> <span class="token number">00</span> 
   <span class="token number">76630</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>b <span class="token number">08</span>             	<span class="token function">mov</span>    <span class="token punctuation">(</span><span class="token operator">%</span>rax<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rcx
   <span class="token number">76633</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">83</span> c0 <span class="token number">20</span>          	add    $<span class="token number">0x20</span><span class="token punctuation">,</span><span class="token operator">%</span>rax
   <span class="token number">76637</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">83</span> c2 <span class="token number">08</span>          	add    $<span class="token number">0x8</span><span class="token punctuation">,</span><span class="token operator">%</span>rdx
   <span class="token number">7663</span>b<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> <span class="token number">4</span>a f8          	mov    <span class="token operator">%</span>rcx<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x8</span><span class="token punctuation">(</span><span class="token operator">%</span>rdx<span class="token punctuation">)</span>
   <span class="token number">7663f</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">39</span> c6             	cmp    <span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>rsi
   <span class="token number">76642</span><span class="token operator">:</span>	<span class="token number">75</span> ec                	jne    <span class="token number">76630</span> <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">+</span><span class="token number">0x150</span><span class="token operator">></span>
   <span class="token number">76644</span><span class="token operator">:</span>	<span class="token number">48</span> c7 <span class="token number">07</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> 	movq   $<span class="token number">0x0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">%</span>rdi<span class="token punctuation">)</span>
   <span class="token number">7664</span>b<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>b <span class="token number">35</span> <span class="token number">06</span> b2 <span class="token number">40</span> <span class="token number">00</span> 	mov    <span class="token number">0x40b206</span><span class="token punctuation">(</span><span class="token operator">%</span>rip<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rsi        # <span class="token number">481858</span> <span class="token operator">&lt;</span>_ZSt7nothrow@GLIBCXX_3<span class="token punctuation">.</span><span class="token number">4</span><span class="token operator">></span>
   <span class="token number">76652</span><span class="token operator">:</span>	bf <span class="token number">00</span> <span class="token number">10</span> <span class="token number">00</span> <span class="token number">00</span>       	mov    $<span class="token number">0x1000</span><span class="token punctuation">,</span><span class="token operator">%</span>edi
   <span class="token number">76657</span><span class="token operator">:</span>	e8 b4 <span class="token number">2</span>d fe ff       	callq  <span class="token number">59410</span> <span class="token operator">&lt;</span>_ZnamRKSt9nothrow_t@plt<span class="token operator">></span>
   <span class="token number">7665</span>c<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>d <span class="token number">7</span>c <span class="token number">24</span> <span class="token number">28</span>       	lea    <span class="token number">0x28</span><span class="token punctuation">(</span><span class="token operator">%</span>rsp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rdi
   <span class="token number">76661</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> c5             	mov    <span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>rbp
   <span class="token number">76664</span><span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>b <span class="token number">05</span> <span class="token number">5</span>d <span class="token number">1</span>c <span class="token number">1</span>a <span class="token number">00</span> 	mov    <span class="token number">0x1a1c5d</span><span class="token punctuation">(</span><span class="token operator">%</span>rip<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rax        # <span class="token number">2182</span>c8 <span class="token operator">&lt;</span>_ZTSNSt6thread11_State_implINS_8_InvokerISt5tupleIJMN4yLib11yThreadPoolEFvvEPS4_EEEEEE@@Base<span class="token operator">+</span><span class="token number">0x4e8</span><span class="token operator">></span>
   <span class="token number">7666</span>b<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> <span class="token number">44</span> <span class="token number">24</span> <span class="token number">28</span>       	mov    <span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token number">0x28</span><span class="token punctuation">(</span><span class="token operator">%</span>rsp<span class="token punctuation">)</span>
   <span class="token number">76670</span><span class="token operator">:</span>	e8 fb <span class="token number">1</span>c fe ff       	callq  <span class="token number">58370</span> <span class="token operator">&lt;</span>pipe@plt<span class="token operator">></span>
   <span class="token number">76675</span><span class="token operator">:</span>	<span class="token number">85</span> c0                	test   <span class="token operator">%</span>eax<span class="token punctuation">,</span><span class="token operator">%</span>eax
   <span class="token number">76677</span><span class="token operator">:</span>	<span class="token number">0f</span> <span class="token number">88</span> <span class="token number">69</span> <span class="token number">03</span> <span class="token number">00</span> <span class="token number">00</span>    	js     <span class="token number">769e6</span> <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">+</span><span class="token number">0x506</span><span class="token operator">></span>
   <span class="token number">7667</span>d<span class="token operator">:</span>	e8 <span class="token number">4</span>e e5 fd ff       	callq  <span class="token number">54</span>bd0 <span class="token operator">&lt;</span>fork@plt<span class="token operator">></span>
   <span class="token number">76682</span><span class="token operator">:</span>	<span class="token number">41</span> <span class="token number">89</span> c4             	mov    <span class="token operator">%</span>eax<span class="token punctuation">,</span><span class="token operator">%</span>r12d
   <span class="token number">76685</span><span class="token operator">:</span>	<span class="token number">85</span> c0                	test   <span class="token operator">%</span>eax<span class="token punctuation">,</span><span class="token operator">%</span>eax
   <span class="token number">76687</span><span class="token operator">:</span>	<span class="token number">0f</span> <span class="token number">88</span> <span class="token number">08</span> <span class="token number">07</span> <span class="token number">00</span> <span class="token number">00</span>    	js     <span class="token number">76</span>d95 <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">+</span><span class="token number">0x8b5</span><span class="token operator">></span>
   <span class="token number">7668</span>d<span class="token operator">:</span>	<span class="token number">0f</span> <span class="token number">84</span> <span class="token number">1</span>d <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span>    	je     <span class="token number">767</span>b0 <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">+</span><span class="token number">0x2d0</span><span class="token operator">></span>
   <span class="token number">76693</span><span class="token operator">:</span>	<span class="token number">8</span>b <span class="token number">7</span>c <span class="token number">24</span> <span class="token number">2</span>c          	mov    <span class="token number">0x2c</span><span class="token punctuation">(</span><span class="token operator">%</span>rsp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>edi
   <span class="token number">76697</span><span class="token operator">:</span>	e8 <span class="token number">24</span> <span class="token number">3</span>e fe ff       	callq  <span class="token number">5</span>a4c0 <span class="token operator">&lt;</span>close@plt<span class="token operator">></span>
   <span class="token number">7669</span>c<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>d <span class="token number">74</span> <span class="token number">24</span> <span class="token number">1</span>c       	lea    <span class="token number">0x1c</span><span class="token punctuation">(</span><span class="token operator">%</span>rsp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rsi
   <span class="token number">766</span>a1<span class="token operator">:</span>	<span class="token number">31</span> d2                	<span class="token operator">xor</span>    <span class="token operator">%</span>edx<span class="token punctuation">,</span><span class="token operator">%</span>edx
   <span class="token number">766</span>a3<span class="token operator">:</span>	<span class="token number">44</span> <span class="token number">89</span> e7             	mov    <span class="token operator">%</span>r12d<span class="token punctuation">,</span><span class="token operator">%</span>edi
   <span class="token number">766</span>a6<span class="token operator">:</span>	e8 <span class="token number">55</span> <span class="token number">00</span> fe ff       	callq  <span class="token number">56700</span> <span class="token operator">&lt;</span>waitpid@plt<span class="token operator">></span>
   <span class="token number">766</span>ab<span class="token operator">:</span>	<span class="token number">8</span>b <span class="token number">44</span> <span class="token number">24</span> <span class="token number">1</span>c          	mov    <span class="token number">0x1c</span><span class="token punctuation">(</span><span class="token operator">%</span>rsp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>eax
   <span class="token number">766</span>af<span class="token operator">:</span>	a8 <span class="token number">7f</span>                	test   $<span class="token number">0x7f</span><span class="token punctuation">,</span><span class="token operator">%</span>al
   <span class="token number">766</span>b1<span class="token operator">:</span>	<span class="token number">0f</span> <span class="token number">85</span> <span class="token number">8</span>a <span class="token number">07</span> <span class="token number">00</span> <span class="token number">00</span>    	jne    <span class="token number">76e41</span> <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">+</span><span class="token number">0x961</span><span class="token operator">></span>
   <span class="token number">766</span>b7<span class="token operator">:</span>	<span class="token number">0f</span> b6 cc             	movzbl <span class="token operator">%</span>ah<span class="token punctuation">,</span><span class="token operator">%</span>ecx
   <span class="token number">766</span>ba<span class="token operator">:</span>	f6 c4 ff             	test   $<span class="token number">0xff</span><span class="token punctuation">,</span><span class="token operator">%</span>ah
   <span class="token number">766</span>bd<span class="token operator">:</span>	<span class="token number">0f</span> <span class="token number">85</span> cd <span class="token number">03</span> <span class="token number">00</span> <span class="token number">00</span>    	jne    <span class="token number">76</span>a90 <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">+</span><span class="token number">0x5b0</span><span class="token operator">></span>
   <span class="token number">766</span>c3<span class="token operator">:</span>	<span class="token number">8</span>b <span class="token number">7</span>c <span class="token number">24</span> <span class="token number">28</span>          	mov    <span class="token number">0x28</span><span class="token punctuation">(</span><span class="token operator">%</span>rsp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>edi
   <span class="token number">766</span>c7<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">8</span>d <span class="token number">35</span> <span class="token number">52</span> cb <span class="token number">1</span>c <span class="token number">00</span> 	lea    <span class="token number">0x1ccb52</span><span class="token punctuation">(</span><span class="token operator">%</span>rip<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>rsi        # <span class="token number">243220</span> <span class="token operator">&lt;</span>_ZTSN4Json12RuntimeErrorE@@Base<span class="token operator">+</span><span class="token number">0x60</span><span class="token operator">></span>
   <span class="token number">766</span>ce<span class="token operator">:</span>	e8 cd <span class="token number">0</span>d fe ff       	callq  <span class="token number">574</span>a0 <span class="token operator">&lt;</span>fdopen@plt<span class="token operator">></span>
   <span class="token number">766</span>d3<span class="token operator">:</span>	<span class="token number">49</span> <span class="token number">89</span> c4             	mov    <span class="token operator">%</span>rax<span class="token punctuation">,</span><span class="token operator">%</span>r12
   <span class="token number">766</span>d6<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">85</span> ed             	test   <span class="token operator">%</span>rbp<span class="token punctuation">,</span><span class="token operator">%</span>rbp
   <span class="token number">766</span>d9<span class="token operator">:</span>	<span class="token number">0f</span> <span class="token number">84</span> f1 <span class="token number">02</span> <span class="token number">00</span> <span class="token number">00</span>    	je     <span class="token number">769</span>d0 <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">+</span><span class="token number">0x4f0</span><span class="token operator">></span>
   <span class="token number">766</span>df<span class="token operator">:</span>	<span class="token number">4</span>c <span class="token number">8</span>d <span class="token number">74</span> <span class="token number">24</span> <span class="token number">70</span>       	lea    <span class="token number">0x70</span><span class="token punctuation">(</span><span class="token operator">%</span>rsp<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>r14
   <span class="token number">766e4</span><span class="token operator">:</span>	<span class="token number">0f</span> <span class="token number">1f</span> <span class="token number">40</span> <span class="token number">00</span>          	nopl   <span class="token number">0x0</span><span class="token punctuation">(</span><span class="token operator">%</span>rax<span class="token punctuation">)</span>
   <span class="token number">766e8</span><span class="token operator">:</span>	<span class="token number">31</span> f6                	<span class="token operator">xor</span>    <span class="token operator">%</span>esi<span class="token punctuation">,</span><span class="token operator">%</span>esi
   <span class="token number">766</span>ea<span class="token operator">:</span>	ba <span class="token number">01</span> <span class="token number">10</span> <span class="token number">00</span> <span class="token number">00</span>       	mov    $<span class="token number">0x1001</span><span class="token punctuation">,</span><span class="token operator">%</span>edx
   <span class="token number">766</span>ef<span class="token operator">:</span>	<span class="token number">48</span> <span class="token number">89</span> ef             	mov    <span class="token operator">%</span>rbp<span class="token punctuation">,</span><span class="token operator">%</span>rdi
   <span class="token number">766f</span>2<span class="token operator">:</span>	b9 <span class="token number">00</span> <span class="token number">10</span> <span class="token number">00</span> <span class="token number">00</span>       	mov    $<span class="token number">0x1000</span><span class="token punctuation">,</span><span class="token operator">%</span>ecx
   <span class="token number">766f</span>7<span class="token operator">:</span>	e8 <span class="token number">44</span> <span class="token number">1</span>e fe ff       	callq  <span class="token number">58540</span> <span class="token operator">&lt;</span>__memset_chk@plt<span class="token operator">></span>
   <span class="token number">766f</span>c<span class="token operator">:</span>	<span class="token number">4</span>c <span class="token number">89</span> e2             	mov    <span class="token operator">%</span>r12<span class="token punctuation">,</span><span class="token operator">%</span>rdx
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒæˆ‘ä»¬å¾€æ­¤åç§»å¾€ä¸ŠæŸ¥æ‰¾ï¼Œæ‰¾åˆ°äº†764f0åç§»çš„ç‰¹æ®ŠæŒ‡ä»¤ï¼Œè¿™é‡Œä¸€çœ‹å°±æ˜¯ä¸€ä¸ªå‡½æ•°çš„å¼€å§‹ä½ç½®ï¼ˆè¿™é‡Œä¸ºå•¥æ˜¯å‡½æ•°å¼€å§‹ï¼Œä¸»è¦æ˜¯æ“ä½œå¤‡ä»½rbpï¼Œç”³è¯·æ ˆï¼Œæ“ä½œrspç­‰ç­‰ï¼‰ã€‚</p>
<p>â€ƒâ€ƒè¿™é‡Œå…¶å®åˆæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œæˆ‘ä»¬åœ¨åˆ†æå‡½æ•°å¤´çš„è¿‡ç¨‹ä¸­ï¼Œå…¶å®å·²ç»æ‰¾åˆ°äº†è¶³å¤Ÿå¤šçš„æˆ‘ä»¬æƒ³è¦æ‰¾çš„å‡½æ•°ç‰¹å¾ï¼šä¾‹å¦‚è¿™é‡Œè°ƒç”¨äº†fork/pipe/fdopenç­‰ç­‰ï¼Œå¦‚æœæƒ…å†µæ˜¯è¿™æ ·çš„ï¼Œé‚£ä¹ˆå…¶å®æˆ‘ä»¬å¯ä»¥ç»¼åˆåˆ†æï¼Œæ‰¾åˆ°æˆ‘ä»¬æºç å¯¹åº”å‡ºé”™çš„ä½ç½®äº†ã€‚</p>
<p>â€ƒâ€ƒé‚£å¦‚æœæˆ‘ä»¬çš„å‡½æ•°å¹³å¹³æ— å¥‡ï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜æ˜¾ç‰¹å¾æ€ä¹ˆæå‘¢ï¼Ÿè¿˜æ˜¯åªæœ‰åˆ©ç”¨æˆ‘ä»¬çš„å‡½æ•°å¤´æ¥åˆ¤æ–­ï¼Œåˆ°åº•æ˜¯æˆ‘ä»¬å†™çš„å“ªä¸ªå‡½æ•°å‡ºé—®é¢˜äº†ã€‚</p>
<p>â€ƒâ€ƒäºæ˜¯æˆ‘ä»¬æ‹¿ç€764f0åç§»ï¼Œé€šè¿‡readelf -sæ¥æŸ¥æ‰¾ç¬¦å·ï¼Œå‘ç°ä¸æ˜¯ä»»ä½•ä¸€ä¸ªæˆ‘ä»¬å·²çŸ¥çš„ç¬¦å·ï¼Œè¿™å°¼ç›å°±å‘äº†å•Šã€‚åˆ°äº†è¿™é‡Œï¼Œå…¶å®ç°åœ¨ä¸å¥½æå•Šã€‚æˆ‘ä»¬ç”¨gdb record / ida / objdump + grep æ¥ç»¼åˆåˆ†æï¼Œå‘ç°äº†è·³è½¬åˆ°å½“å‰åœ°å€çš„ä¸€ä¸ªåœ°æ–¹ã€‚ä¸‹é¢æ˜¯ç”¨readelf+objdump+grepæ¥å¾—åˆ°çš„ä¸€æ®µç‰‡æ®µï¼š</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token number">764f</span>0<span class="token operator">:</span>	<span class="token number">41</span> <span class="token number">57</span>                	push   <span class="token operator">%</span>r15
<span class="token number">77090</span><span class="token operator">:</span>	e9 <span class="token number">5</span>b f4 ff ff       	jmpq   <span class="token number">764f</span>0 <span class="token operator">&lt;</span>_ZN4yLib6yShell16yLibGetClassInfoEv@@Base<span class="token operator">+</span><span class="token number">0x10</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒæˆ‘ä»¬å†æ¬¡ç”¨objdumpå’ŒreadelfæŸ¥æ‰¾77090è¿™ä¸ªåç§»ï¼Œç»ˆäºåœ¨ç¬¦å·è¡¨æŸ¥åˆ°äº†æˆ‘ä»¬å…³å¿ƒçš„è¿™ä¸ªåç§»ï¼Œå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token number">559</span><span class="token operator">:</span> <span class="token number">0000000000077090</span>     <span class="token number">5</span> FUNC    GLOBAL DEFAULT   <span class="token number">12</span> _ZN4yLib6yShell7ExecuteERKSt6vectorINSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEESaIS7_EESB_SB_RS9_<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>â€ƒâ€ƒåˆ°æ­¤ï¼Œé€šè¿‡å¤åŸcxxå‡½æ•°åå­—ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†æˆ‘ä»¬åœ¨å“ªä¸ªå‡½æ•°é‡Œé¢å´©æºƒçš„ï¼Œè€Œä¸”æ˜¯åœ¨è¿™ä¸ªå‡½æ•°çš„memsetçš„åœ°æ–¹å¯¼è‡´æº¢å‡ºå´©æºƒçš„ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="åè®°">åè®°</h3>
<hr>
<p>â€ƒâ€ƒæ­¤é—®é¢˜çš„åˆ†æåŠ æ·±äº†æˆ‘ä»¬å¯¹è®¡ç®—æœºçš„ç†è§£ï¼Œä½¿ç”¨äº†è¾ƒå¤šçš„äºŒè¿›åˆ¶åˆ†æå·¥å…·ã€‚</p>
<p>â€ƒâ€ƒç»“åˆæˆ‘ä»¥å‰çš„è°ƒè¯•å’Œåè°ƒè¯•ç»éªŒï¼Œæ–°æ‰‹æˆ‘è¿˜æ˜¯å»ºè®®ç›´æ¥ä¸Šåˆ‘å…·idaè¿›è¡Œåˆ†æï¼Œè¿™æ ·æ›´æ£’å“¦ã€‚</p>
<h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>æ— </p>
</li>
</ul>
<br/>
<br/>
<div style="margin:50px auto;">
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <hr/>
        <center><font color = #91e0b0 size = 5>æ‰“èµã€è®¢é˜…ã€æ”¶è—ã€ä¸¢é¦™è•‰ã€ç¡¬å¸ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ï¼ˆæ”»åŸç‹®çš„æ¬ç –ä¹‹è·¯ï¼‰</font></center>
    </div>
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg" alt="qrc_img"/></center>
    </div>
</div>
<!-- ![alt å…¬ä¼—å·å›¾ç‰‡](https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg "å…¬ä¼—å·å›¾ç‰‡") -->
<p><font color="red" size="7">PS: è¯·å°Šé‡åŸåˆ›ï¼Œä¸å–œå‹¿å–·ã€‚</font><br/><br>
<font color="red" size="7">PS: è¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: æœ‰é—®é¢˜è¯·ç•™è¨€ï¼Œçœ‹åˆ°åæˆ‘ä¼šç¬¬ä¸€æ—¶é—´å›å¤ã€‚</font><br/></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://e-x.top/2023/07/02/blog_idx_123/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Sky">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sky's Blogs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Sky's Blogs">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/07/02/blog_idx_123/" class="post-title-link" itemprop="url">Linux Subreaper æœºåˆ¶åŠå†…æ ¸æ€é€ƒç¦»æ–¹æ³•(PR_SET_CHILD_SUBREAPER, prctl, systemed)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-07-02 16:25:00" itemprop="dateCreated datePublished" datetime="2023-07-02T16:25:00+08:00">2023-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-18 19:06:02" itemprop="dateModified" datetime="2024-05-18T19:06:02+08:00">2024-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>3.1k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>11 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <script src="\assets\js\APlayer.min.js"> </script><!--
 * @Description: 
 * @Author: Sky
 * @Date: 2020-08-24 16:37:34
 * @LastEditors: Sky
 * @LastEditTime: 2021-06-29 15:04:48
 * @Github: https://github.com/flyinskyin2013/
-->
<p><font color="red" size="7">PSï¼šè¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: è¿™ä¸ªåªæ˜¯åŸºäºã€Šæˆ‘è‡ªå·±ã€‹çš„ç†è§£ï¼Œ</font><br/><font color="red" size="7">å¦‚æœå’Œä½ çš„åŸåˆ™åŠæƒ³æ³•ç›¸å†²çªï¼Œè¯·è°…è§£ï¼Œå‹¿å–·ã€‚</font><br/></p>
<!-- ###### å‰ç½®è¯´æ˜
&emsp;&emsp;æœ¬æ–‡ä½œä¸ºæœ¬äººgithub blog/cnblogçš„ä¸»ç«™çš„å¤‡ä»½ã€‚ï¼ˆBlogID=123ï¼‰ 
&emsp;&emsp;æœ¬æ–‡å‘å¸ƒäº 2023-07-02 16:25             ï¼ˆBlogID=123ï¼‰ 
-->
<h6 id="ç¯å¢ƒè¯´æ˜">ç¯å¢ƒè¯´æ˜</h6>
<p>â€ƒâ€ƒæ— </p>
<h3 id="å‰è¨€">å‰è¨€</h3>
<hr>
<p>â€ƒâ€ƒç”±äºæŸäº›å…¶ä»–çš„åŸå› ï¼Œæˆ‘ä»¬åœ¨æµ‹è¯•å¦å¤–ä¸€ä¸ªé—®é¢˜çš„æ—¶å€™å‘ç°äº†ä¸€ä¸ªå¥‡æ€ªçš„ç°è±¡ï¼šåœ¨æˆ‘ä»¬ä¸€ç›´æœ´ç´ çš„è®¤çŸ¥ä¸‹ï¼Œå¦‚æœä¸€ä¸ªç¨‹åºåˆ›å»ºäº†parent-processå’Œchild-processï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå½“child-processæ­£åœ¨è¿è¡Œï¼Œparent-processé€€å‡ºçš„æ—¶å€™ï¼Œchild-processä¼šè¢«æ‰˜å­¤åˆ°initè¿›ç¨‹ã€‚ä½†æ˜¯æˆ‘ä»¬å´é€šè¿‡pstree -p å‘ç°äº†å¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œä»–ä¼šè¢«æ‰˜å­¤åˆ°æŸä¸€ä¸ªç‰¹æ®Šè¿›ç¨‹ä¸‹é¢ï¼Œè¿™ä¸ªç‰¹æ®Šè¿›ç¨‹å¹¶ä¸æ˜¯initè¿›ç¨‹ï¼Œè€Œæ˜¯initè¿›ç¨‹ä¸‹é¢çš„æŸä¸€ä¸ªè¿›ç¨‹ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªç°è±¡çš„éªŒè¯è¿‡ç¨‹ï¼š</p>
<p>â€ƒâ€ƒæµ‹è¯•ç¨‹åº</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"fork failed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"parent : child pid = %d\n"</span><span class="token punctuation">,</span> pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"child doing ... ...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"first get ppid = %d\n"</span><span class="token punctuation">,</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"second get ppid = %d\n"</span><span class="token punctuation">,</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒæˆ‘ä»¬è¿è¡Œè¿™ä¸ªç¨‹åºåï¼Œå…¶è¿è¡Œè¾“å‡ºå¦‚ä¸‹å›¾ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_123/run_test.png" alt="rep_img"/></center>
    </div>
</div>    
<p>â€ƒâ€ƒæˆ‘ä»¬å¯¹è¿™ä¸ªå›¾è¿›è¡Œåˆ†æï¼Œå¯ä»¥çŸ¥é“ï¼Œå½“å‰çš„è¿è¡Œa.outè¿›ç¨‹pidæ˜¯72140ï¼Œç„¶åå­è¿›ç¨‹çš„pidæ˜¯72141ï¼Œåœ¨parent-processé€€å‡ºåï¼Œæˆ‘ä»¬å†æ¬¡è·å–ppidï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡ºæ˜¯3203ã€‚</p>
<p>â€ƒâ€ƒæ¥ç€æˆ‘ä»¬çœ‹ä¸€ä¸‹åœ¨parent-processæœªé€€å‡ºæ—¶çš„è¿›ç¨‹æ ‘å›¾ç‰‡èŠ‚é€‰ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_123/first_ppid.png" alt="rep_img"/></center>
    </div>
</div>  
<p>â€ƒâ€ƒåœ¨å›¾ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬çš„a.outåœ¨systemd(3203)-&gt;gnome-terminal-(3741)-&gt;bash(5073)-&gt;a.out(72140)</p>
<p>â€ƒâ€ƒæ¥ç€æˆ‘ä»¬çœ‹ä¸€ä¸‹åœ¨parent-processé€€å‡ºæ—¶çš„è¿›ç¨‹æ ‘å›¾ç‰‡èŠ‚é€‰ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_123/second_ppid.png" alt="rep_img"/></center>
    </div>
</div> 
<p>â€ƒâ€ƒåœ¨å›¾ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå½“parent-processé€€å‡ºåï¼Œå­è¿›ç¨‹72141è¢«æ‰˜å­¤ç»™äº†systemd(3203)ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„pidä¸º1çš„initè¿›ç¨‹ã€‚è¿™é‡Œæå‰é€éœ²ä¸€ä¸‹3203æ˜¯systemd --userä¸€ä¸ªè¿›ç¨‹ï¼ˆåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªsubreaperï¼‰ã€‚</p>
<p>â€ƒâ€ƒå¸¦ç€å¯¹è¿™ä¸ªé—®é¢˜çš„ç–‘é—®ï¼Œæˆ‘æŸ¥è¯¢äº†ç›¸å…³çš„èµ„æ–™ï¼Œåšäº†ç›¸å…³çš„å®éªŒï¼ŒæŸ¥è¯¢åˆ°è¿™ä¸ªç°è±¡çš„åŸå› æ˜¯PR_SET_CHILD_SUBREAPERç›¸å…³å¯¼è‡´çš„ï¼Œå› æ­¤æœ‰äº†æœ¬æ–‡çš„ç›¸å…³å†…å®¹ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="ä»€ä¹ˆæ˜¯Subreaper-PR-SET-CHILD-SUBREAPER-ï¼Ÿ">ä»€ä¹ˆæ˜¯Subreaper(PR_SET_CHILD_SUBREAPER) ï¼Ÿ</h3>
<hr>
<p>â€ƒâ€ƒå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦å»çœ‹manæ‰‹å†Œï¼Œé“¾æ¥å¦‚ä¸‹ï¼š<a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man2/prctl.2.html">https://man7.org/linux/man-pages/man2/prctl.2.html</a></p>
<p>â€ƒâ€ƒé€šè¿‡prctlå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å½“å‰è¿›ç¨‹åšå¾ˆå¤šæœ‰è¶£çš„è®¾ç½®ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯PR_SET_CHILD_SUBREAPERé€‰é¡¹ï¼Œä»–ä¸»è¦æ˜¯ç”¨æ¥æ”¶é›†è¿™äº›æ‰˜å­¤è¿›ç¨‹çš„ï¼Œä¸€èˆ¬æ˜¯ç”¨æ¥ç»™ä¸€äº›å®ˆæŠ¤è¿›ç¨‹ç®¡ç†è¿›ç¨‹ï¼ˆä¾‹å¦‚ï¼šä¸Šæ–‡æåˆ°çš„systemdï¼‰ä½¿ç”¨ï¼Œä½¿å¾—ä¸€ä¸ªè¿›ç¨‹èƒ½å¤Ÿç®¡ç†è‡ªå·±çš„æ‰€æœ‰åä»£è¿›ç¨‹ã€‚å…¶ä¸»è¦è¿˜æ˜¯æ“ä½œå½“å‰è¿›ç¨‹çš„task_structä¸­çš„is_child_subreaperå±æ€§ï¼Œä¸‹é¢æ˜¯å®ç°çš„æºç èŠ‚é€‰ï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//kernel/sys.c</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">propagate_has_child_subreaper</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token comment">/*
	 * If task has has_child_subreaper - all its descendants
	 * already have these flag too and new descendants will
	 * inherit it on fork, skip them.
	 *
	 * If we've found child_reaper - skip descendants in
	 * it's subtree as they will never get out pidns.
	 */</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token operator">-></span>signal<span class="token operator">-></span>has_child_subreaper <span class="token operator">||</span>
	    <span class="token function">is_child_reaper</span><span class="token punctuation">(</span><span class="token function">task_pid</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

	p<span class="token operator">-></span>signal<span class="token operator">-></span>has_child_subreaper <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//kernel/sys.c</span>
<span class="token function">SYSCALL_DEFINE5</span><span class="token punctuation">(</span>prctl<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> option<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">,</span> arg3<span class="token punctuation">,</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">,</span> arg4<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">,</span> arg5<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span>me <span class="token operator">=</span> current<span class="token punctuation">;</span>
    <span class="token comment">//...</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//...</span>
        <span class="token keyword">case</span> PR_SET_CHILD_SUBREAPER<span class="token operator">:</span>
            me<span class="token operator">-></span>signal<span class="token operator">-></span>is_child_subreaper <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>arg2<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>arg2<span class="token punctuation">)</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token comment">//æ­¤å‡½æ•°éå†å½“å‰è¿›ç¨‹çš„æ‰€æœ‰å­è¿›ç¨‹ï¼Œå¹¶è°ƒç”¨propagate_has_child_subreaperè®¾ç½®has_child_subreaperå±æ€§ã€‚</span>
            <span class="token function">walk_process_tree</span><span class="token punctuation">(</span>me<span class="token punctuation">,</span> propagate_has_child_subreaper<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> PR_GET_CHILD_SUBREAPER<span class="token operator">:</span>
            error <span class="token operator">=</span> <span class="token function">put_user</span><span class="token punctuation">(</span>me<span class="token operator">-></span>signal<span class="token operator">-></span>is_child_subreaper<span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token keyword">int</span> __user <span class="token operator">*</span><span class="token punctuation">)</span>arg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token comment">//...</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒé€šè¿‡å¦‚ä¸Šçš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“äº†PR_SET_CHILD_SUBREAPERçš„å®ç°éƒ¨åˆ†åŸç†ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬è¿˜æ˜¯ä¸çŸ¥é“ä¸ºå•¥è¿™æ ·è®¾ç½®ä¹‹åï¼Œå½“ä¸€ä¸ªè¿›ç¨‹è¿˜æœ‰å­è¿›ç¨‹æ—¶ï¼Œå½“å‰è¿›ç¨‹é€€å‡ºåï¼Œå­è¿›ç¨‹å°±æ‰˜å­¤ç»™äº†è¿™ä¸ªå­è¿›ç¨‹æ”¶å‰²è€…ã€‚è¿™é‡Œå¯ä»¥æå‰é€éœ²ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯å’Œtask_structä¸­çš„has_child_subreaperå±æ€§æœ‰å…³ç³»ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="å½“å«æœ‰å­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹é€€å‡ºæ—¶ï¼Œæ€ä¹ˆè¿›è¡Œæ‰˜å­¤çš„ï¼Ÿ">å½“å«æœ‰å­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹é€€å‡ºæ—¶ï¼Œæ€ä¹ˆè¿›è¡Œæ‰˜å­¤çš„ï¼Ÿ</h3>
<hr>
<p>â€ƒâ€ƒå…¶å®ä»é—®é¢˜å°±å¯ä»¥çœ‹å‡ºä¸€ç‚¹ç«¯å€ªï¼Œè¿™ä¸ªæ‰˜å­¤çš„åŠ¨ä½œä¸€èˆ¬æ˜¯å‘ç”Ÿåœ¨è¿›ç¨‹é€€å‡ºçš„æ—¶å€™ï¼Œæ‰€ä»¥æˆ‘ä»¬å»æ‰¾è¿›ç¨‹é€€å‡ºç›¸å…³çš„ä»£ç åº”è¯¥èƒ½å¤Ÿæ‰¾åˆ°ä¸€äº›å¯å‘ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬çš„è¿›ç¨‹é€€å‡ºéƒ½ä¼šè°ƒç”¨exitç³»ç»Ÿè°ƒç”¨ï¼Œå¯¹åº”åˆ°å†…æ ¸æ€ï¼Œå…¶å®å°±æ˜¯do_exitã€‚æˆ‘ä»¬é€šè¿‡has_child_subreaperæ¥å…¨å±€æœç´¢ï¼Œå¯ä»¥çœ‹åˆ°ä¸€äº›å…³è”ã€‚ä¸‹é¢æ˜¯éƒ¨åˆ†ä»£ç èŠ‚é€‰ï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> __noreturn <span class="token function">do_exit</span><span class="token punctuation">(</span><span class="token keyword">long</span> code<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span>tsk <span class="token operator">=</span> current<span class="token punctuation">;</span>
    <span class="token keyword">int</span> group_dead<span class="token punctuation">;</span>

    <span class="token comment">//...</span>
    <span class="token function">exit_notify</span><span class="token punctuation">(</span>tsk<span class="token punctuation">,</span> group_dead<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/*
 * Send signals to all our closest relatives so that they know
 * to properly mourn us..
 */</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">exit_notify</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span>tsk<span class="token punctuation">,</span> <span class="token keyword">int</span> group_dead<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">//...</span>
	<span class="token function">LIST_HEAD</span><span class="token punctuation">(</span>dead<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//...</span>
	<span class="token function">forget_original_parent</span><span class="token punctuation">(</span>tsk<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dead<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//...</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/*
 * This does two things:
 *
 * A.  Make init inherit all the child processes
 * B.  Check to see if any process groups have become orphaned
 *	as a result of our exiting, and if they have any stopped
 *	jobs, send them a SIGHUP and then a SIGCONT.  (POSIX 3.2.2.2)
 */</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">forget_original_parent</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span>father<span class="token punctuation">,</span>
					<span class="token keyword">struct</span> <span class="token class-name">list_head</span> <span class="token operator">*</span>dead<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span>p<span class="token punctuation">,</span> <span class="token operator">*</span>t<span class="token punctuation">,</span> <span class="token operator">*</span>reaper<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">unlikely</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">list_empty</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>father<span class="token operator">-></span>ptraced<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">exit_ptrace</span><span class="token punctuation">(</span>father<span class="token punctuation">,</span> dead<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/* Can drop and reacquire tasklist_lock */</span>
	<span class="token comment">//é€šè¿‡task_active_pid_ns()->child_reaperæŸ¥æ‰¾åˆ°ä¸€ä¸ªreaper,ç„¶åè¿”å›å‡ºæ¥ï¼Œæ³¨æ„ä¸€èˆ¬æƒ…å†µä¸‹è¿™é‡ŒæŸ¥å‡ºæ¥çš„è¿›ç¨‹å°±æ˜¯å½“å‰namespaceçš„initè¿›ç¨‹ã€‚</span>
	reaper <span class="token operator">=</span> <span class="token function">find_child_reaper</span><span class="token punctuation">(</span>father<span class="token punctuation">,</span> dead<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">list_empty</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>father<span class="token operator">-></span>children<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token comment">//æ ¹æ®initè¿›ç¨‹å’Œhas_child_subreaperå±æ€§ï¼ŒæŸ¥è¯¢çœŸæ­£ç¬¦åˆæ¡ä»¶çš„reaper</span>
	reaper <span class="token operator">=</span> <span class="token function">find_new_reaper</span><span class="token punctuation">(</span>father<span class="token punctuation">,</span> reaper<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">list_for_each_entry</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token operator">&amp;</span>father<span class="token operator">-></span>children<span class="token punctuation">,</span> sibling<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//éå†å½“å‰é€€å‡ºè¿›ç¨‹çš„æ‰€æœ‰å­è¿›ç¨‹</span>
		<span class="token function">for_each_thread</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//éå†æ‰€æœ‰å­è¿›ç¨‹çš„çº¿ç¨‹</span>
			<span class="token function">RCU_INIT_POINTER</span><span class="token punctuation">(</span>t<span class="token operator">-></span>real_parent<span class="token punctuation">,</span> reaper<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®¾ç½®çœŸæ­£çš„çˆ¶è¿›ç¨‹ï¼Œè¿™é‡Œçš„çˆ¶è¿›ç¨‹å°±æ˜¯ä¸Šé¢æˆ‘ä»¬æŸ¥æ‰¾å‡ºæ¥äº†çš„æ»¡è¶³è¦æ±‚çš„reaper</span>
			<span class="token function">BUG_ON</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>t<span class="token operator">-></span>ptrace<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token punctuation">(</span><span class="token function">rcu_access_pointer</span><span class="token punctuation">(</span>t<span class="token operator">-></span>parent<span class="token punctuation">)</span> <span class="token operator">==</span> father<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">likely</span><span class="token punctuation">(</span><span class="token operator">!</span>t<span class="token operator">-></span>ptrace<span class="token punctuation">)</span><span class="token punctuation">)</span>
				t<span class="token operator">-></span>parent <span class="token operator">=</span> t<span class="token operator">-></span>real_parent<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token operator">-></span>pdeath_signal<span class="token punctuation">)</span>
				<span class="token function">group_send_sig_info</span><span class="token punctuation">(</span>t<span class="token operator">-></span>pdeath_signal<span class="token punctuation">,</span>
						    SEND_SIG_NOINFO<span class="token punctuation">,</span> t<span class="token punctuation">,</span>
						    PIDTYPE_TGID<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token comment">/*
		 * If this is a threaded reparent there is no need to
		 * notify anyone anything has happened.
		 */</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">same_thread_group</span><span class="token punctuation">(</span>reaper<span class="token punctuation">,</span> father<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token function">reparent_leader</span><span class="token punctuation">(</span>father<span class="token punctuation">,</span> p<span class="token punctuation">,</span> dead<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token function">list_splice_tail_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>father<span class="token operator">-></span>children<span class="token punctuation">,</span> <span class="token operator">&amp;</span>reaper<span class="token operator">-></span>children<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒåœ¨forget_original_parentä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•´ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯ï¼Œæ‰¾åˆ°ä¸€ä¸ªreaperï¼Œç„¶åå°†æ‰€æœ‰å­è¿›ç¨‹äº¤ä»˜ç»™è¿™ä¸ªreaperã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="æˆ‘ä»¬æ€ä¹ˆé€ƒç¦»PR-SET-CHILD-SUBREAPERçš„å½±å“å‘¢ï¼Ÿ">æˆ‘ä»¬æ€ä¹ˆé€ƒç¦»PR_SET_CHILD_SUBREAPERçš„å½±å“å‘¢ï¼Ÿ</h3>
<hr>
<p>â€ƒâ€ƒå…¶å®è¿™ä¸ªé—®é¢˜å°±åœ¨forget_original_parentä¸­çš„find_new_reaperå‡½æ•°ä¸­ï¼Œä¹Ÿå°±æ˜¯has_child_subreaperè¿™ä¸ªå±æ€§æ€ä¹ˆç”Ÿæ•ˆï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½ï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/*
 * When we die, we re-parent all our children, and try to:
 * 1. give them to another thread in our thread group, if such a member exists
 * 2. give it to the first ancestor process which prctl'd itself as a
 *    child_subreaper for its children (like a service manager)
 * 3. give it to the init process (PID 1) in our pid namespace
 */</span>
<span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span><span class="token function">find_new_reaper</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span>father<span class="token punctuation">,</span>
					   <span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span>child_reaper<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span>thread<span class="token punctuation">,</span> <span class="token operator">*</span>reaper<span class="token punctuation">;</span>

	thread <span class="token operator">=</span> <span class="token function">find_alive_thread</span><span class="token punctuation">(</span>father<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>thread<span class="token punctuation">)</span>
		<span class="token keyword">return</span> thread<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>father<span class="token operator">-></span>signal<span class="token operator">-></span>has_child_subreaper<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//æ³¨æ„has_child_subreaperå±æ€§ç”Ÿæ•ˆçš„åœ°æ–¹ã€‚</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">int</span> ns_level <span class="token operator">=</span> <span class="token function">task_pid</span><span class="token punctuation">(</span>father<span class="token punctuation">)</span><span class="token operator">-></span>level<span class="token punctuation">;</span>
		<span class="token comment">/*
		 * Find the first ->is_child_subreaper ancestor in our pid_ns.
		 * We can't check reaper != child_reaper to ensure we do not
		 * cross the namespaces, the exiting parent could be injected
		 * by setns() + fork().
		 * We check pid->level, this is slightly more efficient than
		 * task_active_pid_ns(reaper) != task_active_pid_ns(father).
		 */</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>reaper <span class="token operator">=</span> father<span class="token operator">-></span>real_parent<span class="token punctuation">;</span>
		     <span class="token function">task_pid</span><span class="token punctuation">(</span>reaper<span class="token punctuation">)</span><span class="token operator">-></span>level <span class="token operator">==</span> ns_level<span class="token punctuation">;</span>
		     reaper <span class="token operator">=</span> reaper<span class="token operator">-></span>real_parent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>reaper <span class="token operator">==</span> <span class="token operator">&amp;</span>init_task<span class="token punctuation">)</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>reaper<span class="token operator">-></span>signal<span class="token operator">-></span>is_child_subreaper<span class="token punctuation">)</span>
				<span class="token keyword">continue</span><span class="token punctuation">;</span>
			thread <span class="token operator">=</span> <span class="token function">find_alive_thread</span><span class="token punctuation">(</span>reaper<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>thread<span class="token punctuation">)</span>
				<span class="token keyword">return</span> thread<span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">return</span> child_reaper<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒæˆ‘ä»¬ä»find_new_reaperä¸­å¯ä»¥çŸ¥é“ï¼Œå½“has_child_subreaperæœ‰å€¼æ—¶ï¼Œæˆ‘ä»¬å°±ä»å½“å‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å¼€å§‹æŸ¥æ‰¾ï¼Œå½“æ‰¾åˆ°ä¸€ä¸ªè¿›ç¨‹çš„is_child_subreaperå±æ€§æ˜¯æœ‰å€¼æ—¶ï¼Œæˆ‘ä»¬å°±è¿”å›è¿™ä¸ªè¿›ç¨‹ä½œä¸ºçœŸæ­£çš„reaperã€‚å½“has_child_subreaperæ— å€¼æ—¶ï¼Œå°±æ˜¯ä»¥initè¿›ç¨‹ä¸ºreaperæ¥æ‰˜å­¤ã€‚</p>
<p>â€ƒâ€ƒä»ä»¥ä¸Šçš„æ¨ç†æ¥çœ‹ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–¹æ¡ˆå¯ä»¥é€ƒç¦»PR_SET_CHILD_SUBREAPERå½±å“ï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>ç›´æ¥æ”¹å†™çœŸæ­£PR_SET_CHILD_SUBREAPERçš„åœ°æ–¹ï¼Œä¸å¯ç”¨è¿™ä¸ªå±æ€§ã€‚ä¾‹å¦‚ä¿®æ”¹systemdçš„æºç ã€‚</p>
</li>
<li class="lvl-2">
<p>å†™ä¸€ä¸ªå†…æ ¸æ€çš„å°å·¥å…·ï¼Œä¿®æ”¹æŒ‡å®šè¿›ç¨‹çš„as_child_subreaperçš„å€¼ï¼Œå½“æˆ‘ä»¬ç¦ç”¨æ­¤å€¼æ—¶ï¼Œåœ¨è¿›ç¨‹é€€å‡ºæ—¶ï¼Œå°±ä¼šæŠŠå­è¿›ç¨‹æ‰˜å­¤ç»™initè¿›ç¨‹ã€‚</p>
</li>
</ul>
<br/>
<br/>
<br/>
<br/>
<h3 id="æˆ‘ä»¬æ€ä¹ˆé€ƒç¦»PR-SET-CHILD-SUBREAPERçš„å½±å“å‘¢ï¼Ÿ-2">æˆ‘ä»¬æ€ä¹ˆé€ƒç¦»PR_SET_CHILD_SUBREAPERçš„å½±å“å‘¢ï¼Ÿ</h3>
<hr>
<p>â€ƒâ€ƒæŒ‰ç…§ä¸Šä¸€ä¸ªå°ç»“çš„ç»“è®ºï¼Œæˆ‘ä»¬ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸ä¼šå»æ”¹ä¸€äº›å¼€æºçš„ç³»ç»Ÿç¨‹åºï¼Œä¾‹å¦‚ï¼šsystemdã€‚å› æ­¤æˆ‘ä»¬é€‰æ‹©ç›´æ¥å†™ä¸€ä¸ªåŸºæœ¬çš„å†…æ ¸æ€æ¨¡å—ï¼Œç›´æ¥ä¿®æ”¹å…¶task_structæ•°æ®ç»“æ„å³å¯ã€‚koæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/module.h></span>	<span class="token comment">/* Needed by all modules */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/kernel.h></span>	<span class="token comment">/* Needed for KERN_INFO */</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/pid.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/sched.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/sched/signal.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/sched/mm.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/mm_types.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/rwsem.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/slab.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/fs.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/mmap_lock.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/pid_namespace.h></span></span>

<span class="token function">MODULE_AUTHOR</span><span class="token punctuation">(</span><span class="token string">"sky &lt;sky@sky.com>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">MODULE_DESCRIPTION</span><span class="token punctuation">(</span><span class="token string">"sky's hack"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">MODULE_LICENSE</span><span class="token punctuation">(</span><span class="token string">"GPL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">MODULE_VERSION</span><span class="token punctuation">(</span><span class="token string">"1.0.0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token keyword">int</span> hack_pid <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token function">module_param_named</span><span class="token punctuation">(</span>hack_pid<span class="token punctuation">,</span> hack_pid<span class="token punctuation">,</span> uint<span class="token punctuation">,</span> S_IRUGO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">MODULE_PARM_DESC</span><span class="token punctuation">(</span>hack_pid<span class="token punctuation">,</span> <span class="token string">"hack_pid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">int</span> <span class="token function">init_module</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token function">printk</span><span class="token punctuation">(</span>KERN_INFO <span class="token string">"Hello sky_hack.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printk</span><span class="token punctuation">(</span>KERN_INFO <span class="token string">"hack pid %d\n"</span><span class="token punctuation">,</span> hack_pid<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">rcu_read_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">struct</span> <span class="token class-name">pid</span> <span class="token operator">*</span> _pid_struct <span class="token operator">=</span> <span class="token function">find_vpid</span><span class="token punctuation">(</span>hack_pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> _pid_struct<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

		<span class="token function">printk</span><span class="token punctuation">(</span><span class="token string">"get pid struct failed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">rcu_read_unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span> _task_struct <span class="token operator">=</span> <span class="token function">get_pid_task</span><span class="token punctuation">(</span>_pid_struct<span class="token punctuation">,</span> PIDTYPE_PID<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> _task_struct<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

		<span class="token function">printk</span><span class="token punctuation">(</span><span class="token string">"get task struct failed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">rcu_read_unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>


	<span class="token keyword">struct</span> <span class="token class-name">mm_struct</span> <span class="token operator">*</span> _mm_struct <span class="token operator">=</span> <span class="token function">get_task_mm</span><span class="token punctuation">(</span>_task_struct<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> _mm_struct<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

		<span class="token function">printk</span><span class="token punctuation">(</span><span class="token string">"get mm struct failed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">rcu_read_unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token function">mmap_read_lock</span><span class="token punctuation">(</span>_mm_struct<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_mm_struct<span class="token operator">-></span>exe_file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

                <span class="token keyword">char</span> <span class="token operator">*</span> pathname <span class="token operator">=</span> <span class="token function">kmalloc</span><span class="token punctuation">(</span>PATH_MAX<span class="token punctuation">,</span> GFP_ATOMIC<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">char</span> <span class="token operator">*</span> p <span class="token operator">=</span> <span class="token function">d_path</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_mm_struct<span class="token operator">-></span>exe_file<span class="token operator">-></span>f_path<span class="token punctuation">,</span> pathname<span class="token punctuation">,</span> PATH_MAX<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">/*Now you have the path name of exe in p*/</span>
					<span class="token function">printk</span><span class="token punctuation">(</span>KERN_INFO <span class="token string">"process full path %s\n"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
				<span class="token function">kfree</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
	<span class="token function">mmap_read_unlock</span><span class="token punctuation">(</span>_mm_struct<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">struct</span> <span class="token class-name">pid_namespace</span> <span class="token operator">*</span>pid_ns <span class="token operator">=</span> <span class="token function">task_active_pid_ns</span><span class="token punctuation">(</span>_task_struct<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">task_struct</span> <span class="token operator">*</span>reaper <span class="token operator">=</span> pid_ns<span class="token operator">-></span>child_reaper<span class="token punctuation">;</span>

	<span class="token function">printk</span><span class="token punctuation">(</span>KERN_INFO <span class="token string">"pid_ns->child_reaper=%x, current task_struct=%x\n"</span><span class="token punctuation">,</span> pid_ns<span class="token operator">-></span>child_reaper<span class="token punctuation">,</span> _task_struct<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printk</span><span class="token punctuation">(</span>KERN_INFO <span class="token string">"is_child_subreaper %d\n"</span><span class="token punctuation">,</span> _task_struct<span class="token operator">-></span>signal<span class="token operator">-></span>is_child_subreaper<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printk</span><span class="token punctuation">(</span>KERN_INFO <span class="token string">"has_child_subreaper %d\n"</span><span class="token punctuation">,</span> _task_struct<span class="token operator">-></span>signal<span class="token operator">-></span>has_child_subreaper<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//escape from a subreaper by do_exit()</span>
	_task_struct<span class="token operator">-></span>signal<span class="token operator">-></span>has_child_subreaper <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">rcu_read_unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">cleanup_module</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token function">printk</span><span class="token punctuation">(</span>KERN_INFO <span class="token string">"Goodbye sky_hack.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒå½“å‰è¿™ä¸ªé©±åŠ¨çš„å”¯ä¸€ç›®çš„å°±æ˜¯æŠŠæŒ‡å®špidè¿›ç¨‹çš„has_child_subreaperæ”¹ä¸º0ï¼Œè¿™æ ·å°±å¯ä»¥é€ƒç¦»subreaperã€‚</p>
<p>â€ƒâ€ƒç¼–è¯‘Makefile</p>
<pre class="line-numbers language-makefile" data-language="makefile"><code class="language-makefile">obj-m <span class="token operator">+=</span> sky_hack.o
<span class="token target symbol">all</span><span class="token punctuation">:</span>
    make -C /lib/modules/<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">shell</span> uname -r<span class="token punctuation">)</span>/build M<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>PWD<span class="token punctuation">)</span> modules
<span class="token target symbol">clean</span><span class="token punctuation">:</span>
    make -C /lib/modules/<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">shell</span> uname -r<span class="token punctuation">)</span>/build M<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>PWD<span class="token punctuation">)</span> clean<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒä¸‹é¢æˆ‘ä»¬å†ä¸€æ¬¡åšä¸Šé¢çš„æµ‹è¯•ï¼Œè¿è¡Œa.outï¼ŒæŸ¥çœ‹a.outç›¸å…³çš„è¿›ç¨‹æ ‘ï¼Œç„¶åè¿è¡Œsky_hack.ko hack_pid=â€˜a.outè¿›ç¨‹idâ€™ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œå½“a.outé€€å‡ºåï¼Œå†æ¬¡æŸ¥çœ‹a.outçš„ç›¸å…³è¿›ç¨‹æ ‘å³å¯ã€‚</p>
<p>â€ƒâ€ƒè¿è¡Œa.outçš„è¾“å‡ºï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_123/run_test1.png" alt="rep_img"/></center>
    </div>
</div>    
<p>â€ƒâ€ƒæˆ‘ä»¬å…¶å®å¯ä»¥çœ‹åˆ°ï¼ŒæŒ‰ç…§ä¸Šé¢æˆ‘ä»¬çš„è¯´æ˜è¿›è¡Œæ“ä½œåï¼Œa.outç¬¬äºŒæ¬¡æ‰“å°çš„ppidå·²ç»æ˜¯1äº†ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬é€ƒç¦»subreaperæˆåŠŸäº†ã€‚</p>
<p>â€ƒâ€ƒä¸‹é¢æˆ‘ä»¬çœ‹çœ‹insmod sky_hack.ko hack_pid=14749çš„è¾“å‡ºï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_123/drv_out.png" alt="rep_img"/></center>
    </div>
</div>    
<p>â€ƒâ€ƒæˆ‘ä»¬å…¶å®å¯ä»¥çœ‹åˆ°ï¼Œåœ¨é©±åŠ¨é‡Œé¢æˆ‘ä»¬æ‰“å°äº†a.outè¿›ç¨‹çš„has_child_subreaperå±æ€§æ˜¯1ï¼Œå› æ­¤æˆ‘ä»¬åœ¨é©±åŠ¨ä¸­é‡ç½®äº†å®ƒï¼Œå¯¼è‡´äº†é€€å‡ºæ—¶ï¼ŒæˆåŠŸæ‰˜å­¤ç»™äº†initè¿›ç¨‹ã€‚</p>
<p>â€ƒâ€ƒä¸‹é¢æˆ‘ä»¬çœ‹çœ‹è¿™æ•´ä¸ªé˜¶æ®µä¸­çš„è¿›ç¨‹æ ‘çŠ¶å†µï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_123/first_ppid1.png" alt="rep_img"/></center>
    </div>
</div>    
<p>â€ƒâ€ƒè¿™é‡Œçš„è¿›ç¨‹åˆ†å¸ƒå’Œä¸Šè¿°å¼€å§‹çš„ä¸€æ ·ã€‚</p>
<p>â€ƒâ€ƒæˆ‘ä»¬çœ‹çœ‹é€ƒç¦»subreaperåï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_123/second_ppid1.png" alt="rep_img"/></center>
    </div>
</div> 
<p>â€ƒâ€ƒè¿™é‡Œçš„è¿›ç¨‹åˆ†å¸ƒå°±å’Œæœ€å¼€å§‹çš„ä¸ä¸€æ ·çš„ï¼Œæˆ‘ä»¬æˆåŠŸçš„å°†æˆ‘ä»¬çš„å­è¿›ç¨‹æ‰˜å­¤ç»™äº†initè¿›ç¨‹ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="åè®°">åè®°</h3>
<hr>
<p>â€ƒâ€ƒæˆ‘ä»¬é¦–å…ˆä»ä¸€ä¸ªå…¶ä»–é—®é¢˜ï¼Œé‡åˆ°äº†è¿™ä¸ªç°è±¡ï¼Œç„¶åæˆ‘ä»¬æ·±ç©¶äº†è¿™ä¸ªç°è±¡äº§ç”Ÿçš„åŸå› ï¼Œå¹¶ä¸”æœ€ç»ˆå°è¯•è®¾è®¡å‡ºé€ƒç¦»è¿™ç§ç°è±¡çš„æŠ€æœ¯æ–¹æ¡ˆã€‚è¿™å…¶ä¸­ä¼šæ¶‰åŠä¸€äº›å†…æ ¸æºç ï¼Œé©±åŠ¨ç¼–å†™ï¼ŒåŒæ—¶åŠ æ·±äº†æˆ‘ä»¬å¯¹subreaperçš„ç†è§£ã€‚ç»è¿‡è¿™äº›è¿‡ç¨‹åï¼Œæˆ‘ä»¬å¯¹Linuxå†…æ ¸ï¼ŒLinuxçš„åº”ç”¨å¼€å‘ä¼šæœ‰ä¸€ä¸ªæ–°çš„è®¤çŸ¥å’Œç†è§£ã€‚åŒæ—¶ä¹Ÿå¢å¼ºäº†æˆ‘ä»¬è§£å†³é—®é¢˜çš„ç»¼åˆèƒ½åŠ›ã€‚</p>
<h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>æ— </p>
</li>
</ul>
<br/>
<br/>
<div style="margin:50px auto;">
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <hr/>
        <center><font color = #91e0b0 size = 5>æ‰“èµã€è®¢é˜…ã€æ”¶è—ã€ä¸¢é¦™è•‰ã€ç¡¬å¸ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ï¼ˆæ”»åŸç‹®çš„æ¬ç –ä¹‹è·¯ï¼‰</font></center>
    </div>
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg" alt="qrc_img"/></center>
    </div>
</div>
<!-- ![alt å…¬ä¼—å·å›¾ç‰‡](https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg "å…¬ä¼—å·å›¾ç‰‡") -->
<p><font color="red" size="7">PS: è¯·å°Šé‡åŸåˆ›ï¼Œä¸å–œå‹¿å–·ã€‚</font><br/><br>
<font color="red" size="7">PS: è¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: æœ‰é—®é¢˜è¯·ç•™è¨€ï¼Œçœ‹åˆ°åæˆ‘ä¼šç¬¬ä¸€æ—¶é—´å›å¤ã€‚</font><br/></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://e-x.top/2023/07/02/blog_idx_122/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Sky">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sky's Blogs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Sky's Blogs">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/07/02/blog_idx_122/" class="post-title-link" itemprop="url">LinuxDNSåˆ†æä»å…¥é—¨åˆ°æ”¾å¼ƒï¼ˆè®°ä¸€æ¬¡æœ‰è¶£çš„dnsé—®é¢˜æ’æŸ¥è®°å½•ï¼Œping æºç åˆ†æï¼Œgetaddrinfoæºç åˆ†æï¼‰</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-07-02 16:25:00" itemprop="dateCreated datePublished" datetime="2023-07-02T16:25:00+08:00">2023-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-18 19:06:02" itemprop="dateModified" datetime="2024-05-18T19:06:02+08:00">2024-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/linux/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" itemprop="url" rel="index"><span itemprop="name">ç½‘ç»œåè®®</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>3.2k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>12 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <script src="\assets\js\APlayer.min.js"> </script><!--
 * @Description: 
 * @Author: Sky
 * @Date: 2020-08-24 16:37:34
 * @LastEditors: Sky
 * @LastEditTime: 2021-06-29 15:04:48
 * @Github: https://github.com/flyinskyin2013/
-->
<p><font color="red" size="7">PSï¼šè¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: è¿™ä¸ªåªæ˜¯åŸºäºã€Šæˆ‘è‡ªå·±ã€‹çš„ç†è§£ï¼Œ</font><br/><font color="red" size="7">å¦‚æœå’Œä½ çš„åŸåˆ™åŠæƒ³æ³•ç›¸å†²çªï¼Œè¯·è°…è§£ï¼Œå‹¿å–·ã€‚</font><br/></p>
<!-- ###### å‰ç½®è¯´æ˜
&emsp;&emsp;æœ¬æ–‡ä½œä¸ºæœ¬äººgithub blog/cnblogçš„ä¸»ç«™çš„å¤‡ä»½ã€‚ï¼ˆBlogID=122ï¼‰ 
&emsp;&emsp;æœ¬æ–‡å‘å¸ƒäº 2023-07-02 16:25             ï¼ˆBlogID=122ï¼‰ 
-->
<h6 id="ç¯å¢ƒè¯´æ˜">ç¯å¢ƒè¯´æ˜</h6>
<p>â€ƒâ€ƒubuntu 18.04</p>
<h3 id="å‰è¨€">å‰è¨€</h3>
<hr>
<p>â€ƒâ€ƒæˆ‘ä»¬è¿™é‡Œæœ‰ä¸€å—åµŒå…¥å¼æ¿å¡ï¼Œå½“æˆ‘ä»¬é€šè¿‡PINGæµ‹è¯•å†…ç½‘IPæ—¶ï¼Œå‘ç°å¤–ç½‘IPè®¿é—®æ­£å¸¸ï¼Œä½†æ˜¯æµ‹è¯•åŸŸåè®¿é—®ä¸€ç›´æŠ¥unknown hostã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ubuntué‡Œé¢ï¼Œæˆ‘ä»¬é‡åˆ°åŸŸåä¸èƒ½è®¿é—®ï¼Œåæ‰‹å°±æ˜¯å»è®¾ç½®/etc/resolv.confæ–‡ä»¶é‡Œé¢çš„nameserverä¸º114.114.114.114ã€‚ä½†æ˜¯ä¸‡ä¸‡æ²¡æœ‰æƒ³åˆ°ï¼Œè¿™æ¬¡æˆ‘ä»¬è¿™æ ·æ”¹äº†ä¹‹åï¼Œè¿˜æ˜¯è®¿é—®æŠ¥unknown hostã€‚</p>
<p>â€ƒâ€ƒå½“æ—¶æˆ‘å°±äººéº»äº†ï¼Œä½†æ˜¯æˆ‘ä»¿ä½›çµå…‰ä¸€é—ªï¼Œæƒ³åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä½•ä»¥å‰æˆ‘ä»¬ä¿®æ”¹äº†/etc/resolv.confæ–‡ä»¶å°±DNSå°±æ­£å¸¸äº†ï¼Œä½†æ˜¯è¿™é‡ŒåŒæ ·ä¿®æ”¹äº†è¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¸æ­£å¸¸å·¥ä½œï¼Ÿæ­¤å¤–ï¼Œ/etc/resolv.confæ–‡ä»¶æ˜¯å¹²å˜›çš„ï¼Œä¸ºä½•æ”¹äº†DNSå°±æœ‰æ•ˆäº†ï¼Ÿ</p>
<p>â€ƒâ€ƒè¦å›ç­”ä»¥ä¸Šé—®é¢˜ï¼Œæ ¹æœ¬åŸå› å°±æ˜¯è¦äº†è§£Linuxå¹³å°é‡Œé¢DNSçš„è¯¦ç»†å·¥ä½œæµç¨‹ï¼Œäºæ˜¯æˆ‘è¸ä¸Šäº†çœ‹æºç ä¹‹æ—…ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="æ¢ç´¢ä¹‹æ—…">æ¢ç´¢ä¹‹æ—…</h3>
<hr>
<p>â€ƒâ€ƒåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯æƒ³åˆ°ï¼Œå½“æˆ‘ä»¬pingä¸€ä¸ªåŸŸåï¼Œæˆ–è€…æˆ‘ä»¬åœ¨æµè§ˆå™¨é‡Œé¢è¾“å…¥äº†ä¸€ä¸ªåŸŸåï¼Œç„¶åè®¿é—®çš„é‚£ä¸€åˆ»å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>
<p>â€ƒâ€ƒé¦–å…ˆï¼Œå½“æˆ‘ä»¬è¿›è¡Œç½‘ç»œç¼–ç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸ç®¡æ˜¯send udp msgè¿˜æ˜¯send tcp msgï¼Œæˆ‘ä»¬éƒ½æ˜¯éœ€è¦æ„å»ºä¸€ä¸ªstruct sockaddrç»“æ„ï¼Œè¿™ä¸ªç»“æ„é‡Œé¢åŒ…å«äº†è®¿é—®çš„åœ°å€ï¼Œç«¯å£ç­‰ç­‰ä¿¡æ¯ã€‚ä½†æ˜¯è¿™é‡Œçš„åœ°å€æ˜¯ipåœ°å€ï¼Œå¹¶ä¸æ˜¯åŸŸååœ°å€ï¼Œå› æ­¤å¯ä»¥çŒœæµ‹ï¼Œåœ¨æµè§ˆå™¨è®¿é—®æˆ–è€…pingåŸŸåä¹‹å‰ï¼Œè‚¯å®šåšäº†dnsæŸ¥è¯¢å·¥ä½œï¼Œç„¶åå°†åŸŸåè½¬æ¢ä¹‹åï¼Œå¾—åˆ°ipåœ°å€æ‰æ„å»ºå‡ºstruct sockaddrç»“æ„ï¼Œç„¶åæ‰å¼€å§‹ç½‘ç»œè®¿é—®çš„æ“ä½œçš„ã€‚</p>
<p>â€ƒâ€ƒä¸‹é¢æˆ‘å»ç¿»é˜…äº†pingçš„æºç ï¼Œåœ¨<a target="_blank" rel="noopener" href="https://git.savannah.gnu.org/cgit/inetutils.git/tree/ping/libping.c?h=v2.4">https://git.savannah.gnu.org/cgit/inetutils.git/tree/ping/libping.c?h=v2.4</a> ä¸­çš„ping_set_dest å‡½æ•°ä¸­ï¼Œæœ‰ä¸€ä¸ªå°†hostè½¬æ¢ä¸ºstruct sockaddrçš„æ–¹æ³•å¼•èµ·äº†æˆ‘çš„æ³¨æ„ï¼Œä»–å°±æ˜¯ï¼šgetaddrinfo / gethostbynameã€‚ä¸‹é¢æ˜¯pingçš„ç®€è¦å·¥ä½œæµç¨‹ï¼š</p>
<ol>
<li class="lvl-3">
<p>åœ¨<a target="_blank" rel="noopener" href="https://git.savannah.gnu.org/cgit/inetutils.git/tree/ping/ping.c?h=v2.4%E4%B8%AD%EF%BC%8Cmain%E5%87%BD%E6%95%B0%E4%B8%AD%E8%B0%83%E7%94%A8%E4%BA%86argp_parse%EF%BC%8C%E8%BF%99%E9%87%8C%E9%9D%A2%E4%BC%9A%E8%B0%83%E7%94%A8parse_opt%EF%BC%8C%E5%9C%A8%E8%BF%99%E9%87%8C%E6%9C%89%E4%B8%80%E4%B8%AA%E9%87%8D%E8%A6%81%E7%9A%84ping_type%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E5%9C%A8%E8%BF%99%E9%87%8C%E8%AE%BE%E7%BD%AE%E4%BA%86%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%88%91%E4%BB%AC%E4%B8%8D%E9%85%8D%E7%BD%AE%E4%BB%BB%E4%BD%95%E5%8F%82%E6%95%B0%E7%9A%84%E8%AF%9D%EF%BC%8C%E9%82%A3%E4%B9%88%E5%B0%B1%E6%98%AF%E8%B0%83%E7%94%A8%E7%9A%84ping_echo%E5%87%BD%E6%95%B0%E3%80%82">https://git.savannah.gnu.org/cgit/inetutils.git/tree/ping/ping.c?h=v2.4ä¸­ï¼Œmainå‡½æ•°ä¸­è°ƒç”¨äº†argp_parseï¼Œè¿™é‡Œé¢ä¼šè°ƒç”¨parse_optï¼Œåœ¨è¿™é‡Œæœ‰ä¸€ä¸ªé‡è¦çš„ping_typeå‡½æ•°æŒ‡é’ˆåœ¨è¿™é‡Œè®¾ç½®äº†ï¼Œå¦‚æœæˆ‘ä»¬ä¸é…ç½®ä»»ä½•å‚æ•°çš„è¯ï¼Œé‚£ä¹ˆå°±æ˜¯è°ƒç”¨çš„ping_echoå‡½æ•°ã€‚</a></p>
</li>
<li class="lvl-3">
<p>åœ¨<a target="_blank" rel="noopener" href="https://git.savannah.gnu.org/cgit/inetutils.git/tree/ping/ping.c?h=v2.4%E4%B8%AD%EF%BC%8Cmain%E5%87%BD%E6%95%B0%E4%B8%AD%E8%B0%83%E7%94%A8%E4%BA%86ping_init%EF%BC%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BA%86ICMP%E7%9A%84socket%EF%BC%8C%E5%B9%B6%E8%AE%B0%E5%BD%95%E5%88%B0%E5%8F%A5%E6%9F%84PING%E4%B8%AD%E3%80%82">https://git.savannah.gnu.org/cgit/inetutils.git/tree/ping/ping.c?h=v2.4ä¸­ï¼Œmainå‡½æ•°ä¸­è°ƒç”¨äº†ping_initï¼Œåˆå§‹åŒ–äº†ICMPçš„socketï¼Œå¹¶è®°å½•åˆ°å¥æŸ„PINGä¸­ã€‚</a></p>
</li>
<li class="lvl-3">
<p>åœ¨ç»å†å„ç§åˆå§‹åŒ–åï¼Œå°±ä¼šè°ƒç”¨ping_typeï¼Œåé¢æˆ‘ä»¬é»˜è®¤åˆ†æping_echoã€‚</p>
</li>
<li class="lvl-3">
<p>åœ¨<a target="_blank" rel="noopener" href="https://git.savannah.gnu.org/cgit/inetutils.git/tree/ping/ping_echo.c?h=v2.4%E4%B8%AD%EF%BC%8Cping_echo%E4%B8%AD%E5%9B%9E%E5%8E%BB%E8%B0%83%E7%94%A8ping_set_dest%E8%AE%BE%E7%BD%AE%E5%8F%82%E6%95%B0%EF%BC%8C%E5%90%8C%E6%97%B6%E8%B0%83%E7%94%A8ping_run%E5%BE%AA%E7%8E%AF%E9%80%9A%E8%BF%87send_to%E5%8F%91%E9%80%81ping">https://git.savannah.gnu.org/cgit/inetutils.git/tree/ping/ping_echo.c?h=v2.4ä¸­ï¼Œping_echoä¸­å›å»è°ƒç”¨ping_set_destè®¾ç½®å‚æ•°ï¼ŒåŒæ—¶è°ƒç”¨ping_runå¾ªç¯é€šè¿‡send_toå‘é€ping</a> icmpæŠ¥æ–‡ã€‚</p>
</li>
<li class="lvl-3">
<p>åœ¨<a target="_blank" rel="noopener" href="https://git.savannah.gnu.org/cgit/inetutils.git/tree/ping/libping.c?h=v2.4%E4%B8%AD%EF%BC%8Cping_set_dest">https://git.savannah.gnu.org/cgit/inetutils.git/tree/ping/libping.c?h=v2.4ä¸­ï¼Œping_set_dest</a> è°ƒç”¨getaddrinfoè§£æåŸŸåã€‚</p>
</li>
</ol>
<br/>
<br/>
<br/>
<br/>
<h3 id="getaddrinfo-gethostbyname">getaddrinfo / gethostbyname</h3>
<hr>
<p>â€ƒâ€ƒé¦–å…ˆï¼Œæˆ‘ä»¬åœ¨æŸ¥è¿™ä¸¤ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œå¯ä»¥çŒœæµ‹ä»–ä»¬çš„ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯ï¼šè¿™ä¸¤ä¸ªå‡½æ•°å¯èƒ½æ‹¿ç€åŸŸåï¼Œå»è®¿é—®äº†åŸŸåæœåŠ¡å™¨ï¼Œç„¶åè§£æå‡ºipåœ°å€ï¼Œå¹¶ä¸”æ„é€ äº†struct sockaddrç»“æ„å¹¶è¿”å›ã€‚</p>
<p>â€ƒâ€ƒå› æ­¤æˆ‘ä»¬å»çœ‹çœ‹è¿™ä¸¤ä¸ªå‡½æ•°ç›¸å…³çš„manä»‹ç»å’Œæºç ï¼šæ ¹æ®manæ‰‹å†Œï¼š<a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man3/getaddrinfo.3.html">https://man7.org/linux/man-pages/man3/getaddrinfo.3.html</a> ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œgetaddrinfoå·²ç»åŒ…å«äº†gethostbynameçš„å·¥ä½œï¼Œå› æ­¤æˆ‘ä»¬å°±åªéœ€è¦åˆ†æè¿™ä¸ªæ–¹æ³•å°±è¡Œã€‚</p>
<br/>
<br/>
<h5 id="getaddrinfo-å‚æ•°åˆ†æ">getaddrinfo å‚æ•°åˆ†æ</h5>
<p>â€ƒâ€ƒæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„å‚æ•°å«ä¹‰</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//é‡è¦çš„å‚æ•°ç»“æ„ä½“</span>
<span class="token keyword">struct</span> <span class="token class-name">addrinfo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span>              ai_flags<span class="token punctuation">;</span>
    <span class="token keyword">int</span>              ai_family<span class="token punctuation">;</span>
    <span class="token keyword">int</span>              ai_socktype<span class="token punctuation">;</span>
    <span class="token keyword">int</span>              ai_protocol<span class="token punctuation">;</span>
    <span class="token class-name">socklen_t</span>        ai_addrlen<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>ai_addr<span class="token punctuation">;</span>
    <span class="token keyword">char</span>            <span class="token operator">*</span>ai_canonname<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">addrinfo</span> <span class="token operator">*</span>ai_next<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">getaddrinfo</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>service<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">addrinfo</span> <span class="token operator">*</span>hints<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">addrinfo</span> <span class="token operator">*</span><span class="token operator">*</span>pai<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//æ ¹æ®https://man7.org/linux/man-pages/man3/getaddrinfo.3.htmlï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š</span>
<span class="token comment">//name: åŸŸå</span>
<span class="token comment">//service: æœåŠ¡ï¼Œæ³¨æ„è¿™é‡Œè¿™ä¸ªæœåŠ¡ä¼šè®©æˆ‘ä»¬é‡æ–°å¤ä¹ ä¸€éè®¡ç®—æœºç½‘ç»œã€‚</span>
<span class="token comment">//hints: å°±æ˜¯å¡«å†™struct addrinfoé‡Œé¢çš„å±æ€§ï¼Œç„¶ågetaddrinfoæ ¹æ®è¿™äº›ç‰¹æ®ŠæŒ‡å®šçš„å±æ€§ï¼Œå°†å¯¹åº”çš„struct addrinfoè¿”å›å›æ¥ã€‚</span>
<span class="token comment">//pai: æ­¤å‡½æ•°è¿”å›çš„ä¸€ä¸ªé“¾è¡¨ï¼Œå…¶ä¸­åŒ…å«äº†ç¬¦åˆè¦æ±‚çš„struct addrinfoä¿¡æ¯ã€‚</span>
<span class="token comment">//å…¶å®æˆ‘ä»¬ä»paiå¯ä»¥çŸ¥é“ï¼Œå½“è¿”å›æœ‰å€¼æ—¶ï¼Œæ„å‘³ç€æˆ‘ä»¬çŸ¥é“äº†ä¸€ä¸ªåŸŸåå’ŒæœåŠ¡å¯¹åº”çš„ç½‘ç»œåœ°å€ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨connect,bindä¸­ä½¿ç”¨pai->ai_addräº†ã€‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<br/>
<br/>
<h5 id="getaddrinfo-ä¾‹å­è°ƒè¯•åˆ†æ">getaddrinfo ä¾‹å­è°ƒè¯•åˆ†æ</h5>
<p>â€ƒâ€ƒæ³¨æ„ï¼šæˆ‘è¿™é‡Œæ˜¯äº‹åå†™æœ¬æ–‡çš„æ—¶å€™ï¼Œæ‰å‘ç°éœ€è¦ä¸‹é¢çš„å†…å®¹ã€‚ç”±äºgetaddrinfoçš„å®ç°ç‰¹æ®Šæ€§ï¼Œå…¶ä¸æ˜¯å¾ˆæ–¹ä¾¿æŸ¥çœ‹æºç ï¼Œå› æ­¤é‡‡å–strace + gdb + simple exampleæ–¹å¼æ¥åˆ†ææ­¤å‡½æ•°çš„å®ç°ã€‚</p>
<p>â€ƒâ€ƒé¦–å…ˆä¸‹é¢æ˜¯æˆ‘çš„simple example</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netdb.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
		<span class="token keyword">struct</span> <span class="token class-name">addrinfo</span> hints<span class="token punctuation">,</span> <span class="token operator">*</span>res<span class="token punctuation">;</span>
		  <span class="token function">memset</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>hints<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span> <span class="token punctuation">(</span>hints<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  hints<span class="token punctuation">.</span>ai_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
  hints<span class="token punctuation">.</span>ai_flags <span class="token operator">=</span> AI_CANONNAME<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">></span> <span class="token function">getaddrinfo</span><span class="token punctuation">(</span><span class="token string">"baidu.com"</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hints<span class="token punctuation">,</span> <span class="token operator">&amp;</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"get error:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> <span class="token operator">*</span> get_addr <span class="token operator">=</span> res<span class="token operator">-></span>ai_addr<span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ip for baidu: %s\n"</span><span class="token punctuation">,</span> <span class="token function">inet_ntoa</span><span class="token punctuation">(</span>get_addr<span class="token operator">-></span>sin_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒç„¶ågcc test.c -o test -g ç”Ÿæˆæ­¤æ‰§è¡Œæ–‡ä»¶ã€‚ä¸‹é¢æ˜¯æ‰§è¡Œæ­¤å‡½æ•°çš„ç»“æœå›¾ç‰‡ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_122/dns_query_result.png" alt="rep_img"/></center>
    </div>
</div>    
<p>â€ƒâ€ƒä¸‹é¢æ˜¯ä¸€äº›è¯»å–æºç éœ€è¦çš„å•è¯ç®€å†™ï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>IDNA: Internationalizing Domain Names in Applications</p>
</li>
<li class="lvl-2">
<p>NSCD: name service cache daemon</p>
</li>
<li class="lvl-2">
<p>NSS:  Name Services Switch</p>
</li>
<li class="lvl-2">
<p>CNAME: canonical name (è§„èŒƒåŒ–åå­—)</p>
</li>
</ul>
<p>â€ƒâ€ƒä¸‹é¢æ˜¯resolv.confçš„æ–‡ä»¶å†…å®¹ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># resolve.conf å†…å®¹</span>
<span class="token comment"># This file is managed by man:systemd-resolved(8). Do not edit.</span>
<span class="token comment">#</span>
<span class="token comment"># This is a dynamic resolv.conf file for connecting local clients to the</span>
<span class="token comment"># internal DNS stub resolver of systemd-resolved. This file lists all</span>
<span class="token comment"># configured search domains.</span>
<span class="token comment">#</span>
<span class="token comment"># Run "systemd-resolve --status" to see details about the uplink DNS servers</span>
<span class="token comment"># currently in use.</span>
<span class="token comment">#</span>
<span class="token comment"># Third party programs must not access this file directly, but only through the</span>
<span class="token comment"># symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a different way,</span>
<span class="token comment"># replace this symlink by a static file or a different symlink.</span>
<span class="token comment">#</span>
<span class="token comment"># See man:systemd-resolved.service(8) for details about the supported modes of</span>
<span class="token comment"># operation for /etc/resolv.conf.</span>

<span class="token comment"># nameserver 127.0.0.53</span>
nameserver <span class="token number">8.8</span>.8.8
options edns0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒä¸‹é¢æ˜¯strace ./test è¾“å‡ºçš„éƒ¨åˆ†èŠ‚é€‰ï¼ˆåŒ…å«äº†/etc/resolv.confçš„å†…å®¹ï¼‰</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//æ‰“å¼€resolve.conf</span>
<span class="token function">openat</span><span class="token punctuation">(</span>AT_FDCWD<span class="token punctuation">,</span> <span class="token string">"/etc/resolv.conf"</span><span class="token punctuation">,</span> O_RDONLY<span class="token operator">|</span>O_CLOEXEC<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span>
<span class="token function">fstat</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>st_mode<span class="token operator">=</span>S_IFREG<span class="token operator">|</span><span class="token number">0644</span><span class="token punctuation">,</span> st_size<span class="token operator">=</span><span class="token number">736</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token function">read</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"# This file is managed by man:sy"</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">736</span>
<span class="token function">read</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span>                       <span class="token operator">=</span> <span class="token number">0</span>
<span class="token function">close</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment">//é€šè¿‡resolve.confçš„dnsæœåŠ¡å™¨ï¼ŒæŸ¥è¯¢dns</span>
<span class="token comment">//è¿™é‡Œæœ‰ä¸ªå°çŸ¥è¯†ï¼šdnsæœåŠ¡å™¨çš„é»˜è®¤ç«¯å£æ˜¯53ï¼Œè¯¦ç»†å¯ä»¥é€šè¿‡/etc/protocolï¼Œ/etc/servicesæŸ¥çœ‹</span>
<span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token operator">|</span>SOCK_CLOEXEC<span class="token operator">|</span>SOCK_NONBLOCK<span class="token punctuation">,</span> IPPROTO_IP<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span>
<span class="token function">connect</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>sa_family<span class="token operator">=</span>AF_INET<span class="token punctuation">,</span> sin_port<span class="token operator">=</span><span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sin_addr<span class="token operator">=</span><span class="token function">inet_addr</span><span class="token punctuation">(</span><span class="token string">"8.8.8.8"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span>fd<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> events<span class="token operator">=</span>POLLOUT<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span>fd<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> revents<span class="token operator">=</span>POLLOUT<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">sendto</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"5\244\1\0\0\1\0\0\0\0\0\1\5baidu\3com\0\0\1\0\1\0\0)\4\260"</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> MSG_NOSIGNAL<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">38</span>
<span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span>fd<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> events<span class="token operator">=</span>POLLIN<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span>  <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span>fd<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> revents<span class="token operator">=</span>POLLIN<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">ioctl</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> FIONREAD<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token operator">=</span> <span class="token number">0</span>
<span class="token function">recvfrom</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"5\244\201\200\0\1\0\2\0\0\0\1\5baidu\3com\0\0\1\0\1\300\f\0\1\0"</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>sa_family<span class="token operator">=</span>AF_INET<span class="token punctuation">,</span> sin_port<span class="token operator">=</span><span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sin_addr<span class="token operator">=</span><span class="token function">inet_addr</span><span class="token punctuation">(</span><span class="token string">"8.8.8.8"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">28</span><span class="token operator">-></span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">70</span>
<span class="token function">close</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                                <span class="token operator">=</span> <span class="token number">0</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒé¦–å…ˆæˆ‘ä»¬è¦è°ƒè¯•glibcçš„è¯ï¼Œéœ€è¦å®‰è£…glibcçš„è°ƒè¯•ç¬¦å·ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> libc6-dbg
<span class="token builtin class-name">cd</span> /usr/src/glibc
<span class="token function">tar</span> <span class="token parameter variable">-xf</span> glibc-<span class="token punctuation">&#123;</span>version<span class="token punctuation">&#125;</span>.tar.xz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒä¸‹é¢é€šè¿‡GDB ç»“åˆ GLIBCçš„debug infoå¼€å§‹è°ƒè¯•ç¨‹åºï¼Œåˆ†æå‡ºgetaddrinfoä¸­æˆ‘æƒ³å…³æ³¨çš„éƒ¨åˆ†ã€‚</p>
<p>â€ƒâ€ƒé¦–å…ˆæˆ‘ä»¬è°ƒè¯•å¾—åˆ°æ‰“å¼€/etc/resolv.confçš„å®ç°ï¼š</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gdb ./test
b fopen
<span class="token comment"># è®¾ç½®gdbæœç´¢æºæ–‡ä»¶ç›®å½•ï¼Œæ³¨æ„ä½ ä¸‹æ–­ç‚¹æ—¶ï¼Œå¯¹åº”æºç çš„ç›¸å¯¹è·¯å¾„</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> <span class="token builtin class-name">set</span> directories /usr/src/glibc/glibc-2.27/xxxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨å¤šæ¬¡è¿è¡Œåï¼ŒæŠ“åˆ°æ‰“å¼€/etc/resolv.confçš„åœ°æ–¹ï¼Œå…¶å †æ ˆå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">#0  _IO_new_fopen (filename=filename@entry=0x7ffff7b98cea "/etc/resolv.conf", mode=mode@entry=0x7ffff7b9578c "rce") at iofopen.c:88
#1  0x00007ffff7b25c0f in __resolv_conf_load (preinit=preinit@entry=0x0) at res_init.c:553
#2  0x00007ffff7b28459 in __resolv_conf_get_current () at resolv_conf.c:162
#3  0x00007ffff7b26cad in __res_vinit (statp=0x7ffff7dd1bc0 &lt;_res>, preinit=preinit@entry=0) at res_init.c:609
#4  0x00007ffff7b27e50 in maybe_init (preinit=false, ctx=0x555555756530) at resolv_context.c:122
#5  context_get (preinit=false) at resolv_context.c:184
#6  __GI___resolv_context_get () at resolv_context.c:195
#7  0x00007ffff7ae790e in gaih_inet (name=name@entry=0x555555554924 "baidu.com", service=&lt;optimized out>, req=req@entry=0x7fffffffdeb0, pai=pai@entry=0x7fffffffd9c8, 
    naddrs=naddrs@entry=0x7fffffffd9c4, tmpbuf=tmpbuf@entry=0x7fffffffda30) at ../sysdeps/posix/getaddrinfo.c:767
#8  0x00007ffff7ae9c84 in __GI_getaddrinfo (name=&lt;optimized out>, service=&lt;optimized out>, hints=0x7fffffffdeb0, pai=0x7fffffffdea0) at ../sysdeps/posix/getaddrinfo.c:2300
#9  0x000055555555483b in main (argc=1, argv=0x7fffffffdfd8) at test.c:17<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å› æ­¤æˆ‘ä»¬å¾—åˆ°äº†getaddrinfoçš„æ‰“å¼€resolv.confçš„è°ƒç”¨è·¯å¾„ï¼Œå…¶å€¼å¦‚ä¸‹ï¼š<br>
getaddrinfoâ€“&gt;gaih_inet-&gt;__resolv_context_get()-&gt;context_get()-&gt;maybe_init()-&gt;__res_vinit()-&gt;__resolv_conf_get_current()-&gt;__resolv_conf_load() è¿™é‡Œé¢ä¼šæ‰“å¼€resolv.conf</p>
<p>æ³¨æ„ï¼Œå½“çœŸæ­£çš„æ‰“å¼€äº†resolv.confåï¼Œå…¶è¿˜ä¼šè§£ææ­¤æ–‡ä»¶ï¼Œè¿™ä¸ªéƒ¨åˆ†å°±ä¸åœ¨æœ¬æ–‡è¿›è¡Œåˆ†æäº†ã€‚</p>
<p>ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œå¯¹connectä¸‹æ–­ç‚¹ï¼Œå¾—åˆ°äº†è®¿é—®dnsæœåŠ¡å™¨çš„å †æ ˆä¿¡æ¯ï¼š</p>
<pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">#0  __libc_connect (fd=3, addr=addr@entry=..., len=16) at ../sysdeps/unix/sysv/linux/connect.c:26
#1  0x00007ffff71b4b20 in reopen (statp=statp@entry=0x7ffff7dd1bc0 &lt;_res>, terrno=terrno@entry=0x7fffffffc0a8, ns=ns@entry=0) at res_send.c:977
#2  0x00007ffff71b5e0b in send_dg (ansp2_malloced=0x0, resplen2=0x0, anssizp2=0x0, ansp2=0x0, anscp=0x7fffffffd168, gotsomewhere=&lt;synthetic pointer>, 
    v_circuit=&lt;synthetic pointer>, ns=0, terrno=0x7fffffffc0a8, anssizp=0x7fffffffc1d0, ansp=0x7fffffffc098, buflen2=0, buf2=0x0, buflen=38, 
    buf=0x7fffffffc200 "\254\212\001", statp=&lt;optimized out>) at res_send.c:1078
#3  __res_context_send (ctx=ctx@entry=0x555555756530, buf=buf@entry=0x7fffffffc200 "\254\212\001", buflen=buflen@entry=38, buf2=buf2@entry=0x0, buflen2=buflen2@entry=0, 
    ans=&lt;optimized out>, ans@entry=0x7fffffffcd10 "cxaPfi", anssiz=&lt;optimized out>, ansp=&lt;optimized out>, ansp2=&lt;optimized out>, nansp2=&lt;optimized out>, 
    resplen2=&lt;optimized out>, ansp2_malloced=&lt;optimized out>) at res_send.c:522
#4  0x00007ffff71b34d1 in __GI___res_context_query (ctx=ctx@entry=0x555555756530, name=name@entry=0x555555554924 "baidu.com", class=class@entry=1, type=type@entry=1, 
    answer=answer@entry=0x7fffffffcd10 "cxaPfi", anslen=anslen@entry=1024, answerp=0x7fffffffd168, answerp2=0x0, nanswerp2=0x0, resplen2=0x0, answerp2_malloced=0x0)
    at res_query.c:216
#5  0x00007ffff71b428d in __res_context_querydomain (domain=0x0, answerp2_malloced=0x0, resplen2=0x0, nanswerp2=0x0, answerp2=0x0, answerp=0x7fffffffd168, anslen=1024, 
    answer=0x7fffffffcd10 "cxaPfi", type=1, class=1, name=0x555555554924 "baidu.com", ctx=0x555555756530) at res_query.c:601
#6  __GI___res_context_search (ctx=ctx@entry=0x555555756530, name=name@entry=0x555555554924 "baidu.com", class=class@entry=1, type=type@entry=1, 
    answer=answer@entry=0x7fffffffcd10 "cxaPfi", anslen=anslen@entry=1024, answerp=0x7fffffffd168, answerp2=0x0, nanswerp2=0x0, resplen2=0x0, answerp2_malloced=0x0)
    at res_query.c:370
#7  0x00007ffff73c7f0c in gethostbyname3_context (ctx=ctx@entry=0x555555756530, name=name@entry=0x555555554924 "baidu.com", af=af@entry=2, 
    result=result@entry=0x7fffffffd7d0, buffer=buffer@entry=0x7fffffffda40 "\377\002", buflen=buflen@entry=1024, errnop=0x7ffff7fca440, h_errnop=0x7ffff7fca4a4, ttlp=0x0, 
    canonp=0x7fffffffd7c8) at nss_dns/dns-host.c:218
#8  0x00007ffff73c8928 in _nss_dns_gethostbyname3_r (name=name@entry=0x555555554924 "baidu.com", af=af@entry=2, result=result@entry=0x7fffffffd7d0, 
    buffer=0x7fffffffda40 "\377\002", buflen=1024, errnop=errnop@entry=0x7ffff7fca440, h_errnop=0x7ffff7fca4a4, ttlp=0x0, canonp=0x7fffffffd7c8) at nss_dns/dns-host.c:164
#9  0x00007ffff7ae7e6f in gaih_inet (name=name@entry=0x555555554924 "baidu.com", service=&lt;optimized out>, req=req@entry=0x7fffffffdeb0, pai=pai@entry=0x7fffffffd9c8, 
    naddrs=naddrs@entry=0x7fffffffd9c4, tmpbuf=tmpbuf@entry=0x7fffffffda30) at ../sysdeps/posix/getaddrinfo.c:885
#10 0x00007ffff7ae9c84 in __GI_getaddrinfo (name=&lt;optimized out>, service=&lt;optimized out>, hints=0x7fffffffdeb0, pai=0x7fffffffdea0) at ../sysdeps/posix/getaddrinfo.c:2300
#11 0x000055555555483b in main (argc=1, argv=0x7fffffffdfd8) at test.c:17<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒæ³¨æ„ï¼Œè¿™é‡Œconnectçš„å †æ ˆä¿¡æ¯ç”±äºstruct sockaddrçš„åŸå› ï¼Œæ— æ³•åˆ¤æ–­æ˜¯å¦çœŸå®è®¿é—®çš„æ˜¯8.8.8.8ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°è¯•å°†å…¶è½¬æ¢å›ï¼ˆé€šè¿‡inet_ntoaè½¬æ¢ipï¼Œé€šè¿‡ntohsè½¬æ¢ç«¯å£ï¼‰struct sockaddr_inæ¥åˆ†æï¼Œåˆ†æç»“æœï¼ˆIPåœ°å€ï¼Œç«¯å£å·ï¼‰å¦‚ä¸‹å›¾ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_122/extract_connect.png" alt="rep_img"/></center>
    </div>
</div>    
<p>â€ƒâ€ƒå› æ­¤æˆ‘ä»¬å¾—åˆ°äº†getaddrinfoçš„è®¿é—®8.8.8.8 dnsæœåŠ¡å™¨çš„è°ƒç”¨è·¯å¾„ï¼Œå…¶å€¼å¦‚ä¸‹ï¼š<br>
getaddrinfoâ€“&gt;gaih_inet-&gt;_nss_dns_gethostbyname3_r-&gt;gethostbyname3_context-&gt;__res_context_search-&gt;__res_context_querydomain-&gt;__res_context_query-&gt;__res_context_send-&gt;send_dg-&gt;reopen-&gt;__libc_connect è¿æ¥ dnsæœåŠ¡å™¨ï¼Œè§£ædns</p>
<br/>
<br/>
<h5 id="ç‰¹åˆ«æ³¨æ„ï¼š">ç‰¹åˆ«æ³¨æ„ï¼š</h5>
<p>è¿™é‡Œä»…ä»…æ˜¯æè¿°äº†é€šè¿‡dnsæœåŠ¡å™¨å¾—åˆ°ipçš„è¿‡ç¨‹ï¼Œå…¶å®ç›¸å¯¹äºgetaddrinfoçš„dnsè§£ææ¥è¯´ï¼Œè¿™åªæ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œè¿˜æœ‰é€šè¿‡ç±»ä¼¼nscdï¼ˆæœ‰å…´è¶£å¯ä»¥å»çœ‹çœ‹man systemd-resolvedï¼‰ç­‰ç­‰æ¥è§£æçš„æ–¹å¼ï¼Œè¿™äº›å†…å®¹æ„Ÿå…´è¶£å¯ä»¥å»çœ‹çœ‹ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="åè®°">åè®°</h3>
<hr>
<p>â€ƒâ€ƒæœ€åï¼Œå›åˆ°äº†æœ¬æ–‡çš„å¼€å§‹ï¼Œç»è¿‡ä¸Šè¿°çš„åˆ†æåï¼Œæˆ‘æ‰¾åˆ°äº†æˆ‘çš„é—®é¢˜çš„æœ¬è´¨åŸå› ã€‚æˆ‘é‡åˆ°çš„é—®é¢˜çš„æœ¬è´¨åŸå› æ˜¯ï¼šç”±äºæŸäº›ç‰¹æ®ŠåŸå› å¯¼è‡´äº†connect 114.114.114.114:53 æœåŠ¡å™¨çš„æ—¶å€™æŠ¥é”™äº†ï¼Œå¯¼è‡´è§£æåŸŸåå¤±è´¥ï¼Œå½“æˆ‘æ¢ä¸€ä¸ªåŸŸåæœåŠ¡å™¨ï¼ˆ8.8.8.8ï¼‰å°±è§£å†³äº†ã€‚</p>
<p>â€ƒâ€ƒæ€»çš„æ¥è¯´ï¼Œæœ¬æ–‡ä»ping baidu.comå…¥æ‰‹ï¼Œç„¶ååˆ†æäº†pingçš„æºç ï¼Œå¾—åˆ°äº†æˆ‘ä»¬è¦åˆ†æçš„é‡ç‚¹getaddrinfoã€‚ç„¶åæˆ‘ä»¬ç”±äºæ„é€ ä¸€ä¸ªå°ä¾‹å­æ¥åˆ†ægetaddrinfoçš„æºç ï¼Œæœ€ç»ˆå¾—åˆ°äº†/etc/resolv.confæ˜¯å› ä¸ºä»€ä¹ˆåŸå› ç”Ÿæ•ˆçš„ã€‚</p>
<p>â€ƒâ€ƒé€šè¿‡æœ¬æ–‡çš„åˆ†æï¼Œç›¸ä¿¡æˆ‘ä»¬å¯¹DNSçš„è§£æè¿‡ç¨‹æ˜¯æœ‰äº†ä¸€ä¸ªæ¯”è¾ƒæ¸…æ™°çš„äº†è§£äº†ï¼Œä»¥åé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ä¹Ÿèƒ½å¤Ÿæœ‰ä¸€ä¸ªå¥½çš„æ€è·¯æ¥è§£å†³é—®é¢˜ã€‚</p>
<h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>æ— </p>
</li>
</ul>
<br/>
<br/>
<div style="margin:50px auto;">
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <hr/>
        <center><font color = #91e0b0 size = 5>æ‰“èµã€è®¢é˜…ã€æ”¶è—ã€ä¸¢é¦™è•‰ã€ç¡¬å¸ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ï¼ˆæ”»åŸç‹®çš„æ¬ç –ä¹‹è·¯ï¼‰</font></center>
    </div>
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg" alt="qrc_img"/></center>
    </div>
</div>
<!-- ![alt å…¬ä¼—å·å›¾ç‰‡](https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg "å…¬ä¼—å·å›¾ç‰‡") -->
<p><font color="red" size="7">PS: è¯·å°Šé‡åŸåˆ›ï¼Œä¸å–œå‹¿å–·ã€‚</font><br/><br>
<font color="red" size="7">PS: è¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: æœ‰é—®é¢˜è¯·ç•™è¨€ï¼Œçœ‹åˆ°åæˆ‘ä¼šç¬¬ä¸€æ—¶é—´å›å¤ã€‚</font><br/></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://e-x.top/2023/07/02/blog_idx_121/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Sky">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sky's Blogs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Sky's Blogs">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/07/02/blog_idx_121/" class="post-title-link" itemprop="url">Linux å›¾å½¢æ ˆä»å…¥é—¨åˆ°æ”¾å¼ƒ --- Linux å›¾å½¢ç›¸å…³æ¦‚å¿µç®€ä»‹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-07-02 16:23:00" itemprop="dateCreated datePublished" datetime="2023-07-02T16:23:00+08:00">2023-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-18 19:06:02" itemprop="dateModified" datetime="2024-05-18T19:06:02+08:00">2024-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/android/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/android/linux/%E5%B8%B8%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">å¸¸è¯†</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>3.7k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>13 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <script src="\assets\js\APlayer.min.js"> </script><!--
 * @Description: 
 * @Author: Sky
 * @Date: 2020-08-24 16:37:34
 * @LastEditors: Sky
 * @LastEditTime: 2021-06-29 15:04:48
 * @Github: https://github.com/flyinskyin2013/
-->
<p><font color="red" size="7">PSï¼šè¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: è¿™ä¸ªåªæ˜¯åŸºäºã€Šæˆ‘è‡ªå·±ã€‹çš„ç†è§£ï¼Œ</font><br/><font color="red" size="7">å¦‚æœå’Œä½ çš„åŸåˆ™åŠæƒ³æ³•ç›¸å†²çªï¼Œè¯·è°…è§£ï¼Œå‹¿å–·ã€‚</font><br/></p>
<!-- ###### å‰ç½®è¯´æ˜
&emsp;&emsp;æœ¬æ–‡ä½œä¸ºæœ¬äººgithub blog/cnblogçš„ä¸»ç«™çš„å¤‡ä»½ã€‚ï¼ˆBlogID=121ï¼‰ 
&emsp;&emsp;æœ¬æ–‡å‘å¸ƒäº 2023-07-02 16:23             ï¼ˆBlogID=121ï¼‰ 
-->
<h6 id="ç¯å¢ƒè¯´æ˜">ç¯å¢ƒè¯´æ˜</h6>
<p>â€ƒâ€ƒæ— </p>
<h3 id="å‰è¨€">å‰è¨€</h3>
<hr>
<p>â€ƒâ€ƒåœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œåƒæˆ‘ä»¬å¸¸ç”¨çš„ubuntuï¼ˆLinuxï¼‰ï¼Œwindowsï¼Œandroidï¼Œmacç­‰ç­‰ç³»ç»Ÿï¼Œæˆ‘ä»¬éƒ½èƒ½å¤Ÿçœ‹åˆ°ä¸°å¯Œçš„å›¾å½¢ç•Œé¢ã€‚æ­¤å¤–ï¼Œå¦‚æœå¤§å®¶äº†è§£è¿‡ä»¥å‰çš„åµŒå…¥å¼ç³»ç»Ÿï¼Œå¾ˆå¤šçš„UIæ˜¯è‡ªå·±å†™ç¨‹åºæ¥ç”»çš„ã€‚é‚£ä¹ˆå¤§å®¶æ˜¯å¦æ€è€ƒè¿‡ä¸€ä¸ªé—®é¢˜ï¼Œè¿™äº›ç•Œé¢çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆï¼Ÿç•Œé¢æ˜¯æ€ä¹ˆæ˜¾ç¤ºå‡ºæ¥çš„å‘¢ï¼Ÿ</p>
<p>â€ƒâ€ƒæ­¤å¤–ï¼Œå¤§å®¶åœ¨å¹³å¸¸çš„æ—¶å€™ï¼Œå¦‚æœè¦å…³æ³¨è¿™æ–¹é¢å†…å®¹çš„è¯ï¼Œæœ‰ä¸€äº›è¯æ˜¯ç»å¸¸å¬åˆ°çš„ï¼Œä¾‹å¦‚ï¼šGPU, æ¸²æŸ“ï¼ŒOpenGLï¼ŒOpenGL ES, EGLï¼ŒOpenCLï¼ŒDRMï¼ŒDirectXï¼ŒX11, Waylandç­‰ç­‰ã€‚è¿™é‡Œçš„è¯æˆ–å¤šæˆ–å°‘éƒ½å’Œç•Œé¢æ˜¾ç¤ºæœ‰ç€ä¸€å®šçš„å…³ç³»ã€‚</p>
<p>â€ƒâ€ƒåœ¨è¿™ä¸ªæ–‡ç« ç³»åˆ—é‡Œé¢ï¼ˆæŒ–å‘ç³»åˆ—ï¼‰ï¼Œæˆ‘å°†ä¼šä»æ˜¾ç¤ºçš„ç†è®ºæ¦‚å¿µä¸Šå¼€å§‹ï¼Œé€æ­¥å¼•å…¥ç°åœ¨çš„ä¸»æµçš„æ˜¾ç¤ºæ–¹æ³•ã€‚ç„¶åå¯èƒ½ä¼šæŒ‘é€‰éƒ¨åˆ†æ˜¾ç¤ºè¿‡ç¨‹ä¸­çš„å†…å®¹ï¼Œç„¶åç»†è®²ä¸€ç‚¹ï¼Œæ¯•ç«Ÿè¿™ä¸ªå†…å®¹å¤ªå¤§äº†ï¼Œæˆ‘ä¹Ÿä»…ä»…æ˜¯äº†è§£å…¶ä¸­çš„ä¸€å°éƒ¨åˆ†ã€‚</p>
<p>â€ƒâ€ƒæœ€ç»ˆï¼Œæœ¬ç³»åˆ—æ–‡ç« çš„ç›®çš„è¿˜æ˜¯å¸®åŠ©æˆ‘è‡ªå·±æˆ–è€…å¤§å®¶èƒ½å¤Ÿå¯¹ç°åœ¨çš„ä¸»æµçš„ç³»ç»Ÿçš„æ˜¾ç¤ºç†è®ºæ¡†æ¶åŠä¸€äº›å¸¸è§çš„åŠŸèƒ½å’Œæ¦‚å¿µè¿›è¡Œç†Ÿæ‚‰ï¼Œä»¥åè‹¥é‡åˆ°å…³è”çš„å†…å®¹æˆ–è€…é—®é¢˜ï¼Œèƒ½å¤Ÿå¤§æ¦‚â€œæ„ŸçŸ¥â€åˆ°è¿™ä¸ªäº‹æƒ…æ˜¯å±äºæ˜¾ç¤ºçš„å“ªä¸ªéƒ¨åˆ†ã€‚</p>
<p>â€ƒâ€ƒä¸‹é¢ï¼Œè®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ï¼Œæ˜¾ç¤ºæ¡†æ¶çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="Windowing-System-ï¼ˆçª—å£ç³»ç»Ÿï¼‰">Windowing System ï¼ˆçª—å£ç³»ç»Ÿï¼‰</h3>
<hr>
<p>â€ƒâ€ƒæ­¤éƒ¨åˆ†æ ¹æ®ä»¥ä¸‹å‚è€ƒé“¾æ¥æ•´ç†ï¼š<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Windowing_system">https://en.wikipedia.org/wiki/Windowing_system</a></p>
<p>â€ƒâ€ƒåœ¨è®¡ç®—æœºä¸­ï¼Œçª—å£ç³»ç»Ÿï¼ˆæˆ–çª—å£ç³»ç»Ÿï¼‰æ˜¯åˆ†åˆ«ç®¡ç†æ˜¾ç¤ºå±ä¸åŒéƒ¨åˆ†çš„è½¯ä»¶ã€‚å®ƒæ˜¯ä¸€ç§å›¾å½¢ç”¨æˆ·ç•Œé¢(GUI)ï¼Œå®ƒä¸ºç”¨æˆ·ç•Œé¢å®ç°äº†WIMPï¼ˆçª—å£ã€å›¾æ ‡ã€èœå•ã€æŒ‡é’ˆï¼‰èŒƒä¾‹ã€‚</p>
<p>â€ƒâ€ƒæŠ€æœ¯ç»†èŠ‚ï¼šä»»ä½•çª—å£ç³»ç»Ÿçš„ä¸»è¦ç»„ä»¶é€šå¸¸ç§°ä¸ºæ˜¾ç¤ºæœåŠ¡å™¨ï¼Œå°½ç®¡çª—å£æœåŠ¡å™¨æˆ–åˆæˆå™¨ç­‰æ›¿ä»£åç§°ä¹Ÿåœ¨ä½¿ç”¨ä¸­ã€‚ä»»ä½•è¿è¡Œå¹¶åœ¨çª—å£ä¸­æ˜¾ç¤ºå…¶ GUI çš„åº”ç”¨ç¨‹åºéƒ½æ˜¯æ˜¾ç¤ºæœåŠ¡å™¨çš„å®¢æˆ·ç«¯ã€‚æ˜¾ç¤ºæœåŠ¡å™¨å’Œå®ƒçš„å®¢æˆ·ç«¯é€šè¿‡é€šä¿¡åè®®ç›¸äº’é€šä¿¡ï¼Œè¯¥åè®®é€šå¸¸è¢«ç§°ä¸ºæ˜¾ç¤ºæœåŠ¡å™¨åè®®ï¼Œæ˜¾ç¤ºæœåŠ¡å™¨æ˜¯å®¢æˆ·ç«¯å’Œç”¨æˆ·ä¹‹é—´çš„ä¸­ä»‹ã€‚</p>
<p>â€ƒâ€ƒè¿™é‡Œå¼•å…¥äº†æ˜¾ç¤ºæœåŠ¡å™¨åè®®ï¼Œæˆ‘ä»¬å¸¸è§çš„è‘—åçš„æ˜¾ç¤ºæœåŠ¡å™¨åè®®æœ‰ï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>X11 (ç±»unix)</p>
</li>
<li class="lvl-2">
<p>Wayland (ç±»unix)</p>
</li>
<li class="lvl-2">
<p>SurfaceFlinger (android)</p>
</li>
<li class="lvl-2">
<p>Quartz Compositor (macos)</p>
</li>
<li class="lvl-2">
<p>Desktop Window Manager (windows)</p>
</li>
</ul>
<p>â€ƒâ€ƒåœ¨è¿™é‡Œï¼Œæœ‰å‡ ä¸ªé‡è¦çš„æ¦‚å¿µéœ€è¦è®°ä½ï¼šçª—å£ç³»ç»Ÿï¼Œæ˜¾ç¤ºæœåŠ¡å™¨ï¼ˆçª—å£æœåŠ¡å™¨æˆ–åˆæˆå™¨ï¼‰ï¼Œæ˜¾ç¤ºæœåŠ¡å™¨åè®®ï¼Œæ˜¾ç¤ºæœåŠ¡å™¨åè®®å¯¹åº”çš„å®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥è®¤ä¸ºçª—å£ç³»ç»Ÿå°±æ˜¯è¿™äº›æ¦‚å¿µå½¢æˆçš„è½¯ä»¶é›†åˆã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="Window-manager-ï¼ˆçª—å£ç®¡ç†å™¨ï¼‰">Window manager ï¼ˆçª—å£ç®¡ç†å™¨ï¼‰</h3>
<p>â€ƒâ€ƒæ­¤éƒ¨åˆ†æ ¹æ®ä»¥ä¸‹å‚è€ƒé“¾æ¥æ•´ç†ï¼š<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Window_manager">https://en.wikipedia.org/wiki/Window_manager</a></p>
<p>â€ƒâ€ƒçª—å£ç®¡ç†å™¨æ˜¯ä¸€ç§ç³»ç»Ÿè½¯ä»¶ï¼Œç”¨äºæ§åˆ¶å›¾å½¢ç”¨æˆ·ç•Œé¢ä¸­çª—å£ç³»ç»Ÿå†…çª—å£çš„æ”¾ç½®å’Œå¤–è§‚ã€‚</p>
<p>â€ƒâ€ƒæˆ‘ä»¬å¸¸è§çš„åº”ç”¨å¹¿æ³›çš„çª—å£ç®¡ç†å™¨æœ‰ï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>gnome (ç±»unix)</p>
</li>
<li class="lvl-2">
<p>kde (ç±»unix)</p>
</li>
<li class="lvl-2">
<p>dwm (windows)</p>
</li>
</ul>
<p>â€ƒâ€ƒå¯¹äºçª—å£ç®¡ç†å™¨æ¥è¯´ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒå½“åšç®¡ç†å„ç§ç•Œé¢çš„ä¸€ä¸ªç¨‹åºå³å¯ï¼Œæ³¨æ„è¿™ä¸ªæ¦‚å¿µï¼Œç›¸å¯¹äºçª—å£ç³»ç»Ÿæ¥è¯´ï¼Œæˆ‘è‡ªå·±è®¤ä¸ºï¼šå¯ä»¥æ”¾åˆ°æ˜¾ç¤ºæœåŠ¡å™¨æˆ–è€…æ˜¾ç¤ºæœåŠ¡å™¨åè®®å¯¹åº”çš„å®¢æˆ·ç«¯é‡Œé¢ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="çª—å£ç³»ç»Ÿç›¸å…³æ¦‚å¿µä¸¾ä¾‹ï¼ˆä»¥Linuxä¸ºä¾‹ï¼‰">çª—å£ç³»ç»Ÿç›¸å…³æ¦‚å¿µä¸¾ä¾‹ï¼ˆä»¥Linuxä¸ºä¾‹ï¼‰</h3>
<hr>
<p>â€ƒâ€ƒåœ¨Linuxä¸­ï¼Œå…¶ä¸»æµæ¡Œé¢æœ‰ä¸¤ä¸ªå¸¸è§çš„æ¡†æ¶ï¼Œä¸€ä¸ªæ˜¯åŸºäºX11çš„æ˜¾ç¤ºæ¡†æ¶ï¼Œä¸€ä¸ªæ˜¯åŸºäºWaylandçš„æ˜¾ç¤ºæ¡†æ¶ã€‚</p>
<br/>
<br/>
<h5 id="X-Org-Foundation"><a target="_blank" rel="noopener" href="http://X.Org">X.Org</a> Foundation</h5>
<p>â€ƒâ€ƒæ­¤éƒ¨åˆ†æ ¹æ®ä»¥ä¸‹å‚è€ƒé“¾æ¥æ•´ç†ï¼š<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/X.Org_Foundation">https://en.wikipedia.org/wiki/X.Org_Foundation</a></p>
<p>â€ƒâ€ƒX.Org åŸºé‡‘ä¼šæ˜¯ä¸€å®¶éè¥åˆ©æ€§å…¬å¸ï¼Œå…¶æˆæƒç ”ç©¶ã€å¼€å‘ã€æ”¯æŒã€ç»„ç»‡ã€ç®¡ç†ã€æ ‡å‡†åŒ–ã€æ¨å¹¿å’Œæå«ä¸€ä¸ªå…è´¹å’Œå¼€æ”¾çš„åŠ é€Ÿå›¾å½¢å †æ ˆã€‚è¿™åŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹é¡¹ç›®ï¼šDRMã€Mesa 3Dã€Waylandå’ŒX Window Systemï¼ˆ<a target="_blank" rel="noopener" href="http://xn--X-xh0b.Org">åœ¨X.Org</a> Serverçš„å®ç°ä¸­ï¼‰ã€‚</p>
<p>â€ƒâ€ƒè¿™ä¸ªæ˜¯å®ç°X11ç›¸å…³çš„ä¸€ä¸ªå¼€æºç»„ç»‡ã€‚</p>
<br/>
<br/>
<h5 id="X-Window-System-X-X11">X Window System(X/X11)</h5>
<p>â€ƒâ€ƒæ­¤éƒ¨åˆ†æ ¹æ®ä»¥ä¸‹å‚è€ƒé“¾æ¥æ•´ç†ï¼š<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/X_Window_System">https://en.wikipedia.org/wiki/X_Window_System</a></p>
<p>â€ƒâ€ƒXçª—å£ç³»ç»Ÿï¼ˆX Window Systemï¼Œä¹Ÿå¸¸ç§°ä¸ºX11æˆ–Xï¼Œå¤©çª—å£ç³»ç»Ÿï¼‰æ˜¯ä¸€ç§ä»¥ä½å›¾æ–¹å¼æ˜¾ç¤ºçš„è½¯ä»¶çª—å£ç³»ç»Ÿã€‚æœ€åˆæ˜¯1984å¹´éº»çœç†å·¥å­¦é™¢çš„ç ”ç©¶ï¼Œä¹‹åå˜æˆUNIXã€ç±»UNIXã€ä»¥åŠOpenVMSç­‰æ“ä½œç³»ç»Ÿæ‰€ä¸€è‡´é€‚ç”¨çš„æ ‡å‡†åŒ–è½¯ä»¶å·¥å…·åŒ…åŠæ˜¾ç¤ºæ¶æ„çš„è¿ä½œåè®®ã€‚Xçª—å£ç³»ç»Ÿé€šè¿‡è½¯ä»¶å·¥å…·åŠæ¶æ„åè®®æ¥åˆ›å»ºæ“ä½œç³»ç»Ÿæ‰€ç”¨çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼Œæ­¤ååˆ™é€æ¸æ‰©å±•é€‚ç”¨åˆ°å„å½¢å„è‰²çš„å…¶ä»–æ“ä½œç³»ç»Ÿä¸Šã€‚ç°åœ¨å‡ ä¹æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿéƒ½èƒ½æ”¯æŒä¸ä½¿ç”¨Xã€‚æ›´é‡è¦çš„æ˜¯ï¼Œä»Šæ—¥çŸ¥åçš„æ¡Œé¢ç¯å¢ƒâ€”â€”GNOMEå’ŒKDEä¹Ÿéƒ½æ˜¯ä»¥Xçª—å£ç³»ç»Ÿä¸ºåŸºç¡€å»ºæ„æˆçš„ã€‚</p>
<p>â€ƒâ€ƒç”±äºXåªæ˜¯å·¥å…·åŒ…åŠæ¶æ„è§„èŒƒï¼Œæœ¬èº«å¹¶æ— å®é™…å‚ä¸è¿ä½œçš„å®ä½“ï¼Œæ‰€ä»¥å¿…é¡»æœ‰äººä¾æ®æ­¤æ ‡å‡†è¿›è¡Œå¼€å‘æ’°å†™ã€‚å¦‚æ­¤æ‰æœ‰çœŸæ­£å¯ç”¨ã€å¯æ‰§è¡Œçš„å®ä½“ï¼Œå§‹å¯ç§°ä¸ºå®ç°ä½“ã€‚ç›®å‰ä¾æ®Xçš„è§„èŒƒæ¶æ„æ‰€å¼€å‘æ’°å†™æˆçš„å®ç°ä½“ä¸­ï¼Œä»¥X.Orgæœ€ä¸ºæ™®éä¸”æœ€å—æ¬¢è¿ã€‚X.Orgæ‰€ç”¨çš„åè®®ç‰ˆæœ¬ï¼ŒX11ï¼Œæ˜¯åœ¨1987å¹´9æœˆæ‰€å‘å¸ƒã€‚è€Œä»Šæœ€æ–°çš„å‚è€ƒå®ç°ï¼ˆå‚è€ƒæ€§ã€ç¤ºèŒƒæ€§çš„å®ç°ä½“ï¼‰ç‰ˆæœ¬åˆ™æ˜¯X11 Release 7.7ï¼ˆç®€ç§°ï¼šX11R7.7ï¼‰ï¼Œè€Œæ­¤é¡¹ç›®ç”±X.OrgåŸºé‡‘ä¼šæ‰€é¢†å¯¼ï¼Œä¸”æ˜¯ä»¥MITæˆæƒå’Œç›¸ä¼¼çš„æˆæƒè®¸å¯çš„è‡ªç”±è½¯ä»¶ã€‚</p>
<p>â€ƒâ€ƒè¿™ä¸ªä½ å¯ä»¥ç†è§£ä¸ºæ˜¾ç¤ºæœåŠ¡å™¨åè®®ã€‚</p>
<h5 id="X-Org-X-Org-Server"><a target="_blank" rel="noopener" href="http://X.Org">X.Org</a> / <a target="_blank" rel="noopener" href="http://X.Org">X.Org</a> Server</h5>
<p>â€ƒâ€ƒæ­¤éƒ¨åˆ†æ ¹æ®ä»¥ä¸‹å‚è€ƒé“¾æ¥æ•´ç†ï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://x.org/wiki/">https://x.org/wiki/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Xorg">https://wiki.archlinux.org/title/Xorg</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/X.Org_Server">https://en.wikipedia.org/wiki/X.Org_Server</a></p>
</li>
</ul>
<p>â€ƒâ€ƒX.Org é¡¹ç›®æä¾›äº† X çª—å£ç³»ç»Ÿçš„å¼€æºå®ç°ã€‚å¼€å‘å·¥ä½œæ˜¯ä¸freedesktop.orgç¤¾åŒºä¸€èµ·å®Œæˆçš„ã€‚<a target="_blank" rel="noopener" href="http://X.Org">X.Org</a> åŸºé‡‘ä¼šæ˜¯ä¸€å®¶æ•™è‚²éè¥åˆ©æ€§å…¬å¸ï¼Œå…¶è‘£äº‹ä¼šä¸ºè¿™é¡¹å·¥ä½œæä¾›æœåŠ¡ï¼Œå…¶æˆå‘˜é¢†å¯¼è¿™é¡¹å·¥ä½œã€‚</p>
<p>â€ƒâ€ƒæ³¨æ„ï¼š<a target="_blank" rel="noopener" href="http://X.Org">X.Org</a> Server æ˜¯ X çª—å£ç³»ç»Ÿçš„X11æ˜¾ç¤ºå™¨æœåŠ¡åè®®çš„å®ç°ã€‚</p>
<p>â€ƒâ€ƒè¿™ä¸ªä½ å¯ä»¥ç†è§£ä¸ºæ˜¾ç¤ºæœåŠ¡å™¨ã€‚</p>
<br/>
<br/>
<h5 id="Wayland">Wayland</h5>
<p>â€ƒâ€ƒæ­¤éƒ¨åˆ†æ ¹æ®ä»¥ä¸‹å‚è€ƒé“¾æ¥æ•´ç†ï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/wayland">https://wiki.archlinux.org/title/wayland</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/wayland-project/wayland">https://github.com/wayland-project/wayland</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://wayland.freedesktop.org/building.html">https://wayland.freedesktop.org/building.html</a></p>
</li>
</ul>
<p>â€ƒâ€ƒWaylandæ˜¯ä¸€ç§æ˜¾ç¤ºæœåŠ¡å™¨åè®®ã€‚å®ƒçš„ç›®æ ‡æ˜¯æˆä¸ºX Window Systemçš„ç»§ä»»è€…ã€‚</p>
<p>â€ƒâ€ƒæ³¨æ„ï¼šWaylandçš„æ—¢æ˜¯ä¸€ç§çª—å£ç³»ç»Ÿï¼Œä¹Ÿæ˜¯ä¸€ç§æ˜¾ç¤ºæœåŠ¡å™¨åè®®ã€‚</p>
<br/>
<br/>
<h5 id="Weston-Compositor">Weston Compositor</h5>
<p>â€ƒâ€ƒæ­¤éƒ¨åˆ†æ ¹æ®ä»¥ä¸‹å‚è€ƒé“¾æ¥æ•´ç†ï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://wayland.freedesktop.org/">https://wayland.freedesktop.org/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://gitlab.freedesktop.org/wayland/weston/-/blob/master/README.md">https://gitlab.freedesktop.org/wayland/weston/-/blob/master/README.md</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/wayland-project/wayland">https://github.com/wayland-project/wayland</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://wayland.freedesktop.org/building.html">https://wayland.freedesktop.org/building.html</a></p>
</li>
</ul>
<p>â€ƒâ€ƒWayland é¡¹ç›®çš„ä¸€éƒ¨åˆ†ä¹Ÿæ˜¯ Wayland åˆæˆå™¨çš„ Weston å‚è€ƒå®ç°ã€‚Weston å¯ä»¥ä½œä¸º X å®¢æˆ·ç«¯æˆ–åœ¨ Linux KMS ä¸‹è¿è¡Œï¼Œå¹¶é™„å¸¦ä¸€äº›æ¼”ç¤ºå®¢æˆ·ç«¯ã€‚Weston åˆæˆå™¨æ˜¯ä¸€ä¸ªæœ€å°ä¸”å¿«é€Ÿçš„åˆæˆå™¨ï¼Œé€‚ç”¨äºè®¸å¤šåµŒå…¥å¼å’Œç§»åŠ¨ç”¨ä¾‹ã€‚</p>
<p>â€ƒâ€ƒæ³¨æ„ï¼šwestonæ˜¯waylandæ˜¾ç¤ºå™¨æœåŠ¡åè®®çš„å¼€æºå‚è€ƒå®ç°ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="Linux-æ˜¾ç¤ºçš„ä¸»æµæ˜¾ç¤ºæ¡†æ¶æ¶æ„å›¾">Linux æ˜¾ç¤ºçš„ä¸»æµæ˜¾ç¤ºæ¡†æ¶æ¶æ„å›¾</h3>
<hr>
<p>â€ƒâ€ƒ</p>
<br/>
<br/>
<h5 id="X-Architecture">X Architecture</h5>
<p>â€ƒâ€ƒæ­¤éƒ¨åˆ†æ ¹æ®ä»¥ä¸‹å‚è€ƒé“¾æ¥æ•´ç†ï¼š<a target="_blank" rel="noopener" href="https://wayland.freedesktop.org/architecture.html">https://wayland.freedesktop.org/architecture.html</a></p>
<p>â€ƒâ€ƒX èµ·æºäº 1984 å¹´éº»çœç†å·¥å­¦é™¢ (MIT)é›…å…¸å¨œè®¡åˆ’çš„ä¸€éƒ¨åˆ†ã€‚ è‡ª 1987 å¹´ 9 æœˆä»¥æ¥ï¼ŒX åè®®ä¸€ç›´å¤„äºç‰ˆæœ¬ 11ï¼ˆå› æ­¤ä¸ºâ€œX11â€ï¼‰ã€‚<a target="_blank" rel="noopener" href="http://X.Org">X.Org</a> åŸºé‡‘ä¼šé¢†å¯¼ X é¡¹ç›®ï¼Œ<a target="_blank" rel="noopener" href="http://xn--X-so6av9kwubp9svrfyr5bozefzy.Org">ä¸å½“å‰çš„å‚è€ƒå®ç°X.Org</a> Serveråœ¨MIT è®¸å¯å’Œç±»ä¼¼çš„è®¸å¯è®¸å¯ ä¸‹ä½œä¸ºå…è´¹å’Œå¼€æºè½¯ä»¶æä¾›ã€‚</p>
<p>â€ƒâ€ƒå…¶æŠ€æœ¯æ¶æ„å›¾å¦‚ä¸‹ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_121/x_architecture.png" alt="rep_img"/></center>
    </div>
</div>    
<br/>
<br/>
<h5 id="Wayland-Architecture">Wayland Architecture</h5>
<p>â€ƒâ€ƒæ­¤éƒ¨åˆ†æ ¹æ®ä»¥ä¸‹å‚è€ƒé“¾æ¥æ•´ç†ï¼š<a target="_blank" rel="noopener" href="https://wayland.freedesktop.org/architecture.html">https://wayland.freedesktop.org/architecture.html</a></p>
<p>â€ƒâ€ƒWayland æ˜¯ä¸€ä¸ªåˆæˆå™¨ä¸å…¶å®¢æˆ·å¯¹è¯çš„åè®®ï¼Œä¹Ÿæ˜¯è¯¥åè®®çš„ C åº“å®ç°ã€‚åˆæˆå™¨å¯ä»¥æ˜¯åœ¨ Linux å†…æ ¸æ¨¡å¼è®¾ç½®å’Œ evdev è¾“å…¥è®¾å¤‡ä¸Šè¿è¡Œçš„ç‹¬ç«‹æ˜¾ç¤ºæœåŠ¡å™¨ã€X åº”ç”¨ç¨‹åºæˆ– Wayland å®¢æˆ·ç«¯æœ¬èº«ã€‚</p>
<p>â€ƒâ€ƒå…¶æŠ€æœ¯æ¶æ„å›¾å¦‚ä¸‹ï¼š<br>
wayland_architecture.png</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_121/wayland_architecture.png" alt="rep_img"/></center>
    </div>
</div>    
<br/>
<br/>
<h5 id="XWayland">XWayland</h5>
<p>â€ƒâ€ƒæ­¤éƒ¨åˆ†æ ¹æ®ä»¥ä¸‹å‚è€ƒé“¾æ¥æ•´ç†ï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://wayland.freedesktop.org/xserver.html">https://wayland.freedesktop.org/xserver.html</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://wayland.freedesktop.org/docs/html/ch05.html">https://wayland.freedesktop.org/docs/html/ch05.html</a></p>
</li>
</ul>
<p>â€ƒâ€ƒXwayland æ˜¯ä¸€ä¸ªå®Œæ•´çš„ X11 æœåŠ¡å™¨ï¼Œå°±åƒ Xorg ä¸€æ ·ï¼Œä½†å®ƒä¸æ˜¯é©±åŠ¨æ˜¾ç¤ºå™¨å’Œæ‰“å¼€è¾“å…¥è®¾å¤‡ï¼Œè€Œæ˜¯å……å½“ Wayland å®¢æˆ·ç«¯ã€‚</p>
<p>â€ƒâ€ƒå…¶æŠ€æœ¯æ¶æ„å›¾å¦‚ä¸‹ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_121/xwayland_architecture.png" alt="rep_img"/></center>
    </div>
</div>    
<br/>
<br/>
<br/>
<br/>
<h3 id="OpenGL-å’Œ-Linuxæ˜¾ç¤ºçš„å…³ç³»å›¾">OpenGL å’Œ Linuxæ˜¾ç¤ºçš„å…³ç³»å›¾</h3>
<p>â€ƒâ€ƒå‡ºå¤„ï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh/File:Linux_kernel_and_OpenGL_video_games.svg">https://zh.wikipedia.org/zh/File:Linux_kernel_and_OpenGL_video_games.svg</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.kernel.org/doc/html/latest/gpu/index.html">https://www.kernel.org/doc/html/latest/gpu/index.html</a></p>
</li>
</ul>
<p>â€ƒâ€ƒå…¶æŠ€æœ¯æ¶æ„å›¾å¦‚ä¸‹ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_121/opengl_and_linux.png" alt="rep_img"/></center>
    </div>
</div>    
<p>â€ƒâ€ƒå…ˆæ˜ç¡®3ä¸ªæ¦‚å¿µï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>OpenGLç”¨æ¥ä»ç®€å•çš„å›¾å½¢æ¯”ç‰¹ç»˜åˆ¶å¤æ‚çš„ä¸‰ç»´æ™¯è±¡ã€‚</p>
</li>
<li class="lvl-2">
<p>Mesaä¹Ÿç§°ä¸ºMesa3Då’ŒMesa 3D å›¾å½¢åº“ï¼Œæ˜¯OpenGLã€Vulkanå’Œå…¶ä»–å›¾å½¢APIè§„èŒƒçš„å¼€æºå®ç°ã€‚æˆ‘ä»¬çš„æ¸¸æˆå¼•æ“ç­‰å°±æ˜¯åŸºäºmesa3Dæˆ–è€…ç›´æ¥åŸºäºSDL,GLFWç­‰çª—å£åº“æ¥åšç›¸å…³çš„å›¾å½¢åŒ–å®ç°ã€‚mesa3Dèµ°DRMæ¥å£ã€‚</p>
</li>
<li class="lvl-2">
<p>ç›´æ¥æ¸²æŸ“ç®¡ç†å™¨( DRM ) æ˜¯Linux å†…æ ¸çš„ä¸€ä¸ªå­ç³»ç»Ÿï¼Œè´Ÿè´£ä¸ç°ä»£è§†é¢‘å¡çš„GPUè¿æ¥ã€‚å…¶å¤§æ¦‚åŒ…å«ä¸¤ç±»è¡Œä¸ºGraphics Execution Manager (GEM)å’ŒKernel Mode-Setting (KMS)ï¼ŒKMSæ§åˆ¶æ˜¾ç¤ºæ§åˆ¶å™¨ï¼Œç›´æ¥å¤„ç†å’Œæ˜¾ç¤ºå™¨ç›¸å…³çš„ä¸œè¥¿ã€‚GEMä¸»è¦æ˜¯å¤„ç†æ˜¾å­˜ç®¡ç†ã€å¤„ç†ç›¸å…³çš„å†…å®¹ã€‚</p>
</li>
</ul>
<br/>
<br/>
<br/>
<br/>
<h3 id="ä»¥Waylandä¸ºä¾‹çš„Linuxæ˜¾ç¤ºæ¡†æ¶">ä»¥Waylandä¸ºä¾‹çš„Linuxæ˜¾ç¤ºæ¡†æ¶</h3>
<p>â€ƒâ€ƒå‡ºå¤„ï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh/File:Linux_kernel_and_OpenGL_video_games.svg">https://zh.wikipedia.org/zh/File:Linux_kernel_and_OpenGL_video_games.svg</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.kernel.org/doc/html/latest/gpu/index.html">https://www.kernel.org/doc/html/latest/gpu/index.html</a></p>
</li>
</ul>
<p>â€ƒâ€ƒå…¶æŠ€æœ¯æ¶æ„å›¾å¦‚ä¸‹ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_121/LinuxGraphicStackAndGlamor.png" alt="rep_img"/></center>
    </div>
</div>    
<p>â€ƒâ€ƒè¿™é‡Œæˆ‘ä»¬ä»3ä¸ªç»´åº¦è¿›è¡Œåˆ†æï¼š</p>
<ol>
<li class="lvl-3">
<p>3Dæ¸¸æˆå¼•æ“ï¼Œç›´æ¥åŸºäºç›¸å…³çš„OpenGLæ¥å£è¿›è¡Œå¼€å‘ï¼Œå®Œæˆå›¾å½¢å›¾åƒç›¸å…³çš„å¤„ç†ã€‚äº‹ä»¶å¤„ç†å…¶å®è¿˜æ˜¯åŸºäºlibinputã€‚</p>
</li>
<li class="lvl-3">
<p>åœ¨Xçš„æ¶æ„æ¨¡å¼ä¸‹é¢ï¼Œ<a target="_blank" rel="noopener" href="http://X.Org">X.Org</a> Serverä¸ºæ˜¾ç¤ºæœåŠ¡å™¨åè®®çš„å®ç°ï¼Œå…¶çª—å£ç®¡ç†å™¨ä¸ºgnomeå’Œkdeè¿™æ ·çš„æ¡Œé¢ç®¡ç†è½¯ä»¶ï¼Œå…¶å®¢æˆ·ç«¯æ˜¯libXæˆ–è€…libXCBã€‚å…¶ç›´æ¥åŸºäºopenglæˆ–è€…eglå¼€å‘ï¼Œæ³¨æ„å›¾å½¢åŠ é€Ÿéƒ¨åˆ†æ”¾åœ¨Xæ˜¾ç¤ºæœåŠ¡å™¨ä¸Šçš„ã€‚</p>
</li>
<li class="lvl-3">
<p>åœ¨Waylandçš„æ¶æ„æ¨¡å¼ä¸‹é¢ï¼Œå…¶æœ‰waylandå®¢æˆ·ç«¯ï¼Œæœ‰waylandåˆæˆå™¨ï¼Œæœ‰walylandçª—å£ç®¡ç†å™¨ã€‚ä¸ºäº†å…¼å®¹å¤§é‡çš„x11ç¨‹åºï¼Œæœ‰Xçª—å£ç®¡ç†å™¨ï¼Œå¯¹äºXWalylandçš„ä¸€ä¸ªå®¢æˆ·ç«¯ã€‚æ³¨æ„ï¼Œå¯¹äºçœŸæ­£çš„waylandæ¥è¯´ï¼Œå…¶å›¾å½¢åŠ é€Ÿéƒ¨åˆ†åœ¨waylandå®¢æˆ·ç«¯ä¸Šï¼Œè¿™æ ·å°‘äº†å¾ˆå¤šäº¤äº’é€šä¿¡çš„å†…å®¹ï¼Œæ•´ä½“æŠ€æœ¯ç»“æ„æ›´åŠ çš„æ˜æ™°å’Œé«˜æ•ˆã€‚</p>
</li>
</ol>
<br/>
<br/>
<br/>
<br/>
<h3 id="å…³äºAndroidçš„å›¾å½¢å †æ ˆï¼ˆSurfaceFlingerå’ŒWindowManagerï¼‰">å…³äºAndroidçš„å›¾å½¢å †æ ˆï¼ˆSurfaceFlingerå’ŒWindowManagerï¼‰</h3>
<p>â€ƒâ€ƒæ­¤éƒ¨åˆ†æ ¹æ®ä»¥ä¸‹å‚è€ƒé“¾æ¥æ•´ç†ï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://source.android.com/devices/graphics/surfaceflinger-windowmanager">https://source.android.com/devices/graphics/surfaceflinger-windowmanager</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://source.android.com/devices/graphics">https://source.android.com/devices/graphics</a></p>
</li>
</ul>
<p>â€ƒâ€ƒSurfaceFlinger æ¥å—ç¼“å†²åŒºï¼Œå¯¹å®ƒä»¬è¿›è¡Œåˆæˆï¼Œç„¶åå‘é€åˆ°å±å¹•ã€‚WindowManager ä¸º SurfaceFlinger æä¾›ç¼“å†²åŒºå’Œçª—å£å…ƒæ•°æ®ï¼Œè€Œ SurfaceFlinger å¯ä½¿ç”¨è¿™äº›ä¿¡æ¯å°† Surface åˆæˆåˆ°å±å¹•ã€‚</p>
<p>â€ƒâ€ƒå…¶æŠ€æœ¯æ¶æ„å›¾å¦‚ä¸‹ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_121/android_graphic.png" alt="rep_img"/></center>
    </div>
</div>    
<p>â€ƒâ€ƒandroidçš„WindowManagerç®¡ç†å’Œæä¾›çª—å£metaä¿¡æ¯ï¼ŒSurfaceFlingerä»bufferå’ŒWindowManagerä¸­å–å¾—å›¾åƒå’Œmetaä¿¡æ¯ï¼Œç„¶åé€šè¿‡halå±‚ï¼Œåšå›¾åƒç¡¬ä»¶åŠ é€Ÿï¼Œå¦‚ï¼švulkanæˆ–è€…eglç­‰ï¼Œç„¶åé€åˆ°æ˜¾ç¤ºå±å¹•ã€‚æˆ‘æµ‹è¯•è¿‡ï¼Œandroidèµ°äº†vulkanå’Œeglåï¼Œæœ€ç»ˆè¿˜æ˜¯èµ°drmæ¥å£ï¼Œæœ€ç»ˆæŠŠå›¾é€ä¸ªå±å¹•ã€‚æœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥ä½¿ç”¨drmæµ‹è¯•ç¨‹åºæ¥æµ‹è¯•ã€‚</p>
<p>â€ƒâ€ƒå…¶å®æˆ‘ä»¬çœ‹äº†androidçš„æ˜¾ç¤ºæ¡†æ¶åï¼Œä½ ä¼šå‘ç°å’Œä¼ ç»Ÿçš„Linuxæ¯”è¾ƒç›¸åƒï¼ŒåŒæ—¶ï¼Œä½ å¯ä»¥æ›´åŠ æ·±å…¥çš„ç†è§£Androidå’ŒLinuxä¹‹é—´çš„ä¸€äº›è”ç³»ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="åè®°">åè®°</h3>
<hr>
<p>â€ƒâ€ƒä¸Šé¢çš„å‡ ä¸ªæ¦‚å¿µæ˜¯å®¹æ˜“è®©äººç–‘æƒ‘çš„ï¼Œé¦–å…ˆæœ‰çª—å£ç³»ç»Ÿè¿™ä¸ªæ¦‚å¿µï¼Œçª—å£ç³»ç»Ÿçš„åŸºæœ¬ç»„ä»¶ä¸ºæ˜¾ç¤ºæœåŠ¡å™¨ï¼Œåœ¨æ˜¾ç¤ºå™¨ä¸Šæ˜¾ç¤ºçš„ç”¨æˆ·GUIç¨‹åºå«åšæ˜¾ç¤ºæœåŠ¡å™¨çš„å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡åè®®å«åšæ˜¾ç¤ºæœåŠ¡å™¨åè®®ã€‚é™¤äº†æ˜¾ç¤ºæœåŠ¡å™¨ï¼Œè¿˜æœ‰ä¸€ä¸ªå«åšçª—å£ç®¡ç†å™¨çš„æ¦‚å¿µã€‚</p>
<p>â€ƒâ€ƒå¯¹äºLinuxæ¥è¯´ï¼Œå…¶çª—å£æœåŠ¡å™¨æœ‰ä¸¤ä¸ªåº”ç”¨æ¯”è¾ƒå¹¿æ³›ï¼Œä¸€ä¸ªå«åšXæ˜¾ç¤ºæœåŠ¡å™¨ï¼Œä¸€ä¸ªå«åšWaylandæ˜¾ç¤ºæœåŠ¡å™¨ï¼Œå®ƒä»¬å¯¹åº”çš„æ˜¾ç¤ºæœåŠ¡å™¨åè®®åˆ†åˆ«æ˜¯X11å’ŒWaylandåè®®ï¼ŒåŒç†ï¼Œ<a target="_blank" rel="noopener" href="http://xn--X-so6aphn5lkf80e9wa537bmxae6r77awz9cu2y43pf5joj2bwp5b.Org">ä¸ä¹‹åè®®å¯¹åº”çš„å¼€æºå‚è€ƒå®ç°åˆ†åˆ«æ˜¯X.Org</a> Server å’Œ Weston Compositorã€‚æ³¨æ„è¿™é‡Œçš„XWaylandï¼Œå…¶ä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹å¤§é‡è€çš„åŸºäºX11çš„ç¨‹åºæå‡ºçš„ä¸€ç§æ›¿ä»£æ–¹æ¡ˆï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯ä½œä¸ºWaylandæ˜¾ç¤ºæœåŠ¡å™¨çš„ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œèµ·åˆ°ä¸€ä¸ªä»£ç†çš„ä½œç”¨ã€‚</p>
<p>â€ƒâ€ƒä»&quot;OpenGL å’Œ Linuxæ˜¾ç¤ºçš„å…³ç³»å›¾&quot; ä»¥åŠ &quot;ä»¥Waylandä¸ºä¾‹çš„Linuxæ˜¾ç¤ºæ¡†æ¶&quot;ä¸¤ä¸ªå°èŠ‚çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥å¤§æ¦‚æå‰çš„çŸ¥é“æ˜¾ç¤ºæ˜¯ä¸€ä¸ªä»€ä¹ˆä¸œè¥¿ã€‚</p>
<p>â€ƒâ€ƒæœ€åï¼Œæˆ‘ä»¬æœ€ç»ˆè¦å¾—åˆ°ä¸¤ä¸ªè¯ï¼šâ€œæ¸²æŸ“â€ï¼Œâ€œæ˜¾ç¤ºâ€ã€‚ æˆ‘ä»¬æåˆ°çš„çª—å£ç³»ç»Ÿé‡Œé¢çš„æ¦‚å¿µï¼Œå¤§éƒ¨åˆ†å†…å®¹å°±æ˜¯å¯¹è¿™ä¸¤ä¸ªè¯çš„åº”ç”¨ã€‚</p>
<h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>æ— </p>
</li>
</ul>
<br/>
<br/>
<div style="margin:50px auto;">
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <hr/>
        <center><font color = #91e0b0 size = 5>æ‰“èµã€è®¢é˜…ã€æ”¶è—ã€ä¸¢é¦™è•‰ã€ç¡¬å¸ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ï¼ˆæ”»åŸç‹®çš„æ¬ç –ä¹‹è·¯ï¼‰</font></center>
    </div>
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg" alt="qrc_img"/></center>
    </div>
</div>
<!-- ![alt å…¬ä¼—å·å›¾ç‰‡](https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg "å…¬ä¼—å·å›¾ç‰‡") -->
<p><font color="red" size="7">PS: è¯·å°Šé‡åŸåˆ›ï¼Œä¸å–œå‹¿å–·ã€‚</font><br/><br>
<font color="red" size="7">PS: è¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: æœ‰é—®é¢˜è¯·ç•™è¨€ï¼Œçœ‹åˆ°åæˆ‘ä¼šç¬¬ä¸€æ—¶é—´å›å¤ã€‚</font><br/></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://e-x.top/2022/07/31/blog_idx_117/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Sky">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sky's Blogs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Sky's Blogs">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/31/blog_idx_117/" class="post-title-link" itemprop="url">é«˜é€šcDSPç®€å•ç¼–ç¨‹ä¾‹å­ï¼ˆå®ç°æŸ¥è¯¢é«˜é€šcDSPä½¿ç”¨ç‡ã€ç­¾åï¼‰ï¼ŒRK3588 npuä½¿ç”¨ç‡æŸ¥è¯¢</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-07-31 18:11:00" itemprop="dateCreated datePublished" datetime="2022-07-31T18:11:00+08:00">2022-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-18 19:06:02" itemprop="dateModified" datetime="2024-05-18T19:06:02+08:00">2024-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/C-CPP/" itemprop="url" rel="index"><span itemprop="name">C&CPP</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/C-CPP/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>2.4k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>9 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <script src="\assets\js\APlayer.min.js"> </script><!--
 * @Description: 
 * @Author: Sky
 * @Date: 2020-08-24 16:37:34
 * @LastEditors: Sky sky@sky-home.com
 * @LastEditTime: 2022-08-14 20:46:57
 * @Github: https://github.com/flyinskyin2013/
-->
<p><font color="red" size="7">PSï¼šè¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: è¿™ä¸ªåªæ˜¯åŸºäºã€Šæˆ‘è‡ªå·±ã€‹çš„ç†è§£ï¼Œ</font><br/><font color="red" size="7">å¦‚æœå’Œä½ çš„åŸåˆ™åŠæƒ³æ³•ç›¸å†²çªï¼Œè¯·è°…è§£ï¼Œå‹¿å–·ã€‚</font><br/></p>
<!-- ###### å‰ç½®è¯´æ˜
&emsp;&emsp;æœ¬æ–‡ä½œä¸ºæœ¬äººcsdn blogçš„ä¸»ç«™çš„å¤‡ä»½ã€‚ï¼ˆBlogID=117ï¼‰ 
&emsp;&emsp;æœ¬æ–‡å‘å¸ƒäº 2022-07-31 18:11:29  ï¼ˆBlogID=117ï¼‰ 
-->
<h6 id="ç¯å¢ƒè¯´æ˜">ç¯å¢ƒè¯´æ˜</h6>
<ul class="lvl-0">
<li class="lvl-2">
<p>é«˜é€š865 androidç›’å­</p>
</li>
<li class="lvl-2">
<p>Hexagon_SDK</p>
</li>
</ul>
<h3 id="å‰è¨€">å‰è¨€</h3>
<hr>
<p>â€ƒâ€ƒç”±äºä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦å±•ç¤ºé«˜é€š865çš„cpu/gpu/dspçš„ä½¿ç”¨ç‡ï¼Œå…¶ä¸­cpu/gpuæ˜¯éå¸¸ç®€å•çš„ã€‚ä½†æ˜¯å¯¹äºdspæ¥è¯´ï¼Œæˆ‘æ‰¾äº†è®¸ä¹…ï¼Œæ‰å‘ç°äº†ä¸€ç‚¹ç‚¹ç«¯å€ªï¼Œä¸‹é¢å°±æ˜¯è¿™ä¸€éƒ¨åˆ†æˆæœã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="é«˜é€šcDSPä½¿ç”¨ç‡æŸ¥è¯¢">é«˜é€šcDSPä½¿ç”¨ç‡æŸ¥è¯¢</h3>
<hr>
<p>â€ƒâ€ƒè¦å®ç°é«˜é€šdspä½¿ç”¨ç‡çš„æŸ¥è¯¢ï¼Œæˆ‘ä»¬æœ€å¼€å§‹æŸ¥è¯¢åˆ°çš„ä¸€ç‚¹èµ„æ–™æ˜¯ä¸€ä¸ªsysmon toolsï¼Œè¿™ä¸ªå·¥å…·åœ¨é«˜é€šçš„sdkä¸­ï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥æŸ¥çœ‹ç›¸å…³çš„åˆ©ç”¨ç‡ï¼Œæ‰€ä»¥æˆ‘ä»¬æŒ‰ç…§è¿™ä¸ªæ–¹å‘èµ°ä¸‹å»ã€‚</p>
<br/>
<br/>
<h5 id="å®‰è£…é«˜é€šdsp-sdk">å®‰è£…é«˜é€šdsp sdk</h5>
<p>â€ƒâ€ƒå»æ­¤ç½‘ç«™ä¸‹è½½sdkå¹¶å®‰è£…ï¼ˆ<a target="_blank" rel="noopener" href="https://developer.qualcomm.com/software/hexagon-dsp-sdk/tools%EF%BC%89">https://developer.qualcomm.com/software/hexagon-dsp-sdk/toolsï¼‰</a> ã€‚æ³¨æ„ï¼Œå®‰è£…éœ€è¦javaç¯å¢ƒï¼Œè¯·è‡ªå¤‡ã€‚</p>
<p>â€ƒâ€ƒç„¶åæˆ‘ä»¬éœ€è¦æ£€æŸ¥æˆ‘ä»¬çš„ç¯å¢ƒé…ç½®ã€‚</p>
<p>â€ƒâ€ƒå‚è€ƒSDKç›®å½•ä¸­Hexagon_SDK/3.5.4/docs/calculator_c++.htmlï¼Œç„¶åè¿›å…¥Hexagon_SDK\3.5.4\examples\common\calculator_c++ç›®å½•ï¼Œç¼–è¯‘ç”Ÿæˆtargetæ–‡ä»¶åŠæ¨¡æ‹Ÿæ–‡ä»¶ã€‚ç„¶åå®‰è£…æ•™ç¨‹ï¼Œå°†è®¡ç®—å™¨ä¾‹å­æ‹·è´åˆ°è®¾å¤‡ç›¸å…³ç›®å½•è¿›è¡Œè¿è¡Œï¼ŒæˆåŠŸå¾—åˆ°è®¡ç®—ç»“æœã€‚è¿™ä»£è¡¨ç¯å¢ƒé…ç½®æ­£ç¡®ã€‚</p>
<p>â€ƒâ€ƒæ³¨æ„ï¼šè¿™é‡Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼Œå¤šçœ‹æ–‡æ¡£ï¼Œå¤šå¯¹æ¯”ã€‚ç‰¹åˆ«æ˜¯è®¾å¤‡å¯¹åº”çš„dspå·¥å…·é“¾é€‰å¯¹ï¼Œè¯¦æƒ…å‚è€ƒï¼šHexagon_SDK/3.5.4/docs/feature_matrix.htmlã€‚</p>
<p>â€ƒâ€ƒåœ¨è¿™ä¸€æ­¥çš„è®¡ç®—å™¨ä¾‹å­æ‰§è¡Œå®Œæˆä¹‹åï¼ŒåŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬åº”è¯¥çŸ¥é“ç”Ÿæˆçš„æ–‡ä»¶æœ‰3ä¸ªï¼Œä¸€ä¸ªæ˜¯android adb å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯å¯æ‰§è¡Œæ–‡ä»¶å¯¹åº”çš„ndkåº“ã€‚ä¸€ä¸ªæ˜¯ndkåº“å¯¹åº”çš„dspè°ƒç”¨soã€‚å®ƒä»¬ä¹‹é—´çš„å…³ç³»æ˜¯æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼ŒæŸ¥æ‰¾å¯¹åº”çš„ç¬¦å·ï¼Œç„¶åé€šè¿‡fastrpcè°ƒç”¨dspå¯¹åº”çš„ç¬¦å·ï¼Œå¹¶å¾—åˆ°ç»“æœã€‚è¯¦æƒ…å‚è€ƒï¼šHexagon_SDK/3.5.4/docs/APIs_FastRPC.html#FastRPC%20architecture</p>
<br/>
<br/>
<h5 id="é«˜é€šcDSPä½¿ç”¨ç‡æŸ¥è¯¢åŸç†åˆ†æ">é«˜é€šcDSPä½¿ç”¨ç‡æŸ¥è¯¢åŸç†åˆ†æ</h5>
<p>â€ƒâ€ƒåœ¨Hexagon_SDK\3.5.4\tools\utils\sysmonï¼Œå½“æˆ‘æŠŠsysMon_DSP_Profiler_V2.apkå®‰è£…åˆ°ç³»ç»Ÿåï¼Œç»ˆäºçœ‹åˆ°äº†cDSPä½¿ç”¨ç‡æŸ¥è¯¢çš„ä¸€ä¸æ–¹æ³•ã€‚ä»å›¾ä¸­å¯çŸ¥ï¼Œæˆ‘ä»¬å¾—åˆ°äº†dspçš„å½“å‰å·¥ä½œé¢‘ç‡ï¼Œä»¥åŠå½“å‰çš„ä½¿ç”¨ç‡ã€‚ä½†æ˜¯æˆ‘çš„éœ€æ±‚æ˜¯åˆ¶ä½œä¸€ä¸ªå°å·¥å…·ï¼Œèƒ½å¤Ÿç›´æ¥æ‰“å°å‡ºcore utilizationï¼Œæ‰€ä»¥éœ€è¦æƒ³å…¶ä»–åŠæ³•ã€‚</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_117/dsp_info.png" alt="rep_img"/></center>
    </div>
</div>    
<p>â€ƒâ€ƒå½“æˆ‘äº†è§£åˆ°è¿™äº›å†…å®¹åï¼Œå°±å¾—æŠŠç›®æ ‡æ”¾åœ¨é«˜é€šsdké‡Œé¢çš„perfç›¸å…³å†…å®¹é‡Œé¢ï¼Œæˆ‘æŸ¥è¯¢äº†ç›¸å…³apiå’Œæ–‡æ¡£åï¼ˆHexagon_SDK/3.5.4/docs/APIs_DSP%20Clk%20&amp;%20Rsrc%20Mgmt.htmlï¼‰ï¼Œå‘ç°äº†ä¸¤ä¸ªç›¸å…³çš„å†…å®¹ï¼ŒDSP Power and Performance Management ä»¥åŠ HAP PMU frameworkã€‚ä½†æ˜¯è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘è¿˜æ˜¯æ²¡æœ‰åŠæ³•çŸ¥é“å®˜æ–¹çš„å·¥å…·é‡Œé¢æ˜¾ç¤ºçš„ä½¿ç”¨ç‡æ˜¯æ€ä¹ˆç®—çš„ã€‚æœ€å¼€å§‹ï¼šæ ¹æ®æ–‡æ¡£Hexagon_SDK/3.5.4/docs/images/Hexagon_Document_Bundle.pdf ç¬¬9ç«  processor event symbolsï¼Œæˆ‘ä»¥ä¸ºç›´æ¥ç”¨COMMITTED_PKT_ANYåŠCOMMITTED_PKT_SMTå°±èƒ½è®¡ç®—å‡ºä½¿ç”¨ç‡ï¼Œä½†æ˜¯ç»è¿‡æˆ‘çš„åˆ†æï¼Œæ€ä¹ˆç®—éƒ½å¯¹ä¸ä¸Šï¼Œè¿™ä¸ªæ—¶å€™æˆ‘åˆæŠŠé‡å¿ƒè½¬å‘å®˜æ–¹çš„åˆ†æå·¥å…·ï¼Œå®˜æ–¹çš„åˆ†æå·¥å…·èƒ½å¤Ÿä¿å­˜æ•°æ®ï¼Œç„¶åç”¨å®˜æ–¹çš„å…¶ä»–çš„å·¥å…·æ¥åå¤„ç†ä¹‹åè¿›è¡Œåˆ†æï¼Œçœ‹çœ‹èƒ½å¦ä»è¿™é‡Œæ‰¾åˆ°ä¸€äº›ç›¸å…³ä¿¡æ¯ã€‚</p>
<p>â€ƒâ€ƒå†æ¬¡ä½¿ç”¨å®˜æ–¹å·¥å…·åˆ†ædspä¿¡æ¯ç„¶åä¿å­˜ç›¸å…³çš„æ•°æ®æ–‡ä»¶ï¼Œç„¶ådumpåˆ°windowsä¸Šï¼Œå¾—åˆ°sysmon_CDSP.binï¼Œç”¨å·¥å…·åˆ†æã€‚åœ¨Hexagon_SDK\3.5.4\tools\utils\sysmon\parser_win_v2 ç›®å½•æœ‰ä¸¤ä¸ªå·¥å…·ï¼Œä¸€ä¸ªæ˜¯è§£æå·¥å…·ï¼Œä¸€ä¸ªæ˜¯ç”ŸæˆhtmlæŠ¥å‘Šï¼Œæˆ‘ä»¬æŒ‰ç…§å®˜æ–¹çš„æ–¹æ³•ç”ŸæˆhtmlæŠ¥å‘Š,å¦‚ä¸‹å›¾ã€‚</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_117/perf.png" alt="rep_img"/></center>
    </div>
</div>    
<p>â€ƒâ€ƒæˆ‘ä»¬æ‰“å¼€ç”Ÿæˆçš„htmlæŠ¥å‘Šï¼Œæˆ‘åœ¨æŠ¥å‘Šä¸­æ€»ç®—æŸ¥çœ‹åˆ°äº†QDSP6 Utilizationå’ŒQDSP6 Core performance ï¼Œå¦‚ä¸‹å›¾ã€‚é€šè¿‡é˜…è¯»ç›¸å…³å«ä¹‰ï¼Œäº†è§£åˆ°äº†å®˜æ–¹appä¸­çš„core utilizationçš„è®¡ç®—æ–¹æ³•ã€‚å…¶è®¡ç®—æ–¹æ³•ä¸ºï¼šä½¿ç”¨ç‡=ï¼ˆæ€»æ‰§è¡Œæ¬¡æ•°/å½“å‰é¢‘ç‡(hz) * é‡‡æ ·æ—¶é—´(s)ï¼‰* 100ã€‚åŸç†è§£é‡Šï¼šæ€»æ‰§è¡Œæ¬¡æ•°é™¤ä»¥å½“å‰é¢‘ç‡ä¸‹æ»¡è½½è¿è¡Œæ¬¡æ•°ï¼Œå¾—åˆ°ä½¿ç”¨ç‡ã€‚è¿™é‡Œçš„æ€»æ‰§è¡Œæ¬¡æ•°ç”±HAP_perf_get_pcyclesæ¥å¾—åˆ°,å½“å‰è¿è¡Œé¢‘ç‡ç”±HAP_power_getå¾—åˆ°ã€‚åˆ°æ­¤ï¼Œæ•´ä¸ªæŠ€æœ¯ä¸Šçš„é“¾æ¡æ‰“é€šäº†ï¼Œç°åœ¨å¼€å§‹ç¼–å†™å°ç¨‹åºã€‚</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_117/dsp_usage_info.png" alt="rep_img"/></center>
    </div>
</div>    
<br/>
<br/>
<h5 id="é«˜é€šcDSPç¼–ç¨‹">é«˜é€šcDSPç¼–ç¨‹</h5>
<p>â€ƒâ€ƒé¦–å…ˆï¼Œç›´æ¥å¤åˆ¶ä¸€ä¸ªcalculator_c++å®˜æ–¹ä¾‹å­å·¥ç¨‹æ¥ä½œä¸ºæ¨¡æ¿ï¼Œæ ¹æ®æˆ‘äº†è§£åˆ°çš„èµ„æ–™ï¼Œç›´æ¥é€‰å–makefileä½œä¸ºä½œä¸ºç¼–è¯‘æ‰‹æ®µã€‚é€šè¿‡ç¼–å†™dspçš„å°ç¨‹åºï¼Œç„¶åå¾—åˆ°æˆ‘ä»¬çš„ä½¿ç”¨ç‡ã€‚ä¸‹é¢æ˜¯é‡è¦apiçš„å±•ç¤ºã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/**
* Data type to retrieve power values from the ADSP
* @param type				-	Identifies the type to retrieve.
* @param max_mips			-	Max mips supported
* @param max_bus_bw			-	Max bus bw supported
* @param client_class		-	Current client class
* @param clkFreqHz			-	Current core CPU frequency
* @param aggregateAVSMpps	-	Aggregate AVS Mpps used by audio and voice
* @param dcvsEnabled		-	Indicates if dcvs is enabled / disabled.
*/</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	HAP_Power_response_type type<span class="token punctuation">;</span>
	<span class="token keyword">union</span><span class="token punctuation">&#123;</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">int</span> max_mips<span class="token punctuation">;</span>
		uint64 max_bus_bw<span class="token punctuation">;</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">int</span> client_class<span class="token punctuation">;</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">int</span> clkFreqHz<span class="token punctuation">;</span>
		<span class="token keyword">unsigned</span> <span class="token keyword">int</span> aggregateAVSMpps<span class="token punctuation">;</span>
		boolean dcvsEnabled<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> HAP_power_response_t<span class="token punctuation">;</span>

<span class="token comment">/**
* Method to retrieve power values from the ADSP
* @param context	-	Ignored
* @param request	-	Response.
*/</span>
<span class="token keyword">int</span> <span class="token function">HAP_power_get</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> context<span class="token punctuation">,</span> HAP_power_response_t<span class="token operator">*</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token comment">/* 
  HAP_perf_get_pcycles 
   
  Gets the current 64-bit processor cycle count
   
  The processor cycle count is the current number of processor cycles executed
  since the Hexagon processor was last reset.
 
  Note that this counter stops incrementing whenever the DSP enters a low-power
  state (such as clock gating), as opposed to the qtimer, which increments 
  regardless of the DSP power state.

	
  Returns:
  Integer -- Current count of Hexagon processor cycle count.
*/</span>
uint64 <span class="token function">HAP_perf_get_pcycles</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒå¯¹äºæˆ‘ä»¬ç¼–å†™dspå°ç¨‹åºæ¥è¯´ï¼Œæœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼Œè¿™äº›apiè™½ç„¶æˆ‘ä»¬æ˜¯åœ¨android ndkç¨‹åºé‡Œé¢è°ƒç”¨çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä»…ä»…æ˜¯åœ¨android ndkä¾§æ‰¾åˆ°ç¬¦å·ï¼Œç„¶åé€šè¿‡fastrpcå°†å‚æ•°å‘ç»™dspç«¯ï¼Œdspç«¯è°ƒç”¨å¯¹åº”çš„apiåï¼Œå°†ç»“æœè¿”å›ç»™android ndkç«¯ã€‚æ­¤éƒ¨åˆ†é‡ç‚¹å‚è€ƒå‰æ–‡ç¯å¢ƒé…ç½®éƒ¨åˆ†ï¼Œå¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œå¾ˆéš¾ç†è§£æˆ–è€…è¯´é€‚åº”è¿™ä¸ªä¸œè¥¿ã€‚</p>
<br/>
<br/>
<h5 id="é«˜é€šcDSPç¨‹åºéƒ¨ç½²åŠç­¾å">é«˜é€šcDSPç¨‹åºéƒ¨ç½²åŠç­¾å</h5>
<p>â€ƒâ€ƒç”±äºé«˜é€šçš„cDSPç¨‹åºè°ƒç”¨æ–¹å¼æ¯”è¾ƒç‰¹æ®Šï¼Œæˆ‘ä»¬åº”è¯¥æŒ‰ç…§å®˜æ–¹Hexagon_SDK/3.5.4/docs/calculator_c++.htmlä¾‹å­ä¸­æ¨èçš„éƒ¨ç½²æ–¹å¼ï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰éƒ¨ç½²ï¼Œè¯·å‚è€ƒç¯å¢ƒå˜é‡DSP_LIBRARY_PATHã€‚ä¹Ÿå°±æ˜¯æ‹·è´androidä¾§æ–‡ä»¶åˆ°å¯¹åº”ç›®å½•ï¼Œæ‹·è´dspä¾§ç›®å½•åˆ°å¯¹åº”ç›®å½•ã€‚</p>
<p>â€ƒâ€ƒæ­¤å¤–ï¼Œå½“ä½ çœŸçš„è‡ªå®šä¹‰ç¨‹åºå¹¶éƒ¨ç½²ä½¿ç”¨çš„æ—¶å€™ï¼Œä¼šé‡åˆ°ç­¾åé—®é¢˜ã€‚åœ¨å¼€å‘é˜¶æ®µï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨testsign,å…·ä½“è¯¦æƒ…å‚è€ƒï¼šHexagon_SDK/3.5.4/docs/Tools_Signing.htmlï¼Œå°±æ˜¯æŒ‰ç…§å®˜æ–¹æ–¹æ³•ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„testsign-xxxx.soçš„æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶åŒ…å«äº†å½“å‰è®¾å¤‡çš„idï¼Œèƒ½å¤Ÿè®©è¿è¡Œåœ¨å½“å‰è®¾å¤‡ä¸Šçš„ç¨‹åºå…ç­¾ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•åªèƒ½å¤Ÿç”¨äºè°ƒè¯•ï¼Œå¯¹äºå¤§è§„æ¨¡ä½¿ç”¨ï¼Œéœ€è¦é‡‡å–å¦å¤–çš„éƒ¨ç½²æ–¹å¼ï¼Œä¸€ç§æ˜¯è”ç³»å‚å®¶ï¼Œæä¾›æ‰¹é‡ç­¾åå·¥å…·ï¼Œå¦å¤–å°±æ˜¯ä½¿ç”¨ Unsigned PD åŠŸèƒ½ï¼ˆUnsigned PD is a sandboxed low-rights process that allows the signature-free modules to run on the cDSP.ï¼‰ã€‚Unsigned PDå¯ä»¥è®©ä¸€äº›ä½æƒç¨‹åºè¿è¡Œåœ¨dspä¸Šï¼Œä¸»è¦è¿˜æ˜¯è¢«ç”¨äºç¥ç»ç½‘ç»œæ¨ç†ã€‚ä½†æ˜¯å°±æ˜¯è¿™ä¸ªUnsigned PDä¹Ÿæ˜¯ä¸æ˜¯é‚£ä¹ˆå¥½ç”¨çš„ï¼Œè¿™é‡Œç›´æ¥copyå°ç±³maceæ¡†æ¶é‡Œé¢çš„soå’Œä»£ç ï¼Œåœ¨æ‰§è¡Œä»»ä½•dsp apiä¹‹å‰è°ƒç”¨hexnn_controller_request_unsigned_pdï¼ˆ<a target="_blank" rel="noopener" href="https://github.com/XiaoMi/mace/blob/fa72958a647be9457cf0a19d2f1195205a4b1a58/mace/runtimes/hexagon/dsp/hexagon_dsp_wrapper.cc%EF%BC%89">https://github.com/XiaoMi/mace/blob/fa72958a647be9457cf0a19d2f1195205a4b1a58/mace/runtimes/hexagon/dsp/hexagon_dsp_wrapper.ccï¼‰</a> ã€‚ è¿™é‡Œä¸å¾—ä¸æ„Ÿå¹ä¸€å¥ï¼Œè¿™äº›å‚å®¶çš„pyå…³ç³»çœŸå¥½ã€‚</p>
<p>â€ƒâ€ƒå½“æ‰€æœ‰éƒ¨ç½²å®Œæ¯•ä¹‹åï¼Œæ‰§è¡Œdspç¨‹åºå¾—åˆ°å¦‚ä¸‹å›¾ç»“æœï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_117/dsp_result.png" alt="rep_img"/></center>
    </div>
</div>    
<br/>
<br/>
<br/>
<br/>
<h3 id="RK3588-NPUä½¿ç”¨ç‡æŸ¥è¯¢">RK3588 NPUä½¿ç”¨ç‡æŸ¥è¯¢</h3>
<hr>
<p>â€ƒâ€ƒé¢˜å¤–è¯ï¼Œæœ€è¿‘RKçš„npuä½¿ç”¨ç‡æŸ¥è¯¢æ–¹æ³•å®˜æ–¹ä¹Ÿæä¾›äº†ï¼Œåœ¨3588ä¸Šï¼Œåªç”¨npué©±åŠ¨ä¸º0.72+å°±å¯ä»¥ã€‚ç»“æœå¦‚ä¸‹å›¾ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_117/rknpu_usage.png" alt="rep_img"/></center>
    </div>
</div>    
<br/>
<br/>
<br/>
<br/>
<h3 id="åè®°">åè®°</h3>
<hr>
<p>â€ƒâ€ƒè¿™é‡Œå…³äºdspç¼–ç¨‹æ¥è¯´ï¼Œæˆ‘è¿™é‡Œå¯ä»¥è¯´ä»…ä»…æ˜¯ä¸€ä¸ªå°demoï¼Œè¿™ä¸ªéƒ¨åˆ†æœ€æœ‰ä»·å€¼çš„è¿˜æ˜¯è®¡ç®—åŠ é€Ÿéƒ¨åˆ†ï¼Œä¸€äº›é‡è¦çš„å‘é‡è¿ç®—ï¼Œè¿™æ¬¡æˆ‘æ²¡æœ‰è¿™ä¸ªéœ€æ±‚å°±ä¸å»å…³æ³¨äº†ã€‚</p>
<p>â€ƒâ€ƒä½†æ˜¯æ¢å¥è¯è¯´ï¼Œæœ‰äº†è¿™ä¸€éƒ¨åˆ†çš„ç»éªŒåï¼Œåé¢å“ªæ€•æ˜¯å­¦ä¹ ä¸€äº›æ·±å…¥çš„ä¸œè¥¿ï¼Œä¹Ÿæ˜¯æœ‰ä¸€ç‚¹åŸºç¡€åœ¨çš„ã€‚</p>
<h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3>
<p>[1]Qualcomm.Hexagon SDK 3.5.4 Doc<br>
[2]RockChip.Rockchip_RKNPU_User_Guide_RKNN_API_V1.3.0_CN</p>
<br/>
<br/>
<div style="margin:50px auto;">
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <hr/>
        <center><font color = #91e0b0 size = 5>æ‰“èµã€è®¢é˜…ã€æ”¶è—ã€ä¸¢é¦™è•‰ã€ç¡¬å¸ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ï¼ˆæ”»åŸç‹®çš„æ¬ç –ä¹‹è·¯ï¼‰</font></center>
    </div>
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg" alt="qrc_img"/></center>
    </div>
</div>
<!-- ![alt å…¬ä¼—å·å›¾ç‰‡](https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg "å…¬ä¼—å·å›¾ç‰‡") -->
<p><font color="red" size="7">PS: è¯·å°Šé‡åŸåˆ›ï¼Œä¸å–œå‹¿å–·ã€‚</font><br/><br>
<font color="red" size="7">PS: è¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: æœ‰é—®é¢˜è¯·ç•™è¨€ï¼Œçœ‹åˆ°åæˆ‘ä¼šç¬¬ä¸€æ—¶é—´å›å¤ã€‚</font><br/><font color="red" size="7">å¦‚æŸäº›å›¾ç‰‡æ— æ³•æŸ¥çœ‹ï¼Œè¯·å°è¯•å¼€å¯å¤–ç½‘</font><br/></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://e-x.top/2022/07/03/blog_idx_116/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Sky">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sky's Blogs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Sky's Blogs">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/03/blog_idx_116/" class="post-title-link" itemprop="url">jvm jni åŠ pvm pybind11 å¤§æ‰¹é‡æ•°æ®ä¼ è¾“åŠä¼˜åŒ–</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2022-07-03 19:22:00" itemprop="dateCreated datePublished" datetime="2022-07-03T19:22:00+08:00">2022-07-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-18 19:06:02" itemprop="dateModified" datetime="2024-05-18T19:06:02+08:00">2024-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-CPP/" itemprop="url" rel="index"><span itemprop="name">C&CPP</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-CPP/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-CPP/python/JAVA/" itemprop="url" rel="index"><span itemprop="name">JAVA</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>1.5k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>5 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <script src="\assets\js\APlayer.min.js"> </script><!--
 * @Description: 
 * @Author: Sky
 * @Date: 2020-08-24 16:37:34
 * @LastEditors: Please set LastEditors
 * @LastEditTime: 2022-07-03 19:29:34
 * @Github: https://github.com/flyinskyin2013/
-->
<p><font color="red" size="7">PSï¼šè¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: è¿™ä¸ªåªæ˜¯åŸºäºã€Šæˆ‘è‡ªå·±ã€‹çš„ç†è§£ï¼Œ</font><br/><font color="red" size="7">å¦‚æœå’Œä½ çš„åŸåˆ™åŠæƒ³æ³•ç›¸å†²çªï¼Œè¯·è°…è§£ï¼Œå‹¿å–·ã€‚</font><br/></p>
<!-- ###### å‰ç½®è¯´æ˜
&emsp;&emsp;æœ¬æ–‡ä½œä¸ºæœ¬äººcsdn blogçš„ä¸»ç«™çš„å¤‡ä»½ã€‚ï¼ˆBlogID=116ï¼‰ 
&emsp;&emsp;æœ¬æ–‡å‘å¸ƒäº 2022-07-03 19:22:24   ï¼ˆBlogID=116ï¼‰ 
-->
<h6 id="ç¯å¢ƒè¯´æ˜">ç¯å¢ƒè¯´æ˜</h6>
<ol>
<li class="lvl-3">
<p>android æ‰‹æœº</p>
</li>
<li class="lvl-3">
<p>linux pythonç¯å¢ƒ</p>
</li>
</ol>
<h3 id="å‰è¨€">å‰è¨€</h3>
<hr>
<p>â€ƒâ€ƒè¿‘å‡ ä¸ªæœˆæ¥ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œå‘ç”Ÿäº†è®¸è®¸å¤šå¤šçš„äº‹æƒ…ï¼Œå¯¼è‡´æœ‰å¾ˆå¤šideaï¼Œä½†æ˜¯éƒ½æœªå½¢æˆå¥½çš„æ–‡ç« ã€‚æœ€è¿‘ï¼Œè¶ç€è¿™ä¸ªæœºä¼šï¼Œå†™ä¸€ç¯‡ã€‚</p>
<p>â€ƒâ€ƒç”±äºä¸šåŠ¡çš„å®‰æ’ï¼Œæˆ‘ä»¬éœ€è¦åœ¨c/c++å±‚ä¸javaå’Œpythonå±‚è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œæ•°æ®é‡æœ‰å¤§æœ‰å°ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬ä¸šåŠ¡ä¸Šå¯¹è¿™ä¸ªæ•°æ®äº¤æ¢çš„å»¶æ—¶æœ‰ä¸€å®šçš„è¦æ±‚ï¼Œå› æ­¤æœ‰äº›é—®é¢˜éœ€è¦æˆ‘ä»¬è§£å†³ã€‚åœ¨æˆ‘ä»¬çš„å®éªŒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°äº†åœ¨å¸¸è§„æƒ…å†µä¸‹ï¼Œåœ¨jvmä¸­ç”¨æ–°åˆ›å»ºByteArray/FloatArrayè¿›è¡Œå¤§æ•°æ®é‡ï¼ˆ6Mb byte/2Mb floatsï¼‰çš„ä¼ è¾“ï¼Œæ—¶é—´åœ¨5ms/7msï¼Œåœ¨pvmä¸­ç”¨æ–°åˆ›å»ºbytearrayå¤§æ•°æ®é‡ï¼ˆ8Mb byteï¼‰çš„ä¼ è¾“ï¼Œæ—¶é—´åœ¨1mså·¦å³ã€‚ä»å®éªŒæƒ…å†µæ¥çœ‹ï¼Œæˆ‘ä»¬éœ€è¦ä¼˜åŒ–jvmä¸­è¿›è¡Œå¤§æ•°æ®é‡ä¼ è¾“çš„æ–¹æ³•ã€‚</p>
<p>â€ƒâ€ƒæˆ‘ä»¥å‰å†™è¿‡å…³äºjavaï¼Œpythonå’Œc/cppäº¤äº’çš„ä¸€äº›æ–‡ç« ï¼Œæ„Ÿå…´è¶£å¯ä»¥å‚è€ƒã€‚</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>ã€ŠC++ è°ƒç”¨ Python æ€»ç»“(ä¸€)ã€‹ <a target="_blank" rel="noopener" href="https://blog.csdn.net/u011728480/article/details/103903612">https://blog.csdn.net/u011728480/article/details/103903612</a></p>
</li>
<li class="lvl-2">
<p>ã€Šjava æ‰‹åŠ¨ç”Ÿæˆjniå¤´æ–‡ä»¶(JNIé™æ€æ³¨å†Œ)ã€‹ <a target="_blank" rel="noopener" href="https://blog.csdn.net/u011728480/article/details/87260113">https://blog.csdn.net/u011728480/article/details/87260113</a></p>
</li>
<li class="lvl-2">
<p>ã€ŠAndroid JNIé™æ€å’ŒåŠ¨æ€æ³¨å†Œ ã€Java Reflectï¼ˆCæˆ–C++å±‚åå°„å’ŒJAVAå±‚åå°„ï¼‰ã€Java å¯å˜å‚æ•°ï¼ˆJNIå®ç°ï¼‰ã€‹ <a target="_blank" rel="noopener" href="https://blog.csdn.net/u011728480/article/details/78963494">https://blog.csdn.net/u011728480/article/details/78963494</a></p>
</li>
</ul>
<br/>
<br/>
<br/>
<br/>
<h3 id="jvm-jniç¯‡">jvm jniç¯‡</h3>
<hr>
<p>â€ƒâ€ƒjniå¸¸è§„å¤§é‡æ•°æ®äº¤æ¢æ–¹æ³•ç½‘ä¸Šæœ‰è®¸å¤šï¼ŒåŸºæœ¬éƒ½æ˜¯å¦‚ä¸‹æ‰€ç¤º:</p>
<p>â€ƒâ€ƒåœ¨javaå¾€c/cppè¿”å›æ—¶ï¼Œä¸€èˆ¬éƒ½æ˜¯è·å–æ•°æ®çš„åº•å±‚åœ°å€ï¼Œç„¶åé’ˆå¯¹åœ°å€æ“ä½œå³å¯ã€‚</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">jbyteArray array<span class="token punctuation">;</span><span class="token comment">//or jfloatArray array; passed by jni-func</span>
<span class="token keyword">void</span> <span class="token operator">*</span> _you_wanted_ptr <span class="token operator">=</span> env<span class="token operator">-></span><span class="token function">GetPrimitiveArrayCritical</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// TODO</span>

env<span class="token operator">-></span><span class="token function">ReleasePrimitiveArrayCritical</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> _you_wanted_ptr<span class="token punctuation">,</span> JNI_ABORT<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒåœ¨c/cppå¾€javaä¼ è¾“å¤§é‡æ•°æ®æ—¶ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥newä¸€ä¸ªæ•°ç»„ï¼Œç„¶åè¿”å›çš„æ–¹å¼ï¼Œä¸€ç§å°±æ˜¯è·å–javaå±‚çš„æ•°ç»„åœ°å€ï¼Œç„¶åç›´æ¥ä¿®æ”¹ç›¸å…³çš„æ•°æ®å³å¯ã€‚å…¶åŸºæœ¬å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// slow way</span>
<span class="token keyword">int</span> len <span class="token operator">=</span> xxx<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span> data_ptr <span class="token operator">=</span> xxx<span class="token punctuation">;</span>
jXXXArray array <span class="token operator">=</span> env<span class="token operator">-></span><span class="token function">NewXXXArray</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
env<span class="token operator">-></span><span class="token function">SetXXXArrayRegion</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> jXXX <span class="token operator">*</span><span class="token punctuation">)</span> data_ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> array<span class="token punctuation">;</span>

<span class="token comment">// fast way</span>
jbyteArray array<span class="token punctuation">;</span><span class="token comment">//or jfloatArray array; passed by jni-func</span>
<span class="token keyword">int</span> len <span class="token operator">=</span> xxx<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token operator">*</span> data_ptr <span class="token operator">=</span> xxx<span class="token punctuation">;</span>
env<span class="token operator">-></span><span class="token function">SetXXXArrayRegion</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> jXXX <span class="token operator">*</span><span class="token punctuation">)</span> data_ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒè¿™é‡Œåœ¨ä½¿ç”¨fast wayæ¨¡å¼åï¼Œåœ¨jvmä¸­ç”¨è¿›è¡Œå¤§æ•°æ®é‡ï¼ˆ6Mb byte/2Mb floatsï¼‰çš„ä¼ è¾“ï¼Œæ—¶é—´åœ¨0.88ms/1msï¼Œæ³¨æ„ï¼Œæœ‰ä½¿ç”¨é™åˆ¶ã€‚è¿™é‡Œä¸€å®šè¦æ³¨æ„å¤šçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="pvm-pybind11ç¯‡">pvm pybind11ç¯‡</h3>
<hr>
<p>â€ƒâ€ƒåœ¨pybind11ä¸­ï¼Œå¤§è§„æ¨¡æ•°æ®ä¼ è¾“ä¸€èˆ¬æœ‰ä¸¤ç§æ•°æ®ç»“æ„ï¼Œä¸€ç§æ˜¯py::bytesï¼Œä¸€ç§å°±æ˜¯æˆ‘ä»¬å¸¸è§çš„numpyæ•°ç»„ï¼Œç‰¹åˆ«æ˜¯åœ¨å›¾åƒå¤„ç†ä¸­ï¼Œnumpyæ•°ç»„æ˜¯æœ€å¸¸è§çš„ä¸€ç§æ ¼å¼ã€‚ä¸‹é¢ï¼Œæ ¹æ®è¿™ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«ä»‹ç»ã€‚</p>
<br/>
<br/>
<h5 id="py-bytes-ç±»å‹ä¼ è¾“">py::bytes ç±»å‹ä¼ è¾“</h5>
<p>â€ƒâ€ƒpython å±‚ä¼ ç»™c/cppã€‚</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">const</span> py<span class="token double-colon punctuation">::</span>bytes <span class="token operator">&amp;</span>value<span class="token punctuation">;</span><span class="token comment">//passed by pybind11-func</span>
Py_ssize_t size <span class="token operator">=</span> <span class="token function">PyBytes_GET_SIZE</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token function">PyBytes_AsString</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//TODO </span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒc/cpp å±‚ä¼ ç»™pythonã€‚</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">char</span> <span class="token operator">*</span> buf <span class="token operator">=</span> xxx<span class="token punctuation">;</span>
<span class="token keyword">int</span> len <span class="token operator">=</span> xxx<span class="token punctuation">;</span>
<span class="token keyword">return</span> py<span class="token double-colon punctuation">::</span><span class="token function">bytes</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//In pybind11, return to pvm</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒæ³¨æ„ï¼Œåœ¨py::bytesä¸­ï¼Œä¹Ÿæœ‰ç›´æ¥ä¿®æ”¹åœ°å€çš„æ–¹å¼ï¼Œè¿™é‡Œå°±ä¸æä¾›äº†ï¼ˆpython buffer protocolï¼‰ï¼Œæœ‰å¿ƒäººè‡ªå·±å»ç ”ç©¶å§ã€‚</p>
<br/>
<br/>
<h5 id="numpyæ•°æ®ä¼ è¾“">numpyæ•°æ®ä¼ è¾“</h5>
<p>â€ƒâ€ƒè¿™ä¸ªä¹Ÿæœ‰åƒpy::bytesé‚£æ ·åˆ›å»ºæ•°ç»„ï¼Œç„¶åè¿”å›çš„æ–¹å¼ï¼Œè¿™é‡Œå°±ä¸æä¾›äº†ã€‚è¿™é‡Œä¸»è¦è¿˜æ˜¯æ¼”ç¤ºä¸€ä¸‹æ€ä¹ˆå¿«é€Ÿåœ¨c/cppä¸­è·å–numpyæ•°æ®ã€‚å…¶å®è¿™é‡Œçš„æ•°æ®ä¼ è¾“ä¹Ÿå°±æ˜¯ç›´æ¥è·å–numpyæ•°ç»„åœ°å€ï¼ŒåŸºæœ¬å¤§å·®ä¸å·®ã€‚</p>
<p>â€ƒâ€ƒc/cppåˆ°python</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// python buffer protocol</span>
py<span class="token double-colon punctuation">::</span>array_t<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token punctuation">,</span> py<span class="token double-colon punctuation">::</span>array<span class="token double-colon punctuation">::</span>c_style <span class="token operator">|</span> py<span class="token double-colon punctuation">::</span>array<span class="token double-colon punctuation">::</span>forcecast<span class="token operator">></span> <span class="token operator">&amp;</span>buffer<span class="token punctuation">;</span><span class="token comment">//passed by pybind11-func</span>
<span class="token keyword">auto</span> buf_info <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">unchecked</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">char</span> <span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>buf_info<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment">// set value to ptr(numpy)</span>

<span class="token comment">// get value from ptr(numpy)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒæ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨åˆ°ä¸€ä¸ªå«åšpython buffer protocolçš„ä¸œè¥¿ï¼Œæœ‰å…´è¶£å¤§å®¶å¯ä»¥çœ‹çœ‹ï¼Œæˆ‘åœ¨è¿™ä¸ªä¸Šå¹¶æ²¡æœ‰æ·±ç©¶ã€‚</p>
<br/>
<br/>
<h5 id="pybind11ä¸­å†…å­˜ç®¡ç†é—®é¢˜">pybind11ä¸­å†…å­˜ç®¡ç†é—®é¢˜</h5>
<p>â€ƒâ€ƒåœ¨pybind11ä¸­ï¼Œè¦å°å¿ƒç®¡ç†å†…å­˜ï¼Œç‰¹åˆ«æ˜¯æ³¨æ„ä»¥ä¸‹ä¸¤ç§è°ƒç”¨çš„åŒºåˆ«ã€‚æ ¹æ®<a target="_blank" rel="noopener" href="https://pybind11.readthedocs.io/en/stable/advanced/classes.html#non-public-destructors%E7%9A%84%E8%AF%B4%E6%98%8E%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%80%E8%88%AC%E4%BC%9A%E6%9C%89%E4%B8%A4%E7%A7%8D%E6%83%85%E5%86%B5%E9%9C%80%E8%A6%81%E9%80%89%E6%8B%A9%E4%BD%BF%E7%94%A8%E3%80%82">https://pybind11.readthedocs.io/en/stable/advanced/classes.html#non-public-destructorsçš„è¯´æ˜ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæœ‰ä¸¤ç§æƒ…å†µéœ€è¦é€‰æ‹©ä½¿ç”¨ã€‚</a></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// å•ä¾‹</span>
<span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token operator">~</span><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// ç¦æ­¢unique_ptr è°ƒç”¨ ææ„å‡½æ•°ï¼Œ æ‰€æœ‰èµ„æºé‡Šæ”¾éœ€è¦åœ¨cppä¾§è¿›è¡Œå®Œæˆã€‚</span>
py<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">class_</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyClass<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MyClass<span class="token punctuation">,</span> py<span class="token double-colon punctuation">::</span>nodelete<span class="token operator">>></span></span></span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"MyClass"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span>py<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">init</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">// ä¸€èˆ¬class</span>
<span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token operator">~</span><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// unique_ptr ææ„æ—¶è‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°ï¼Œæ‰€æœ‰èµ„æºé‡Šæ”¾ç”±unique_ptrå®Œæˆã€‚</span>
py<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">class_</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyClass<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>MyClass<span class="token operator">>></span></span></span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"MyClass"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span>py<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">init</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<br/>
<br/>
<br/>
<br/>
<h3 id="åè®°">åè®°</h3>
<hr>
<p>â€ƒâ€ƒæ€»çš„æ¥è¯´ï¼Œåœ¨jvmå’Œpvmä¸­ï¼Œé€šè¿‡æ“ä½œå›ºå®šæ•°ç»„çš„åº•å±‚æŒ‡é’ˆï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿçš„è·å–æ•°æ®å’Œä¼ è¾“æ•°æ®ã€‚ä½†æ˜¯å­˜åœ¨ä¸€äº›ç°è±¡ï¼Œä¾‹å¦‚éœ€è¦æ³¨æ„ä¸€äº›åŸå­æ“ä½œå’Œpvm/jvmä¸­æ•°ç»„çš„ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜ï¼Œæˆ‘è¿™é‡Œå»ºè®®ï¼Œå¦‚æœæ˜¯å¤§è§„æ¨¡æ•°æ®ä¼ è¾“ï¼Œå»ºè®®ç›´æ¥å…¨å±€æ•°ç»„ï¼Œè¿™æ ·ä¿è¯ç”Ÿå‘½å‘¨æœŸé—®é¢˜ã€‚</p>
<h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3>
<p>[1]<a target="_blank" rel="noopener" href="https://pybind11.readthedocs.io/en/stable/advanced/classes.html#non-public-destructors">https://pybind11.readthedocs.io/en/stable/advanced/classes.html#non-public-destructors</a></p>
<br/>
<br/>
<div style="margin:50px auto;">
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <hr/>
        <center><font color = #91e0b0 size = 5>æ‰“èµã€è®¢é˜…ã€æ”¶è—ã€ä¸¢é¦™è•‰ã€ç¡¬å¸ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ï¼ˆæ”»åŸç‹®çš„æ¬ç –ä¹‹è·¯ï¼‰</font></center>
    </div>
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg" alt="qrc_img"/></center>
    </div>
</div>
<!-- ![alt å…¬ä¼—å·å›¾ç‰‡](https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg "å…¬ä¼—å·å›¾ç‰‡") -->
<p><font color="red" size="7">PS: è¯·å°Šé‡åŸåˆ›ï¼Œä¸å–œå‹¿å–·ã€‚</font><br/><br>
<font color="red" size="7">PS: è¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: æœ‰é—®é¢˜è¯·ç•™è¨€ï¼Œçœ‹åˆ°åæˆ‘ä¼šç¬¬ä¸€æ—¶é—´å›å¤ã€‚</font><br/></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://e-x.top/2021/12/26/blog_idx_115/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Sky">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sky's Blogs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Sky's Blogs">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/26/blog_idx_115/" class="post-title-link" itemprop="url">ä¸€ç§å®ç”¨æ€§è¾ƒå¼ºçš„æ±‚IOUçš„ç®—æ³•ï¼ˆä»»æ„å¤šè¾¹å½¢ä¹‹é—´çš„IOUï¼‰</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-12-26 18:59:56" itemprop="dateCreated datePublished" datetime="2021-12-26T18:59:56+08:00">2021-12-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-18 19:06:02" itemprop="dateModified" datetime="2024-05-18T19:06:02+08:00">2024-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-CPP/" itemprop="url" rel="index"><span itemprop="name">C&CPP</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-CPP/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">æ•°æ®ç»“æ„ä¸ç®—æ³•</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/C-CPP/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89/" itemprop="url" rel="index"><span itemprop="name">è®¡ç®—æœºè§†è§‰</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>1.7k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>6 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <script src="\assets\js\APlayer.min.js"> </script><!--
 * @Description: 
 * @Author: Sky
 * @Date: 2020-08-24 16:37:34
 * @LastEditors: Sky sky@sky-home.com
 * @LastEditTime: 2023-04-08 11:15:21
 * @Github: https://github.com/flyinskyin2013/
-->
<p><font color="red" size="7">PSï¼šè¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: è¿™ä¸ªåªæ˜¯åŸºäºã€Šæˆ‘è‡ªå·±ã€‹çš„ç†è§£ï¼Œ</font><br/><font color="red" size="7">å¦‚æœå’Œä½ çš„åŸåˆ™åŠæƒ³æ³•ç›¸å†²çªï¼Œè¯·è°…è§£ï¼Œå‹¿å–·ã€‚</font><br/></p>
<!-- ###### å‰ç½®è¯´æ˜
&emsp;&emsp;æœ¬æ–‡ä½œä¸ºæœ¬äººcsdn blogçš„ä¸»ç«™çš„å¤‡ä»½ã€‚ï¼ˆBlogID=115ï¼‰ 
&emsp;&emsp;æœ¬æ–‡å‘å¸ƒäº 2021-12-26 18:59:56     ï¼ˆBlogID=115ï¼‰
-->
<h6 id="ç¯å¢ƒè¯´æ˜">ç¯å¢ƒè¯´æ˜</h6>
<p>â€ƒâ€ƒæ— </p>
<h3 id="å‰è¨€">å‰è¨€</h3>
<hr>
<p>â€ƒâ€ƒæåˆ°IOUï¼Œå¦‚æœæ¥è§¦è¿‡ç›®æ ‡æ£€æµ‹ï¼Œåº”è¯¥æ˜¯å¾ˆç†Ÿæ‚‰çš„ï¼Œè¿™ä¸ªä¸œè¥¿ç®€ç›´å°±æ˜¯æ ‡é…äº†ã€‚ä½†æ˜¯æˆ‘ä¹‹å‰è§åˆ°çš„æ±‚IOUéƒ½æ˜¯æ±‚ä¸¤ä¸ªçŸ©å½¢çš„IOUï¼Œç”±äºçŸ©å½¢çš„ç‰¹æ®Šæ€§ï¼Œå…¶IOUå¯ä»¥å¾ˆç®€å•çš„æ±‚ã€‚</p>
<p>â€ƒâ€ƒçªç„¶æœ‰ä¸€å¤©ï¼Œæˆ‘è¦æ±‚ä¸€ä¸ªçŸ©å½¢å’Œä¸€ä¸ªå¤šè¾¹å½¢çš„IOUï¼Œè¿™å°±è®©æˆ‘çªç„¶æœ‰ç‚¹æ‡µï¼Œå‚è€ƒåŸæ¥æ±‚ä¸¤ä¸ªçŸ©å½¢çš„IOUæ–¹å¼ï¼Œå®Œå…¨æ— è§£ã€‚ç»è¿‡äº†è¯¢é—®å¤§ä½¬ä»¥åŠç½‘ä¸Šå†²æµªåï¼Œåœ¨æŸä¸èµ·çœ¼çš„åœ°æ–¹å‘ç°äº†ä¸€ä¸ªæ€è·¯ï¼Œä¸€ä¸ªåŒ¿åç½‘å‹è²Œä¼¼æä¾›äº†ä¸€å¥MATLABçš„ä»£ç ï¼Œç»™äº†æˆ‘ä¸é”™çš„å¯å‘ã€‚</p>
<p>â€ƒâ€ƒå› æ­¤æœ¬æ–‡ç”¨c++å’Œopencvå®ç°äº†è¿™éƒ¨åˆ†ä»£ç ã€‚ä¸‹é¢å°†ä¼šä»IOUæ¦‚å¿µï¼Œä¸¤çŸ©å½¢çš„IOUï¼Œä»¥åŠä»»æ„å¤šè¾¹å½¢ä¹‹é—´çš„IOUé¡ºåºè¿›è¡Œè®²è§£ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="äº¤å¹¶æ¯”ï¼ˆIntersection-of-Unionï¼ŒIOUï¼‰">äº¤å¹¶æ¯”ï¼ˆIntersection of Unionï¼ŒIOUï¼‰</h3>
<hr>
<p>â€ƒâ€ƒæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå¤šè¾¹å½¢çš„é¢ç§¯ä¸ºArea0ï¼Œå¦å¤–ä¸€ä¸ªå¤šè¾¹å½¢çš„é¢ç§¯ä¸ºArea1ã€‚é‚£ä¹ˆIOUçš„æ•°å­¦å®šä¹‰ä¸º$IOU=\frac{Area_0 \cap Area_1}{Area_0 \cup Area_1}$ã€‚</p>
<p>â€ƒâ€ƒä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªç¤ºä¾‹å›¾æ¸…æ™°çš„è¡¨è¾¾è¿™ä¸ªæ¦‚å¿µï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_115/iou_img_example.png" alt="rep_img"/></center>
    </div>
</div>    
<p>â€ƒâ€ƒå…¶ä¸­Bç±»åŒºåŸŸå°±æ˜¯ä¸¤ä¸ªå¤šè¾¹å½¢çš„äº¤é›†ã€‚IOUæ±‚çš„æ˜¯Bç±»åŒºåŸŸåœ¨A,B,Cç±»åŒºåŸŸä¸­çš„å æ¯”ã€‚æ³¨æ„è¿™é‡Œæ˜¯å æ¯”ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="ä¸¤ä¸ªçŸ©å½¢ä¹‹é—´çš„IOUæ±‚æ³•">ä¸¤ä¸ªçŸ©å½¢ä¹‹é—´çš„IOUæ±‚æ³•</h3>
<hr>
<p>â€ƒâ€ƒä¸¤ä¸ªçŸ©å½¢çš„IOUæ±‚æ³•å…¶å®äº¤ç®€å•ï¼Œæ ¹æ®ä¸€äº›æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ±‚å‡ºäº¤é›†åŒºåŸŸçš„å®½å’Œé«˜ï¼Œç„¶åç›´æ¥å¾—åˆ°äº¤é›†é¢ç§¯å³å¯ï¼Œè¿™äº›éƒ½æ˜¯å¸¸è§„å†™æ³•ã€‚è¯¦æƒ…è§å¦‚ä¸‹ä»£ç ï¼š</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">float IOU(const cv::Rect &amp;r0, const cv::Rect &amp;r1)
&#123;

    if (r0.x &gt; r1.x + r1.width) return 0.f;&#x2F;&#x2F;top-x  r0 åœ¨r1å³è¾¹
    if (r0.y &gt; r1.y + r1.height) return 0.f;&#x2F;&#x2F;top-y r0 åœ¨r1ä¸‹è¾¹
    if (r0.x + r0.width &lt; r1.x) return 0.f;&#x2F;&#x2F;bottom-x r0 åœ¨r1å·¦è¾¹
    if (r0.y + r0.height &lt; r1.y) return 0.f;&#x2F;&#x2F;bottom-y r0 åœ¨r1ä¸Šè¾¹

    &#x2F;&#x2F; æ­¤æ—¶å¿…å®šç›¸äº¤
    float _overlap_w &#x3D; std::min(r0.x + r0.width, r1.x + r1.width) - std::max(r0.x, r1.x);&#x2F;&#x2F;å¾—åˆ°ç›¸äº¤çŸ©å½¢w

    float _overlap_h &#x3D; std::min(r0.y + r0.height, r1.y + r1.height) - std::max(r0.y, r1.y);&#x2F;&#x2F;å¾—åˆ°ç›¸äº¤çŸ©å½¢h

    &#x2F;&#x2F; maybe overflow
    return (_overlap_w * _overlap_h)&#x2F;(float)((r0.width*r0.height) + (r1.width*r1.height));

&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒå¦‚ä¸Šå¯çŸ¥ï¼Œå¯ä»¥ç›´æ¥æ ¹æ®ç›¸å…³é¢ç§¯ï¼Œæ±‚å‡ºIOUã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="ä¸¤ä¸ªå¤šè¾¹å½¢ä¹‹é—´çš„IOUæ±‚æ³•">ä¸¤ä¸ªå¤šè¾¹å½¢ä¹‹é—´çš„IOUæ±‚æ³•</h3>
<hr>
<p>â€ƒâ€ƒæˆ‘ä»¬éœ€è¦æ±‚ä¸¤ä¸ªå¤šè¾¹å½¢çš„IOUï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ ¹æ®ä¸¤ä¸ªçŸ©å½¢çš„æ€è·¯æƒ³æƒ³ï¼Œè²Œä¼¼ä¸å¥½å¼„ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥è½¬å˜ä¸€ä¸‹æ€è·¯ã€‚</p>
<p>â€ƒâ€ƒæˆ‘ä»¬é¦–å…ˆè‚¯å®šæ˜¯çŸ¥é“ä¸¤ä¸ªå¤šè¾¹å½¢çš„æœ€å¤§å¤–æ¥çŸ©å½¢çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¾—åˆ°æœ€å¤§çš„å¤–ç•ŒçŸ©å½¢å®½å’Œé«˜ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œçš„å®½å’Œé«˜ä¸€èˆ¬æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬éƒ½ä¸éœ€è¦å»æ±‚å¤–æ¥çŸ©ï¼‰ã€‚ç„¶åæˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªå®½å’Œé«˜ç­‰äºæˆ‘ä»¬é¢„è®¾çš„ä¸€ç»´çŸ©é˜µM_A, M_Bï¼ŒM_Cï¼Œå¹¶å°†å…¶æ‰€æœ‰å…ƒç´ ç½®ä¸º0ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åˆ†åˆ«å°†çŸ©é˜µä¸€ç”¨å¤šè¾¹å½¢P1æ¥æ¥å¡«å……M_Aï¼Œåœ¨P1å†…çš„å…ƒç´ ç½®ä¸º1ï¼Œå¤–çš„å…ƒç´ ä¸å˜ã€‚å¯¹M_Bç”¨åŒæ ·çš„æ–¹å¼å»å¡«å……ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å»è®¡ç®—M_Cï¼Œå…·ä½“è®¡ç®—æ–¹æ³•æ˜¯å°†å¯¹åº”çš„M_Aï¼ŒM_BåŒä¸€ä½ç½®çš„å…ƒç´ ç›¸ä¸åèµ‹å€¼ç»™M_C(è¡¨è¾¾å¼ä¸º:$M_C(x,y) = M_A(x,y) &amp; M_B(x,y)$)ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å»ç»Ÿè®¡M_A,M_B,M_Cä¸­1çš„ä¸ªæ•°ï¼Œå…¶å®å°±å¾—åˆ°äº†å¯¹åº”çš„é¢ç§¯ï¼ˆä¹Ÿå¯ä»¥å«åšåƒç´ é¢ç§¯ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æ–¹ä¾¿çš„æ±‚å‡ºIOUï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯opencvä¸­æä¾›äº†æˆ‘ä»¬æ‰€éœ€è¦çš„æ‰€æœ‰æ“ä½œã€‚</p>
<p>â€ƒâ€ƒä¸‹é¢æˆ‘ä»¬ç”¨c++æ¥å®ç°ä»¥ä¸Šçš„æµç¨‹ï¼ˆæ³¨æ„ï¼Œä»¥ä¸‹ä»£ç æ˜¯å®ç°çš„æ˜¯Nä¸ªå¤šè¾¹å½¢å’ŒMä¸ªå¤šè¾¹å½¢çš„IOUï¼Œè‹¥è‡ªå·±çš„éœ€æ±‚ä¸ä¸€æ ·ï¼Œè¯·ä¿®æ”¹ä¸ºå¯¹åº”çš„åœºæ™¯ï¼Œä»£ç æ˜¯éšæ‰‹å†™çš„ï¼Œæœªä»”ç»†éªŒè¯ï¼ŒåŸç†æ˜¯è¿™æ ·çš„ï¼‰ã€‚</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">float IoU(const std::vector&lt;std::vector&lt;cv::Point&gt;&gt; &amp;poly_array0, const std::vector&lt;std::vector&lt;cv::Point&gt;&gt; &amp;poly_array1, int max_w, int max_h)&#123;

        cv::Mat _poly0 &#x3D; cv::Mat::zeros(max_h, max_w, CV_8UC1);
        cv::Mat _poly1 &#x3D; cv::Mat::zeros(max_h, max_w, CV_8UC1);
        cv::Mat _result;

        std::vector&lt;cv::Point *&gt; _pts0;
        std::vector&lt;int&gt; _npts0;

        for(auto &amp;_v:poly_array0)&#123;

                if (_v.size() &lt; 3)&#x2F;&#x2F;invalid poly
                        return -1.f;

                _pts0.push_back((cv::Point *)&amp;_v[0]);
                _npts0.push_back((int)_v.size());
        &#125;

        std::vector&lt;cv::Point *&gt; _pts1;
        std::vector&lt;int&gt; _npts1;
        for(auto &amp;_v:poly_array1)&#123;

                if (_v.size() &lt; 3)&#x2F;&#x2F;invalid poly
                        return -1.f;

                _pts1.push_back((cv::Point *)&amp;_v[0]);
                _npts1.push_back((int)_v.size());
        &#125;
&#x2F;*

void cv::fillPoly	(	Mat &amp; 	img,
const Point ** 	pts,
const int * 	npts,
int 	ncontours,
const Scalar &amp; 	color,
int 	lineType &#x3D; LINE_8,
int 	shift &#x3D; 0,
Point 	offset &#x3D; Point() 
)	
*&#x2F;
        cv::fillPoly(_poly0, (const cv::Point **)&amp;_pts0[0], &amp;_npts0[0], _npts0.size(), cv::Scalar(1));

        cv::fillPoly(_poly0, (const cv::Point **)&amp;_pts1[0], &amp;_npts1[0], _npts1.size(), cv::Scalar(1));

        cv::bitwise_and(_poly0, _poly1, _result);

        int _area0 &#x3D; cv::countNonZero(_poly0);
        int _area1 &#x3D; cv::countNonZero(_poly1);
        int _intersection_area &#x3D; cv::countNonZero(_result);

        &#x2F;&#x2F; float _iou &#x3D; (float)_intersection_area&#x2F;(float)(_area0 + _area1 - _intersection_area);
        float _iou &#x3D; (float)_intersection_area&#x2F;(float)_area1;

        return _iou;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒé€šè¿‡å¦‚ä¸Šä»£ç ï¼Œæˆ‘ä»¬ç”¨opencvå°±å®ç°äº†æˆ‘ä»¬é¢„æƒ³çš„æ•ˆæœã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="åè®°">åè®°</h3>
<hr>
<p>â€ƒâ€ƒæ³¨æ„ï¼Œè¿™é‡Œéœ€è¦å»¶ä¼¸ä¸€ç‚¹ï¼Œæ±‚IOUï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯ç”¨äº¤é›†é™¤ä»¥å¹¶é›†ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™ï¼Œå¯èƒ½æˆ‘ä»¬ä¼šç”¨äº¤é›†é™¤ä»¥å…¶ä¸­ä¸€ä¸ªé›†åˆã€‚æ¯”å¦‚ï¼šä¸€ä¸ªå°çŸ©å½¢ï¼Œä¸€ä¸ªå¤§å¤šè¾¹å½¢çš„iouï¼Œå…¶å®æŒ‰ç…§æ ‡å‡†å†™æ³•æ¥çœ‹ï¼Œiouçš„æ•°å€¼ä¸å¤„ç†çš„è¯ï¼Œä¸æ˜¯é‚£ä¹ˆå¯çˆ±çš„ã€‚</p>
<p>â€ƒâ€ƒå…¶å®è¿™é‡Œçš„å‡ ç§ç”¨æ³•è¿˜å¯ä»¥å»¶ä¼¸å‡ºæ¥ï¼Œæ¯”å¦‚ç®—ä¸¤ä¸ªç«‹æ–¹ä½“çš„é‡åˆåº¦ç­‰ç­‰ã€‚</p>
<h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://docs.opencv.org/3.4/d6/d6e/group__imgproc__draw.html">https://docs.opencv.org/3.4/d6/d6e/group__imgproc__draw.html</a></p>
</li>
</ul>
<br/>
<br/>
<div style="margin:50px auto;">
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <hr/>
        <center><font color = #91e0b0 size = 5>æ‰“èµã€è®¢é˜…ã€æ”¶è—ã€ä¸¢é¦™è•‰ã€ç¡¬å¸ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ï¼ˆæ”»åŸç‹®çš„æ¬ç –ä¹‹è·¯ï¼‰</font></center>
    </div>
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg" alt="qrc_img"/></center>
    </div>
</div>
<!-- ![alt å…¬ä¼—å·å›¾ç‰‡](https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg "å…¬ä¼—å·å›¾ç‰‡") -->
<p><font color="red" size="7">PS: è¯·å°Šé‡åŸåˆ›ï¼Œä¸å–œå‹¿å–·ã€‚</font><br/><br>
<font color="red" size="7">PS: è¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: æœ‰é—®é¢˜è¯·ç•™è¨€ï¼Œçœ‹åˆ°åæˆ‘ä¼šç¬¬ä¸€æ—¶é—´å›å¤ã€‚</font><br/></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://e-x.top/2021/11/28/blog_idx_114/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Sky">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sky's Blogs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Sky's Blogs">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/28/blog_idx_114/" class="post-title-link" itemprop="url">å¯’æ­¦çºªåŠ é€Ÿå¹³å°(MLU200ç³»åˆ—) æ‘¸é±¼æŒ‡å—ï¼ˆå››ï¼‰--- è¾¹ç¼˜ç«¯å®ä¾‹ç¨‹åºåˆ†æ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-11-28 19:01:17" itemprop="dateCreated datePublished" datetime="2021-11-28T19:01:17+08:00">2021-11-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-18 19:06:02" itemprop="dateModified" datetime="2024-05-18T19:06:02+08:00">2024-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">åµŒå…¥å¼</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/DL/" itemprop="url" rel="index"><span itemprop="name">DL</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/DL/%E5%B8%B8%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">å¸¸è¯†</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>3.6k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>13 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <script src="\assets\js\APlayer.min.js"> </script><!--
 * @Description: 
 * @Author: Sky
 * @Date: 2020-08-24 16:37:34
 * @LastEditors: Sky sky@sky-home.com
 * @LastEditTime: 2023-04-08 11:14:43
 * @Github: https://github.com/flyinskyin2013/
-->
<p><font color="red" size="7">PSï¼šè¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: è¿™ä¸ªåªæ˜¯åŸºäºã€Šæˆ‘è‡ªå·±ã€‹çš„ç†è§£ï¼Œ</font><br/><font color="red" size="7">å¦‚æœå’Œä½ çš„åŸåˆ™åŠæƒ³æ³•ç›¸å†²çªï¼Œè¯·è°…è§£ï¼Œå‹¿å–·ã€‚</font><br/></p>
<!-- ###### å‰ç½®è¯´æ˜
&emsp;&emsp;æœ¬æ–‡ä½œä¸ºæœ¬äººcsdn blogçš„ä¸»ç«™çš„å¤‡ä»½ã€‚ï¼ˆBlogID=114ï¼‰ 
&emsp;&emsp;æœ¬æ–‡å‘å¸ƒäº 2021-11-28 19:01:17     ï¼ˆBlogID=114ï¼‰
-->
<h6 id="ç¯å¢ƒè¯´æ˜">ç¯å¢ƒè¯´æ˜</h6>
<ul class="lvl-0">
<li class="lvl-2">
<p>MLU220 å¼€å‘æ¿</p>
</li>
<li class="lvl-2">
<p>Ubuntu18.04 + MLU270å¼€å‘ä¸»æœºä¸€å°</p>
</li>
<li class="lvl-2">
<p>aarch64-linux-gnu-gcc 6.x äº¤å‰ç¼–è¯‘ç¯å¢ƒ</p>
</li>
</ul>
<h3 id="å‰è¨€">å‰è¨€</h3>
<hr>
<p>â€ƒâ€ƒé˜…è¯»æœ¬æ–‡å‰ï¼Œè¯·åŠ¡å¿…é¡»çŸ¥ä»¥ä¸‹å‰ç½®æ–‡ç« æ¦‚å¿µï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>ã€Šå¯’æ­¦çºªåŠ é€Ÿå¹³å°(MLU200ç³»åˆ—) æ‘¸é±¼æŒ‡å—ï¼ˆä¸€ï¼‰â€” åŸºæœ¬æ¦‚å¿µåŠç›¸å…³ä»‹ç»ã€‹ ( <a target="_blank" rel="noopener" href="https://blog.csdn.net/u011728480/article/details/121194076">https://blog.csdn.net/u011728480/article/details/121194076</a> )</p>
</li>
<li class="lvl-2">
<p>ã€Šå¯’æ­¦çºªåŠ é€Ÿå¹³å°(MLU200ç³»åˆ—) æ‘¸é±¼æŒ‡å—ï¼ˆäºŒï¼‰â€” æ¨¡å‹ç§»æ¤-ç¯å¢ƒæ­å»ºã€‹ ( <a target="_blank" rel="noopener" href="https://blog.csdn.net/u011728480/article/details/121320982">https://blog.csdn.net/u011728480/article/details/121320982</a> )</p>
</li>
<li class="lvl-2">
<p>ã€Šå¯’æ­¦çºªåŠ é€Ÿå¹³å°(MLU200ç³»åˆ—) æ‘¸é±¼æŒ‡å—ï¼ˆä¸‰ï¼‰â€” æ¨¡å‹ç§»æ¤-åˆ†å‰²ç½‘ç»œå®ä¾‹ã€‹ ï¼ˆ <a target="_blank" rel="noopener" href="https://blog.csdn.net/u011728480/article/details/121456789">https://blog.csdn.net/u011728480/article/details/121456789</a> ï¼‰</p>
</li>
</ul>
<p>â€ƒâ€ƒè¿™é‡Œå†æ¬¡å›é¡¾ä¸€ä¸‹ã€Šå¯’æ­¦çºªåŠ é€Ÿå¹³å°(MLU200ç³»åˆ—) æ‘¸é±¼æŒ‡å—ï¼ˆä¸€ï¼‰â€” åŸºæœ¬æ¦‚å¿µåŠç›¸å…³ä»‹ç»ã€‹çš„å†…å®¹ï¼Œå¯’æ­¦çºªåŠ é€Ÿå¡æ˜¯ä¸€ä¸ªç¡¬ä»¶å¹³å°ï¼Œæ˜¯æœ€åº•å±‚çš„å­˜åœ¨ï¼Œåœ¨ç¡¬ä»¶å¹³å°ä¹‹ä¸Šï¼Œæœ‰é©±åŠ¨ï¼Œåœ¨é©±åŠ¨ä¹‹ä¸Šï¼Œæœ‰è¿è¡Œæ—¶ã€‚æœ¬æ–‡çš„ç¦»çº¿æ¨¡å‹å°±æ˜¯åŸºäºè¿è¡Œæ—¶çš„apiè¿›è¡Œè°ƒç”¨å’Œå¤„ç†ï¼Œå¾—åˆ°æ¨¡å‹ç»“æœã€‚</p>
<p>â€ƒâ€ƒæœ¬æ–‡ä½œä¸ºæœ¬ç³»åˆ—çš„ç»ˆç¯‡ï¼Œå°†ä¼šä»ä¸Šæ–‡çš„ç¦»çº¿æ¨¡å‹å¼€å§‹ï¼Œä»å¤´å¼€å§‹æ­å»ºæˆ‘ä»¬çš„ç¦»çº¿æ¨¡å‹æ¨ç†ä»£ç ç»“æ„ï¼Œç»è¿‡åˆç†çš„éƒ¨ç½²ï¼Œèƒ½å¤Ÿåœ¨MLU220å¼€å‘æ¿æ­£å¸¸çš„è¿è¡Œã€‚</p>
<p>â€ƒâ€ƒè‹¥æ–‡ä¸­å¼•ç”¨éƒ¨åˆ†å­˜åœ¨ä¾µæƒï¼Œè¯·åŠæ—¶è”ç³»æˆ‘åˆ é™¤ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="ç¦»çº¿æ¨¡å‹æ¨ç†å‰ç½®é¡»çŸ¥">ç¦»çº¿æ¨¡å‹æ¨ç†å‰ç½®é¡»çŸ¥</h3>
<hr>
<p>â€ƒâ€ƒç»è¿‡å‰æ–‡ç›¸å…³çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æˆ‘ä»¬ä¸»è¦è°ƒç”¨çš„æ˜¯è¿è¡Œæ—¶ç›¸å…³çš„apiã€‚è¿™é‡Œå­˜åœ¨ä¸¤å¥—apiå¯ä»¥ä½¿ç”¨ï¼Œä¸€ä¸ªæ˜¯cnrtï¼Œä¸€ä¸ªæ˜¯easydkã€‚easydkæ˜¯åŸºäºcnrtå°è£…çš„apiï¼Œå¤§å¤§ç®€åŒ–äº†ç¦»çº¿æ¨¡å‹æ¨ç†çš„å¼€å‘æµç¨‹ã€‚ä½†æ˜¯æˆ‘ä»¬çš„å¼€å‘ä¸»çº¿æ˜¯ä¸€è‡´çš„ï¼Œå°±æ˜¯åˆå§‹åŒ–mluè®¾å¤‡ï¼ŒåŠ è½½æ¨¡å‹ï¼Œé¢„å¤„ç†ï¼Œæ¨¡å‹æ¨ç†ï¼Œåå¤„ç†ï¼Œå¤„ç†ç»“æœã€‚</p>
<p>â€ƒâ€ƒæ­¤å¤–ï¼Œå¯’æ­¦çºªè¿˜æä¾›äº†CNStreamç¨‹åºæ¡†æ¶ï¼ŒåŸºäºEasyDkå¼€å‘ï¼Œä»¥pipeline+observerçš„æ–¹å¼ï¼Œæä¾›äº†ä¸€ä¸ªç®€å•æ˜“ç”¨çš„æ¡†æ¶ï¼Œå¦‚æœæœ‰å…´è¶£ï¼Œè¯·æŸ¥çœ‹å…¶å®˜ç½‘ <a target="_blank" rel="noopener" href="https://github.com/Cambricon/CNStream">https://github.com/Cambricon/CNStream</a> ã€‚</p>
<p>â€ƒâ€ƒæˆ‘ä»¬å…¶å®è¦ç”¨çš„æ˜¯EasyDK+CNRTçš„è¿™ç§å¼€å‘æ–¹å¼ï¼Œæ„é€ ä¸€ä¸ªç±»ä¼¼CNStreamè¿™æ ·çš„ç¨‹åºã€‚</p>
<br/>
<br/>
<h5 id="EasyDKç®€ä»‹ä¸ç¼–è¯‘">EasyDKç®€ä»‹ä¸ç¼–è¯‘</h5>
<p>â€ƒâ€ƒé¦–å…ˆå…¶å®˜ç½‘æ˜¯ï¼š<a target="_blank" rel="noopener" href="https://github.com/Cambricon/easydk%E3%80%82">https://github.com/Cambricon/easydkã€‚</a></p>
<p>â€ƒâ€ƒå…¶é™¤äº†CNToolKitçš„ä¾èµ–ï¼ˆneuwareï¼‰ä¹‹å¤–ï¼Œè¿˜ä¾èµ–äºglog,gflags,opencvï¼Œè¿™äº›éœ€è¦æå‰å®‰è£…å¥½ã€‚è‡³äºCNToolKit x86çš„ç‰ˆæœ¬çš„ç›¸å…³ä»‹ç»å·²ç»åœ¨æ¨¡å‹ç§»æ¤ç¯å¢ƒéƒ¨åˆ†ä»‹ç»è¿‡äº†ã€‚</p>
<p>â€ƒâ€ƒç”±äºæˆ‘ä»¬è¦å¼€å‘è¾¹ç¼˜ç«¯ç¦»çº¿æ¨¡å‹æ¨ç†ç¨‹åºï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸»è¦è¿˜æ˜¯ä½¿ç”¨åˆ°EasyDKé‡Œé¢çš„EasyInferéƒ¨åˆ†çš„å†…å®¹ã€‚å…¶ç¼–è¯‘æµç¨‹çš„è¯å°±å¦‚å…¶å®˜æ–¹ä»‹ç»ï¼š</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>cmake â€¦</p>
</li>
<li class="lvl-2">
<p>make</p>
</li>
</ul>
<p>â€ƒâ€ƒå¦‚æœç†Ÿæ‚‰cmakeçš„ç¼–è¯‘æµç¨‹çš„è¯ï¼Œå…¶å®å°±çŸ¥é“ä¸Šé¢çš„æµç¨‹æ˜¯éå¸¸æ™®éçš„ã€‚å¯¹äºEasyDKçš„ç¼–è¯‘æ¥è¯´ï¼Œåœ¨x86ä¸‹é¢è¿›è¡Œç¼–è¯‘æ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯å¦‚æœè¦è¿›è¡Œäº¤å‰ç¼–è¯‘çš„è¯ï¼Œæœ€å¥½åªç”Ÿæˆæ ¸å¿ƒåº“ï¼Œå…¶ä»–çš„sampleå’Œtestéƒ½å…³é—­ã€‚</p>
<br/>
<br/>
<br/>
<br/>
<h3 id="å®Œæˆç¦»çº¿æ¨¡å‹åœ¨MLU270ä¸Šçš„è¿è¡Œ">å®Œæˆç¦»çº¿æ¨¡å‹åœ¨MLU270ä¸Šçš„è¿è¡Œ</h3>
<hr>
<p>â€ƒâ€ƒè¿˜è®°å¾—åœ¨ã€Šå¯’æ­¦çºªåŠ é€Ÿå¹³å°(MLU200ç³»åˆ—) æ‘¸é±¼æŒ‡å—ï¼ˆä¸‰ï¼‰â€” æ¨¡å‹ç§»æ¤-åˆ†å‰²ç½‘ç»œå®ä¾‹ã€‹ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡torch_mlu.core.mlu_model.set_core_version(â€˜MLU220â€™)ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´ç”Ÿæˆçš„ç¦»çº¿æ¨¡å‹è¿è¡Œçš„å¹³å°ï¼Œå¯ä»¥æ˜¯è¾¹ç¼˜ç«¯MLU220ï¼Œå¯ä»¥æ˜¯æœåŠ¡å™¨éƒ¨ç½²ç«¯çš„MLU270ã€‚å¯¹çš„ï¼Œæ²¡æœ‰çœ‹é”™ï¼ŒMLU270æ—¢å¯ä»¥åšæ¨¡å‹ç§»æ¤ï¼Œä¹Ÿå¯ä»¥åšç¦»çº¿æ¨¡å‹çš„éƒ¨ç½²ï¼Œå°±å¦‚åŒæœ¬ç³»åˆ—çš„å¼€ç¯‡æ‰€è®²ï¼Œè¿™å‡ ä¸ªå¹³å°ä»…ä»…æ˜¯éƒ¨ç½²åœºæ™¯çš„å·®å¼‚ã€‚</p>
<p>â€ƒâ€ƒä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨MLU270ä¸Šè°ƒè¯•ç¦»çº¿æ¨¡å‹å‘¢ï¼Ÿå› ä¸ºæ–¹ä¾¿ã€‚å› ä¸ºMLU220ä¸€èˆ¬æ¥è¯´éƒ½éœ€è¦äº¤å‰ç¼–è¯‘ï¼Œç‰¹åˆ«æ˜¯ç›¸å…³çš„ä¾èµ–åº“çš„ç”Ÿæˆæ¯”è¾ƒéº»çƒ¦ï¼Œå¦‚æœMLU220çš„æ¿å¡ä¹Ÿæ–¹ä¾¿è°ƒè¯•çš„è¯ï¼Œé‚£ä¹Ÿå¯ä»¥ç›´æ¥åŸºäºMLU220è¿›è¡Œå¼€å‘å’Œè°ƒè¯•ã€‚</p>
<p>â€ƒâ€ƒç”±äºæˆ‘è¿™è¾¹æ˜¯EasyDK+CNRTæ··åˆè°ƒç”¨çš„å½¢å¼ï¼Œå› æ­¤æˆ‘ä¸»è¦æ ¹æ®å…¶å®˜æ–¹çš„CNRTæ¨ç†ä»£ç è¿›è¡Œæ³¨é‡Šå’Œä»‹ç»ï¼Œå¹¶åœ¨ç›¸å…³ä½ç½®æ ‡æ³¨å“ªäº›å†…å®¹æ˜¯EasyDKå¯ä»¥ä¸€æ­¥åˆ°ä½çš„ã€‚è¿™é‡Œç®€å•çš„å›ç­”å‡ ä¸ªç–‘é—®ã€‚ä¸ºä»€ä¹ˆéœ€è¦EasyDKè¿™ä¸ªåº“å‘¢ï¼Ÿä¸ºä»€ä¹ˆä¸ç›´æ¥åŸºäºCNRTè¿›è¡Œå¼€å‘ï¼Ÿæˆ‘çš„å›ç­”æ˜¯æ ¹æ®é¡¹ç›®æ¨è¿›çš„éœ€è¦åšå‡ºçš„é€‰æ‹©ã€‚å…³äºè¿™ç§ç¨‹åºçš„æœ€ç»ˆå½¢æ€ï¼Œå…¶å®æˆ‘è¿˜æ˜¯æœŸå¾…ç›´æ¥åŸºäºCNRTå¼€å‘ï¼Œå› ä¸ºå…¶æœ‰æ•ˆï¼Œä½†æ˜¯ä»£ä»·æ˜¯ä½ å¿…é¡»å¾ˆç†Ÿæ‚‰çš„äº†è§£ç›¸å…³çš„å†…å®¹ã€‚</p>
<p>â€ƒâ€ƒä¸‹é¢æ˜¯å®˜æ–¹æ¨ç†ä»£ç ä»‹ç»ï¼ˆå¯èƒ½ä¼šåœ¨é¡ºåºä¸Šåšä¸€äº›å˜æ›´ï¼Œå…¶å®˜æ–¹ä»£ç æœªå¤„ç†ä¸€äº›è¿”å›å€¼ï¼Œè‡ªå·±ç¼–å†™çš„æ—¶å€™éœ€è¦æ³¨æ„,æ­¤å¤–,å®˜æ–¹çš„ä»£ç æœ‰äº›é—æ¼çš„åœ°æ–¹,æˆ‘è¿›è¡Œäº†ä¿®æ”¹ï¼‰ï¼š</p>
 <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* Copyright (C) [2019] by Cambricon, Inc. */</span>
 <span class="token comment">/* offline_test */</span>
 <span class="token comment">/*
  * A test which shows how to load and run an offline model.
  * This test consists of one operation --mlp.
  *
  * This example is used for MLU270 and MLU220.
  *
  */</span>

 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"cnrt.h"</span></span>
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

 <span class="token keyword">int</span> <span class="token function">offline_test</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

   <span class="token comment">// This example is used for MLU270 and MLU220. You need to choose the corresponding offline model.</span>
   <span class="token comment">// when generating an offline model, u need cnml and cnrt both</span>
   <span class="token comment">// when running an offline model, u need cnrt only</span>
   <span class="token comment">// ç¬¬ä¸€æ­¥ï¼Œä½ å¿…é¡»è°ƒç”¨cnrtInit()åˆå§‹åŒ–è¿è¡Œæ—¶ç¯å¢ƒ</span>
   <span class="token function">cnrtInit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// ç¬¬äºŒæ­¥ï¼Œ å°±æ˜¯æ£€æŸ¥MLUè®¾å¤‡ï¼Œå¹¶è®¾å®šå½“å‰è®¾å¤‡ï¼Œè¿™ä¸€æ­¥å…¶å®æ˜¯ä¸ºå¤šè®¾å¤‡æ¨ç†å‡†å¤‡çš„</span>
   <span class="token class-name">cnrtDev_t</span> dev<span class="token punctuation">;</span>
   <span class="token function">cnrtGetDeviceHandle</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dev<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">cnrtSetCurrentDevice</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// è¿™é‡Œçš„ç¬¬ä¸€äºŒæ­¥å…¶å®å¯èƒ½åˆ›å»ºä¸€ä¸ªEasyInferå¯¹è±¡å°±å®Œæˆäº†ï¼Œè€Œä¸”å…·å¤‡äº†å®Œæ•´çš„é”™è¯¯æ£€æŸ¥ã€‚</span>

   <span class="token comment">// </span>
   <span class="token comment">// prepare model name</span>
   <span class="token comment">// load model</span>
   <span class="token comment">// ç¬¬ä¸‰æ­¥ï¼Œå°±æ˜¯åŠ è½½æ¨¡å‹</span>
   <span class="token class-name">cnrtModel_t</span> model<span class="token punctuation">;</span>
   <span class="token function">cnrtLoadModel</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">,</span> <span class="token string">"test.cambricon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// get model total memory</span>
   <span class="token comment">// ç¬¬å››æ­¥ï¼Œå°±æ˜¯è·å–æ¨¡å‹çš„ä¸€äº›å±æ€§ï¼Œæ¯”å¦‚å†…å­˜å ç”¨ï¼Œå¹¶è¡Œæ€§è¿™äº›ï¼Œè¿™ä¸€æ­¥æ˜¯å¯é€‰çš„ã€‚</span>
   <span class="token class-name">int64_t</span> totalMem<span class="token punctuation">;</span>
   <span class="token function">cnrtGetModelMemUsed</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token operator">&amp;</span>totalMem<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"total memory used: %ld Bytes\n"</span><span class="token punctuation">,</span> totalMem<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// get model parallelism</span>
   <span class="token keyword">int</span> model_parallelism<span class="token punctuation">;</span>
   <span class="token function">cnrtQueryModelParallelism</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token operator">&amp;</span>model_parallelism<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"model parallelism: %d.\n"</span><span class="token punctuation">,</span> model_parallelism<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// ç¬¬äº”æ­¥ï¼Œæ˜¯å»ºç«‹æ¨ç†é€»è¾‘æµï¼Œè¿™ä¸€æ­¥å°±æ˜¯æ ¹æ®ç¦»çº¿æ¨¡å‹ï¼Œåœ¨å†…å­˜ä¸­åŠ¨æ€ç”Ÿæˆæ¨¡å‹æ¨ç†ç»“æ„ã€‚è¿™é‡Œçš„"subnet0"æ˜¯ä¸€ä¸ª kernel-func åå­—ï¼Œéå›ºå®šï¼Œä½†æ˜¯å¸¸è§çš„åå­—éƒ½æ˜¯subnet0ï¼Œ</span>
   <span class="token comment">// åœ¨.cambricon_twinsé…å¥—æ–‡ä»¶ä¸­æœ‰ç›¸å…³å®šä¹‰ã€‚</span>
   <span class="token comment">// ä»–è¿™ä¸ªå’Œcudaç¼–ç¨‹å…¶å®æ¯”è¾ƒç±»ä¼¼ï¼Œæˆ‘ä»¬åˆšåˆšç”Ÿæˆçš„æ¨¡å‹æ¨ç†ç»“æ„å…¶å®è¢«å½“åšä¸€ä¸ªå†…æ ¸å‡½æ•°ï¼Œå‡½æ•°åå°±æ˜¯è¿™ä¸ªã€‚</span>
   <span class="token comment">// load extract function</span>
   <span class="token class-name">cnrtFunction_t</span> function<span class="token punctuation">;</span>
   <span class="token function">cnrtCreateFunction</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>function<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">cnrtExtractFunction</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>function<span class="token punctuation">,</span> model<span class="token punctuation">,</span> <span class="token string">"subnet0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



   <span class="token comment">// ç¬¬å…­æ­¥ï¼Œè·å–è¾“å…¥è¾“å‡ºèŠ‚ç‚¹ä¸ªæ•°å’Œè¾“å…¥è¾“å‡ºæ•°æ®sizeã€‚æ³¨æ„è®¸å¤šç½‘ç»œä¸­æœ‰å¤šä¸ªè¾“å…¥ï¼Œä¹Ÿå¯èƒ½æœ‰å¤šä¸ªè¾“å‡ºã€‚åœ¨æ¬¡æ³¨æ„è¿™ä¸ªæ¦‚å¿µï¼Œåç»­çš„æ“ä½œéƒ½åœ¨å¤šä¸ªè¾“å…¥å’Œå¤šä¸ªè¾“å‡ºçš„åŸºç¡€ä¸Šè®¾è®¡çš„ã€‚</span>
   <span class="token keyword">int</span> inputNum<span class="token punctuation">,</span> outputNum<span class="token punctuation">;</span>
   <span class="token class-name">int64_t</span> <span class="token operator">*</span>inputSizeS<span class="token punctuation">,</span> <span class="token operator">*</span>outputSizeS<span class="token punctuation">;</span>
   <span class="token function">cnrtGetInputDataSize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>inputSizeS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>inputNum<span class="token punctuation">,</span> function<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">cnrtGetOutputDataSize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>outputSizeS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>outputNum<span class="token punctuation">,</span> function<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// prepare data on cpu</span>
   <span class="token comment">// ç¬¬7æ­¥ï¼Œç”³è¯·cpuä¸Šçš„è¾“å…¥è¾“å‡ºå†…å­˜ï¼Œè¿™é‡Œæ˜¯äºŒç»´æŒ‡é’ˆå“ˆï¼Œä»£è¡¨å¤šä¸ªè¾“å…¥è¾“å‡º</span>
   <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span>inputCpuPtrS <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>inputNum <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span>outputCpuPtrS <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>outputNum <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// allocate I/O data memory on MLU</span>
   <span class="token comment">// ç¬¬8æ­¥ï¼Œç”³è¯·mluä¸Šçš„è¾“å…¥è¾“å‡ºå†…å­˜ï¼Œè¿™é‡Œæ˜¯äºŒç»´æŒ‡é’ˆå“ˆï¼Œä»£è¡¨å¤šä¸ªè¾“å…¥è¾“å‡ºã€‚</span>
   <span class="token comment">// æ­¤æ—¶è¿˜æœªçœŸæ­£ç”³è¯·æ•°æ®å†…å­˜ï¼Œåªæ˜¯ç”³è¯·äº†æ•°æ®èŠ‚ç‚¹çš„å¥æŸ„ï¼ˆæŒ‡é’ˆï¼‰</span>
   <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span>inputMluPtrS <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>inputNum <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span>outputMluPtrS <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>outputNum <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// prepare input buffer</span>
   <span class="token comment">// ç¬¬9æ­¥ï¼Œåˆ†åˆ«å¯¹ç¬¬8æ­¥çš„æ•°æ®èŠ‚ç‚¹å¥æŸ„ç”³è¯·çœŸæ­£çš„å†…å­˜ç©ºé—´ã€‚è¿™é‡Œçš„inputCpuPtrSå’ŒinputMluPtrSæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œè¿™æ˜¯å†…å­˜åœ°å€ä¸ä¸€æ ·ï¼Œå†…å­˜ç®¡ç†è€…ä¸ä¸€æ ·ã€‚å¯¹è¾“å‡ºä¹Ÿæ˜¯åŒç†ã€‚</span>
   <span class="token comment">// mallocæ˜¯æ ‡å‡†cç”³è¯·å †å†…å­˜æ¥å£</span>
   <span class="token comment">// cnrtMallocæ˜¯ç”³è¯·mluæ‰€ç®¡ç†çš„å†…å­˜æ¥å£,ç±»æ¯”cudaçš„è¯,å¯ä»¥ç›´æ¥ç†è§£ä¸ºç”³è¯·æ˜¾å­˜</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> inputNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         <span class="token comment">// converts data format when using new interface model</span>
         inputCpuPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>inputSizeS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// malloc mlu memory</span>
         <span class="token function">cnrtMalloc</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>inputMluPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> inputSizeS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">cnrtMemcpy</span><span class="token punctuation">(</span>inputMluPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> inputCpuPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> inputSizeS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> CNRT_MEM_TRANS_DIR_HOST2DEV<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token comment">// prepare output buffer</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> outputNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         outputCpuPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>outputSizeS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// malloc mlu memory</span>
         <span class="token function">cnrtMalloc</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>outputMluPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> outputSizeS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>

   

   <span class="token comment">// ç¬¬10æ­¥,é¦–å…ˆå°†é¢„å¤„ç†å¥½çš„å›¾åƒæ•°æ®å¡«å……inputCpuPtrS, æ‹·è´cpuè¾“å…¥æ•°æ®å†…å­˜åˆ°mluè¾“å…¥æ•°æ®å†…å­˜</span>
   cv<span class="token operator">::</span>Mat _in_img<span class="token punctuation">;</span>
   _in_img <span class="token operator">=</span> cv<span class="token operator">::</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"test.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   _in_img<span class="token punctuation">.</span><span class="token function">convertTo</span><span class="token punctuation">(</span>_in_img<span class="token punctuation">,</span> CV_32FC3<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> inputNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

       <span class="token comment">// æ³¨æ„è¿™é‡Œçš„memcpyæ˜¯æˆ‘æ·»åŠ çš„ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ¨¡å‹çš„æ•°æ®è¾“å…¥éƒ½æ˜¯fp16æˆ–è€…fp32ï¼Œä½†æ˜¯ä¸€èˆ¬æˆ‘ä»¬çš„opencvç”Ÿæˆçš„uint8ã€‚éœ€è¦è½¬æ¢æˆfp32ï¼Œæˆ–è€…fp16ã€‚</span>
       <span class="token comment">// é‡è¦æ˜¯äº‹æƒ…å‘3æ¬¡ï¼Œæ³¨æ„å›¾ç‰‡çš„é¢„å¤„ç†åçš„æ•°æ®æ ¼å¼ä»¥åŠæ¨¡å‹è¾“å…¥çš„æ•°æ®æ ¼å¼ï¼Œä¸åŒçš„è¯ï¼Œéœ€è¦ç»è¿‡è½¬æ¢ï¼Œå®˜æ–¹æä¾›äº†cnrtCastDataTypeæ¥è¾…åŠ©è½¬æ¢è¿‡ç¨‹ã€‚</span>
       <span class="token comment">// é‡è¦æ˜¯äº‹æƒ…å‘3æ¬¡ï¼Œæ³¨æ„å›¾ç‰‡çš„é¢„å¤„ç†åçš„æ•°æ®æ ¼å¼ä»¥åŠæ¨¡å‹è¾“å…¥çš„æ•°æ®æ ¼å¼ï¼Œä¸åŒçš„è¯ï¼Œéœ€è¦ç»è¿‡è½¬æ¢ï¼Œå®˜æ–¹æä¾›äº†cnrtCastDataTypeæ¥è¾…åŠ©è½¬æ¢è¿‡ç¨‹ã€‚</span>
       <span class="token comment">// é‡è¦æ˜¯äº‹æƒ…å‘3æ¬¡ï¼Œæ³¨æ„å›¾ç‰‡çš„é¢„å¤„ç†åçš„æ•°æ®æ ¼å¼ä»¥åŠæ¨¡å‹è¾“å…¥çš„æ•°æ®æ ¼å¼ï¼Œä¸åŒçš„è¯ï¼Œéœ€è¦ç»è¿‡è½¬æ¢ï¼Œå®˜æ–¹æä¾›äº†cnrtCastDataTypeæ¥è¾…åŠ©è½¬æ¢è¿‡ç¨‹ã€‚</span>
       <span class="token operator">::</span><span class="token function">memcpy</span><span class="token punctuation">(</span> inputCpuPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> _in_img<span class="token punctuation">.</span>data<span class="token punctuation">,</span> inputSizeS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">cnrtMemcpy</span><span class="token punctuation">(</span>inputMluPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> inputCpuPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> inputSizeS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> CNRT_MEM_TRANS_DIR_HOST2DEV<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>

   <span class="token comment">// ç¬¬10æ­¥ï¼Œä¸»è¦å°±æ˜¯å›¾åƒé¢„å¤„ç†ï¼Œå°†å›¾åƒæ•°æ®ä¼ è¾“åˆ°mluä¸Šé¢å»ã€‚</span>

   <span class="token comment">// ç¬¬11æ­¥ï¼Œä¸»è¦æ˜¯å¼€å§‹è®¾ç½®æ¨ç†å‚æ•°</span>
   <span class="token comment">// prepare parameters for cnrtInvokeRuntimeContext</span>
   <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span>param <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>inputNum <span class="token operator">+</span> outputNum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> inputNum<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         param<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> inputMluPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> outputNum<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         param<span class="token punctuation">[</span>inputNum <span class="token operator">+</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> outputMluPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>

   <span class="token comment">// ç¬¬12æ­¥ï¼Œç»‘å®šè®¾å¤‡å’Œè®¾ç½®æ¨ç†context</span>
   <span class="token comment">// setup runtime ctx</span>
   <span class="token class-name">cnrtRuntimeContext_t</span> ctx<span class="token punctuation">;</span>
   <span class="token function">cnrtCreateRuntimeContext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ctx<span class="token punctuation">,</span> function<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// compute offline</span>
   <span class="token class-name">cnrtQueue_t</span> queue<span class="token punctuation">;</span>
   <span class="token function">cnrtRuntimeContextCreateQueue</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// bind device</span>
   <span class="token function">cnrtSetRuntimeContextDeviceId</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">cnrtInitRuntimeContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


   <span class="token comment">// ç¬¬13æ­¥ï¼Œæ¨ç†å¹¶ç­‰å¾…æ¨ç†ç»“æŸã€‚</span>
   <span class="token comment">// invoke</span>
   <span class="token function">cnrtInvokeRuntimeContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> param<span class="token punctuation">,</span> queue<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// sync</span>
   <span class="token function">cnrtSyncQueue</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// ç¬¬14æ­¥ï¼Œå°†æ•°æ®ä»mluæ‹·è´å›cpuï¼Œç„¶åè¿›è¡Œåç»­çš„åå¤„ç†</span>
   <span class="token comment">// copy mlu result to cpu</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> outputNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         <span class="token function">cnrtMemcpy</span><span class="token punctuation">(</span>outputCpuPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> outputMluPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> outputSizeS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> CNRT_MEM_TRANS_DIR_DEV2HOST<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>

   <span class="token comment">// ç¬¬15æ­¥ï¼Œæ¸…ç†ç¯å¢ƒã€‚</span>
   <span class="token comment">// free memory space</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> inputNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         <span class="token function">free</span><span class="token punctuation">(</span>inputCpuPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">cnrtFree</span><span class="token punctuation">(</span>inputMluPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> outputNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         <span class="token function">free</span><span class="token punctuation">(</span>outputCpuPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">cnrtFree</span><span class="token punctuation">(</span>outputMluPtrS<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token function">free</span><span class="token punctuation">(</span>inputCpuPtrS<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">free</span><span class="token punctuation">(</span>outputCpuPtrS<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">free</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token function">cnrtDestroyQueue</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">cnrtDestroyRuntimeContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">cnrtDestroyFunction</span><span class="token punctuation">(</span>function<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">cnrtUnloadModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">cnrtDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>

 <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"mlp offline test\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">offline_test</span><span class="token punctuation">(</span><span class="token string">"mlp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>â€ƒâ€ƒ ä¸‹é¢æˆ‘ç®€å•åˆ—å‡ºä¸€äº›EasyDKçš„æ“ä½œé¡ºåºï¼š</p>
<ul class="lvl-0">
<li class="lvl-3">
<p>ä¸Šæ–‡çš„ç¬¬ä¸‰å››äº”æ­¥å…¶å®å¯¹åº”çš„æ˜¯EasyInferä¸‹é¢çš„ModelLoaderæ¨¡å—ï¼Œå½“åˆå§‹åŒ–ModelLoaderæ¨¡å—ï¼Œå¹¶ä¼ å‚ç»™EasyInferå®ä¾‹ï¼Œå°±å®Œæˆäº†ä¸‰å››äº”æ­¥çš„å†…å®¹ã€‚å…¶å®å‰é¢è¿™äº›å†…å®¹éƒ½æ˜¯å›ºå®šå½¢å¼çš„ï¼Œå¹¶ä¸æ˜¯é‡ç‚¹ã€‚é‡ç‚¹æ˜¯åé¢çš„æ•°æ®è¾“å…¥ã€æ¨ç†ã€æ•°æ®è¾“å‡ºéƒ¨åˆ†ã€‚</p>
</li>
<li class="lvl-3">
<p>ä¸Šæ–‡çš„ç¬¬6,7,8,9æ­¥å…¶å®éƒ½æ˜¯åœ¨ä¸ºæ¨¡å‹åœ¨cpuå’Œmluä¸Šç”³è¯·ç›¸å…³çš„å†…å­˜ç©ºé—´ã€‚åœ¨EasyDkä¸­æœ‰å¯¹åº”çš„æ¥å£ç›´æ¥å®Œæˆå†…å­˜ç”³è¯·ã€‚</p>
</li>
<li class="lvl-3">
<p>æ³¨æ„ä¸Šæ–‡çš„ç¬¬10æ­¥ï¼Œæ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€æ­¥ï¼ŒåŒ…å«äº†å›¾åƒæ•°æ®é¢„å¤„ç†ï¼Œåˆ°å›¾åƒæ•°æ®ç±»å‹è½¬æ¢ï¼Œå†åˆ°å›¾åƒæ•°æ®è¾“å…¥åˆ°mluå†…å­˜ã€‚</p>
</li>
<li class="lvl-3">
<p>ä¸Šæ–‡çš„ç¬¬11,12æ­¥æ˜¯ä¸ºæ¨ç†å‡†å¤‡å‚æ•°</p>
</li>
<li class="lvl-3">
<p>ä¸Šæ–‡çš„ç¬¬13æ­¥å¼€å§‹æ¨ç†</p>
</li>
<li class="lvl-3">
<p>ä¸Šæ–‡çš„ç¬¬14æ­¥ä»mluå†…å­˜ä¸­æ‹·è´å‡ºæ¨ç†ç»“æœåˆ°cpuå†…å­˜ï¼Œç„¶åè¿›è¡Œåå¤„ç†ã€‚</p>
</li>
<li class="lvl-3">
<p>ä¸Šæ–‡çš„ç¬¬15æ­¥ï¼Œæ¸…ç†ç¯å¢ƒã€‚</p>
</li>
</ul>
<br/>
<br/>
<br/>
<br/>
<h3 id="ç¦»çº¿æ¨¡å‹åœ¨MLU220ä¸Šçš„éƒ¨ç½²">ç¦»çº¿æ¨¡å‹åœ¨MLU220ä¸Šçš„éƒ¨ç½²</h3>
<hr>
<p>â€ƒâ€ƒå‰ä¸€å°èŠ‚ï¼Œä¸»è¦è¿˜æ˜¯å®Œæˆç¦»çº¿æ¨¡å‹æ¨ç†çš„ç¨‹åºå¼€å‘ï¼Œå¹¶åœ¨MLU270ä¸Šè¿è¡Œæµ‹è¯•ã€‚æœ¬å°èŠ‚çš„ä¸»è¦å†…å®¹æ˜¯æ€ä¹ˆå°†æˆ‘ä»¬è°ƒå¥½çš„ç¨‹åºéƒ¨ç½²åˆ°MLU220ã€‚</p>
<p>â€ƒâ€ƒéƒ¨ç½²åˆ°MLU220ï¼Œæˆ‘ä»¬é¢ä¸´çš„ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯äº¤å‰ç¼–è¯‘ç”ŸæˆAARCH64çš„ç¨‹åºã€‚è¿™é‡ŒåŒ…å«3ä¸ªéƒ¨åˆ†ä¾èµ–ï¼ŒCNToolkit-aarch64ï¼Œeasydk-aarch64ï¼Œå…¶ä»–ç¬¬ä¸‰æ–¹åº“å¦‚opencv-aarch64ç­‰ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°äº†aarch64çš„ç¦»çº¿æ¨ç†ç¨‹åºï¼Œå¹¶é…åˆä¹‹å‰æˆ‘ä»¬è½¬æ¢å¾—åˆ°çš„mlu220ç‰ˆæœ¬çš„ç¦»çº¿æ¨¡å‹ã€‚</p>
<p>â€ƒâ€ƒå½“æˆ‘ä»¬æŠŠç”Ÿæˆå¥½çš„ç¨‹åºæ”¾åˆ°mlu220æ¿å¡ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¯èƒ½ç¨‹åºè¿˜æ˜¯æ— æ³•è·‘èµ·æ¥ï¼Œå› ä¸ºå¯èƒ½é©±åŠ¨æœªåŠ è½½ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå»ºè®®æ‰¾åˆ°é©±åŠ¨å’Œå›ºä»¶ï¼Œè®©mlu220è¿è¡Œèµ·æ¥ã€‚ç„¶åè¿è¡Œç¨‹åºå³å¯ã€‚</p>
<p>â€ƒâ€ƒä¸‹é¢æ˜¯æ— mluè®¾å¤‡çš„æŠ¥é”™ç¤ºä¾‹ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_114/no_dev.png" alt="rep_img"/></center>
    </div>
</div> 
<p>â€ƒâ€ƒä¸‹é¢æ˜¯åŠ è½½é©±åŠ¨çš„æœ€åæ—¥å¿—ï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_114/insmod_drv.png" alt="rep_img"/></center>
    </div>
</div> 
<p>â€ƒâ€ƒä¸‹é¢æ˜¯è¿è¡Œç¨‹åºçš„è¾“å‡ºï¼š</p>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/blog_idx_114/test_seg.png" alt="rep_img"/></center>
    </div>
</div> 
<br/>
<br/>
<br/>
<br/>
<h3 id="åè®°">åè®°</h3>
<hr>
<p>â€ƒâ€ƒå¯¹äºRK3399proå’Œå¯’æ­¦çºªMLU220å¹³å°æ¥è¯´ï¼Œä¸€äº›å‡ºæ¥æ—¶é—´è¾ƒä¸ºé•¿ä¹…çš„æ¨¡å‹ï¼Œç”±äºä¼˜åŒ–çš„æ¯”è¾ƒåˆ°ä½ï¼Œé€Ÿåº¦ç›¸è¾ƒäºRK3399proå¯èƒ½æœ‰ä¸ª300%+çš„æ€§èƒ½æå‡ã€‚ä½†æ˜¯å¯¹äºä¸€äº›æ–°çš„æ¨¡å‹å’Œä¸€äº›éç»å…¸ï¼ˆéå¤§ä¼—ï¼‰çš„æ¨¡å‹ï¼Œç”±äºè‡ªå¸¦çš„ä¼˜åŒ–æˆ–è€…ç½‘ç»œç»“æ„çš„åŸå› ï¼Œå¯èƒ½åªæœ‰30%+çš„æ€§èƒ½æå‡ï¼Œä½†æ˜¯è¿™ä¹Ÿæ˜¯ä»¤äººé«˜å…´çš„äº‹æƒ…ï¼Œæ¯•ç«Ÿç¡¬ä»¶å‡çº§ä¹‹åï¼Œå¥½å¤šäº‹æƒ…å¯ä»¥è¾¾åˆ°å‡†å®æ—¶ã€‚</p>
<p>â€ƒâ€ƒæœ¬ç³»åˆ—çš„åŸºæœ¬ä»‹ç»å°±è¿™äº›äº†ï¼Œå®Œç»“æ’’èŠ±~~~ ~~~ã€‚</p>
<h3 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>ã€Šå¯’æ­¦çºªåŠ é€Ÿå¹³å°(MLU200ç³»åˆ—) æ‘¸é±¼æŒ‡å—ï¼ˆä¸€ï¼‰â€” åŸºæœ¬æ¦‚å¿µåŠç›¸å…³ä»‹ç»ã€‹ ( <a target="_blank" rel="noopener" href="https://blog.csdn.net/u011728480/article/details/121194076">https://blog.csdn.net/u011728480/article/details/121194076</a> )</p>
</li>
<li class="lvl-2">
<p>ã€Šå¯’æ­¦çºªåŠ é€Ÿå¹³å°(MLU200ç³»åˆ—) æ‘¸é±¼æŒ‡å—ï¼ˆäºŒï¼‰â€” æ¨¡å‹ç§»æ¤-ç¯å¢ƒæ­å»ºã€‹ ( <a target="_blank" rel="noopener" href="https://blog.csdn.net/u011728480/article/details/121320982">https://blog.csdn.net/u011728480/article/details/121320982</a> )</p>
</li>
<li class="lvl-2">
<p>ã€Šå¯’æ­¦çºªåŠ é€Ÿå¹³å°(MLU200ç³»åˆ—) æ‘¸é±¼æŒ‡å—ï¼ˆä¸‰ï¼‰â€” æ¨¡å‹ç§»æ¤-åˆ†å‰²ç½‘ç»œå®ä¾‹ã€‹ ï¼ˆ <a target="_blank" rel="noopener" href="https://blog.csdn.net/u011728480/article/details/121456789">https://blog.csdn.net/u011728480/article/details/121456789</a> ï¼‰</p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.cambricon.com/">https://www.cambricon.com/</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://www.cambricon.com/docs/cnrt/user_guide_html/example/offline_mode.html">https://www.cambricon.com/docs/cnrt/user_guide_html/example/offline_mode.html</a></p>
</li>
<li class="lvl-2">
<p>å…¶ä»–ç›¸å…³ä¿å¯†èµ„æ–™ã€‚</p>
</li>
</ul>
<br/>
<br/>
<div style="margin:50px auto;">
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <hr/>
        <center><font color = #91e0b0 size = 5>æ‰“èµã€è®¢é˜…ã€æ”¶è—ã€ä¸¢é¦™è•‰ã€ç¡¬å¸ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ï¼ˆæ”»åŸç‹®çš„æ¬ç –ä¹‹è·¯ï¼‰</font></center>
    </div>
</div>
<div style="text-align:center">
    <div style="margin:0 auto;">
        <center><img src="https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg" alt="qrc_img"/></center>
    </div>
</div>
<!-- ![alt å…¬ä¼—å·å›¾ç‰‡](https://flyinskyin2013.github.io/ImageBed0/blogs/qrcode_for_wx_official_account.jpg "å…¬ä¼—å·å›¾ç‰‡") -->
<p><font color="red" size="7">PS: è¯·å°Šé‡åŸåˆ›ï¼Œä¸å–œå‹¿å–·ã€‚</font><br/><br>
<font color="red" size="7">PS: è¦è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œæœ¬äººç‰ˆæƒæ‰€æœ‰ã€‚</font><br/><br>
<font color="red" size="7">PS: æœ‰é—®é¢˜è¯·ç•™è¨€ï¼Œçœ‹åˆ°åæˆ‘ä¼šç¬¬ä¸€æ—¶é—´å›å¤ã€‚</font><br/></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="ä¸Šä¸€é¡µ" aria-label="ä¸Šä¸€é¡µ" href="/NO_EXSIT.XXXXXXX/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/NO_EXSIT.XXXXXXX/">1</a><a class="page-number" href="/NO_EXSIT.XXXXXXX/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/NO_EXSIT.XXXXXXX/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/NO_EXSIT.XXXXXXX/page/14/">14</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/NO_EXSIT.XXXXXXX/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Sky</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">286k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">17:19</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":250,"hOffset":50,"vOffset":5},"mobile":{"show":false,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body>
</html>
